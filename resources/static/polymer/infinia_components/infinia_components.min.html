<html><head><meta charset="UTF-8">

	</head>

<body><div hidden="" by-vulcanize=""><dom-module id="common-styles" assetpath="styles/">

			
    <template>
    	<style include="styles-conf"></style>
	    <style>
	    	/*bootstrap*/
	    	html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{font-size:2em;margin:0.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:0.35em 0.625em 0.75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}*:before,*:after{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html{font-size:10px;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px;line-height:1.42857143;color:#333;background-color:#fff}input,button,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit}a{color:#337ab7;text-decoration:none}a:hover,a:focus{color:#23527c;text-decoration:underline}a:focus{outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}figure{margin:0}img{vertical-align:middle}.img-responsive{display:block;max-width:100%;height:auto}.img-rounded{border-radius:6px}.img-thumbnail{padding:4px;line-height:1.42857143;background-color:#fff;border:1px solid #ddd;border-radius:4px;-webkit-transition:all .2s ease-in-out;-o-transition:all .2s ease-in-out;transition:all .2s ease-in-out;display:inline-block;max-width:100%;height:auto}.img-circle{border-radius:50%}hr{margin-top:20px;margin-bottom:20px;border:0;border-top:1px solid #eee}.sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}[role="button"]{cursor:pointer}table{background-color:transparent}caption{padding-top:8px;padding-bottom:8px;color:#777;text-align:left}th{text-align:left}.table{width:100%;max-width:100%;margin-bottom:20px}.table>thead>tr>th,.table>tbody>tr>th,.table>tfoot>tr>th,.table>thead>tr>td,.table>tbody>tr>td,.table>tfoot>tr>td{padding:8px;line-height:1.42857143;vertical-align:top;border-top:1px solid #ddd}.table>thead>tr>th{vertical-align:bottom;border-bottom:2px solid #ddd}.table>caption+thead>tr:first-child>th,.table>colgroup+thead>tr:first-child>th,.table>thead:first-child>tr:first-child>th,.table>caption+thead>tr:first-child>td,.table>colgroup+thead>tr:first-child>td,.table>thead:first-child>tr:first-child>td{border-top:0}.table>tbody+tbody{border-top:2px solid #ddd}.table .table{background-color:#fff}.table-condensed>thead>tr>th,.table-condensed>tbody>tr>th,.table-condensed>tfoot>tr>th,.table-condensed>thead>tr>td,.table-condensed>tbody>tr>td,.table-condensed>tfoot>tr>td{padding:5px}.table-bordered{border:1px solid #ddd}.table-bordered>thead>tr>th,.table-bordered>tbody>tr>th,.table-bordered>tfoot>tr>th,.table-bordered>thead>tr>td,.table-bordered>tbody>tr>td,.table-bordered>tfoot>tr>td{border:1px solid #ddd}.table-bordered>thead>tr>th,.table-bordered>thead>tr>td{border-bottom-width:2px}.table-striped>tbody>tr:nth-of-type(odd){background-color:#f9f9f9}.table-hover>tbody>tr:hover{background-color:#f5f5f5}table col[class*="col-"]{position:static;float:none;display:table-column}table td[class*="col-"],table th[class*="col-"]{position:static;float:none;display:table-cell}.table>thead>tr>td.active,.table>tbody>tr>td.active,.table>tfoot>tr>td.active,.table>thead>tr>th.active,.table>tbody>tr>th.active,.table>tfoot>tr>th.active,.table>thead>tr.active>td,.table>tbody>tr.active>td,.table>tfoot>tr.active>td,.table>thead>tr.active>th,.table>tbody>tr.active>th,.table>tfoot>tr.active>th{background-color:#f5f5f5}.table-hover>tbody>tr>td.active:hover,.table-hover>tbody>tr>th.active:hover,.table-hover>tbody>tr.active:hover>td,.table-hover>tbody>tr:hover>.active,.table-hover>tbody>tr.active:hover>th{background-color:#e8e8e8}.table>thead>tr>td.success,.table>tbody>tr>td.success,.table>tfoot>tr>td.success,.table>thead>tr>th.success,.table>tbody>tr>th.success,.table>tfoot>tr>th.success,.table>thead>tr.success>td,.table>tbody>tr.success>td,.table>tfoot>tr.success>td,.table>thead>tr.success>th,.table>tbody>tr.success>th,.table>tfoot>tr.success>th{background-color:#dff0d8}.table-hover>tbody>tr>td.success:hover,.table-hover>tbody>tr>th.success:hover,.table-hover>tbody>tr.success:hover>td,.table-hover>tbody>tr:hover>.success,.table-hover>tbody>tr.success:hover>th{background-color:#d0e9c6}.table>thead>tr>td.info,.table>tbody>tr>td.info,.table>tfoot>tr>td.info,.table>thead>tr>th.info,.table>tbody>tr>th.info,.table>tfoot>tr>th.info,.table>thead>tr.info>td,.table>tbody>tr.info>td,.table>tfoot>tr.info>td,.table>thead>tr.info>th,.table>tbody>tr.info>th,.table>tfoot>tr.info>th{background-color:#d9edf7}.table-hover>tbody>tr>td.info:hover,.table-hover>tbody>tr>th.info:hover,.table-hover>tbody>tr.info:hover>td,.table-hover>tbody>tr:hover>.info,.table-hover>tbody>tr.info:hover>th{background-color:#c4e3f3}.table>thead>tr>td.warning,.table>tbody>tr>td.warning,.table>tfoot>tr>td.warning,.table>thead>tr>th.warning,.table>tbody>tr>th.warning,.table>tfoot>tr>th.warning,.table>thead>tr.warning>td,.table>tbody>tr.warning>td,.table>tfoot>tr.warning>td,.table>thead>tr.warning>th,.table>tbody>tr.warning>th,.table>tfoot>tr.warning>th{background-color:#fcf8e3}.table-hover>tbody>tr>td.warning:hover,.table-hover>tbody>tr>th.warning:hover,.table-hover>tbody>tr.warning:hover>td,.table-hover>tbody>tr:hover>.warning,.table-hover>tbody>tr.warning:hover>th{background-color:#faf2cc}.table>thead>tr>td.danger,.table>tbody>tr>td.danger,.table>tfoot>tr>td.danger,.table>thead>tr>th.danger,.table>tbody>tr>th.danger,.table>tfoot>tr>th.danger,.table>thead>tr.danger>td,.table>tbody>tr.danger>td,.table>tfoot>tr.danger>td,.table>thead>tr.danger>th,.table>tbody>tr.danger>th,.table>tfoot>tr.danger>th{background-color:#f2dede}.table-hover>tbody>tr>td.danger:hover,.table-hover>tbody>tr>th.danger:hover,.table-hover>tbody>tr.danger:hover>td,.table-hover>tbody>tr:hover>.danger,.table-hover>tbody>tr.danger:hover>th{background-color:#ebcccc}.table-responsive{overflow-x:auto;min-height:0.01%}@media screen and (max-width:767px){.table-responsive{width:100%;margin-bottom:15px;overflow-y:hidden;-ms-overflow-style:-ms-autohiding-scrollbar;border:1px solid #ddd}.table-responsive>.table{margin-bottom:0}.table-responsive>.table>thead>tr>th,.table-responsive>.table>tbody>tr>th,.table-responsive>.table>tfoot>tr>th,.table-responsive>.table>thead>tr>td,.table-responsive>.table>tbody>tr>td,.table-responsive>.table>tfoot>tr>td{white-space:nowrap}.table-responsive>.table-bordered{border:0}.table-responsive>.table-bordered>thead>tr>th:first-child,.table-responsive>.table-bordered>tbody>tr>th:first-child,.table-responsive>.table-bordered>tfoot>tr>th:first-child,.table-responsive>.table-bordered>thead>tr>td:first-child,.table-responsive>.table-bordered>tbody>tr>td:first-child,.table-responsive>.table-bordered>tfoot>tr>td:first-child{border-left:0}.table-responsive>.table-bordered>thead>tr>th:last-child,.table-responsive>.table-bordered>tbody>tr>th:last-child,.table-responsive>.table-bordered>tfoot>tr>th:last-child,.table-responsive>.table-bordered>thead>tr>td:last-child,.table-responsive>.table-bordered>tbody>tr>td:last-child,.table-responsive>.table-bordered>tfoot>tr>td:last-child{border-right:0}.table-responsive>.table-bordered>tbody>tr:last-child>th,.table-responsive>.table-bordered>tfoot>tr:last-child>th,.table-responsive>.table-bordered>tbody>tr:last-child>td,.table-responsive>.table-bordered>tfoot>tr:last-child>td{border-bottom:0}}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.center-block{display:block;margin-left:auto;margin-right:auto}.pull-right{float:right !important}.pull-left{float:left !important}.hide{display:none !important}.show{display:block !important}.invisible{visibility:hidden}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.hidden{display:none !important}.affix{position:fixed}

	    	h3, h4 {
	    		margin:5px 0;
	    	}
	    	ul, li {
	    		list-style:none;
	    		margin:0;
	    		padding:0;
	    	}
	    	
	    	a:hover,a:active, a:visited{
	    		text-decoration:none;
	    		color:inherit;
	    	}
	    	
	    	.mt10 {margin-top:10px;}
	    	.mt20 {margin-top:20px;}
	    	.ml10 {margin-left:10px;}
	    	.mb20 {margin-bottom:20px;}
	    	.cursor-pointer{cursor:pointer;}
	    	
	    	
			
	    	.shadow {
					-webkit-box-shadow: 0 0 10px var(--light-background);
				     box-shadow: 0 0 10px var(--light-background);
				}
				
			input {
				outline:none;
			}
			
			.pt5 {
				padding-top:5px;	
			}
			
			.btn {
				display: inline-block;
			    padding: 6px 12px;
			    margin-bottom: 0;
			    font-size: 14px;
			    font-weight: 400;
			    line-height: 1.42857143;
			    text-align: center;
			    white-space: nowrap;
			    vertical-align: middle;
			    -ms-touch-action: manipulation;
			    touch-action: manipulation;
			    cursor: pointer;
			    -webkit-user-select: none;
			    -moz-user-select: none;
			    -ms-user-select: none;
			    user-select: none;
			    background-image: none;
			    border: 1px solid transparent;
			    border-radius: 4px;
			}
			
			.btn-primary {
				background-color: var(--primary-color) !important;
    			border: 1px solid var(--primary-color) !important;
    			color:white;
			}
			
			.btn-sm {
			    padding: 1px 5px;
			    font-size: 12px;
			    line-height: 1.5;
			    border-radius: 3px;
			   }
			   
			   .form-control {
				    display: block;
				    width: 100%;
				    height: 34px;
				    padding: 6px 12px;
				    font-size: 14px;
				    line-height: 1.42857143;
				    color: #555;
				    background-color: #fff;
				    background-image: none;
				    border: 1px solid #ccc;
				    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
				    box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
				    -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
				    -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
				    transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
				}
				
			.accepted {
				background-color:#def7de;
			}
			
			.blocked {
				background-color:#f7dede;
			}
			
			.center-content {
				display:flex;
				justify-content:center;
				align-items:center;
			}
			
			.drop-down {
				background-color:var(--lighter-background);
				position:relative;
				padding:5px 2px;
				border:1px solid var(--dark-background);
				border-radius:5px;
				
			}
			
			.drop-down li {
				padding:5px 20px;
				cursor:pointer;
				display:flex;
				min-width:200px;
			}
			
			.drop-down li:hover {
				background-color:var(--light-background);
			}
			
			.drop-down li a {
				text-decoration:none;
				color:black;
			}
		
			.flex {
				display:flex;
				flex-wrap:wrap;
			}
			.center-vertical {
				align-items:center;
			}
			
			.space-around {
				display:flex;
				justify-content:space-around;
				flex-wrap:wrap;
			}
			
			.space-between {
				display:flex;
				justify-content:space-between;
				flex-wrap:wrap;
			}
			
			.flex-center {
				display:flex;
				justify-content:center;
				flex-wrap:wrap;
			}

			.settings {
				color:#000!important;
				cursor:pointer;
			}


			.settings {
				color:var(--primary-color);
				cursor:pointer;
		}

		.drop-down {
			background-color:var(--primary-color);
			position:relative;
			padding:5px 2px;
			border:1px solid var(--primary-color);
			border-radius:5px;
			font-weight: bold;
			text-transform: uppercase;
			z-index:500;
			overflow:auto;
		}

		.drop-down:after {
			content: "";
			position:absolute;
			right:-8px;
			top:0px;
			width:5px;
			height:30px;
			border-top: 15px solid transparent;
			border-bottom: 15px solid transparent;
			border-right: 0px solid transparent;
			border-left: 10px solid var(--primary-color);
			z-index:200;

		}
	
			
		infinia-context li {
			padding:5px 20px;
			cursor:pointer;
			display:flex;
			min-width:200px;
		}
		
		infinia-context a {
			color:black;
		}
			
		infinia-context li:hover {
			background-color:var(--hover-highlight-color);
		}


		#dropdown {
			position:relative;
			top:-50px;
			right:55px;
			max-width:300px;
		}


	    </style>
	    
  	</template>
</dom-module><script>
class InfiniaPolymer extends Polymer.Element {

	  _localize(text) {
	       return localizer.get(text);
	  }
	  
	  _getUserCountry() {
		  return utils.getUserCountry();
	  }
}
</script><dom-module id="custom-input" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		<style>
		
		
		
		
		.container{
			position:relative;
			padding-top:15px;
		}

		iron-input, input {
			width:100%;
			background-color:transparent;
		}

		input {
			margin-top:3px;
			border:1px solid var(--input-border);
    		outline: none;
    		font-size:14px;
    		padding:6px 12px;
		}
		
		
		
		input:focus {
			border:1px solid var(--primary-color);
		}

		label {
			position:absolute;
			left:5px;
			top:25px;
			cursor:text;
			color:var(--input-label);
			font-size:14px;
		}
		

		
		
		</style>
		
		<div class="container">
			<label id="lab" for="input">{{text}}</label>
			<iron-input bind-value="{{value}}">
				<input id="input" value="{{value::input}}" type="{{type}}">
			</iron-input>
		</div>
	</template> 
	
	<script>

		class CustomInput extends Polymer.Element {

	        static get is() { return  'custom-input' }
	
	        static get properties() {
	          return {
	           	value:{type:String, reflectToAttribute:true},
	           	type:String,
	           	text:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	
	          	var top = 3;
	          	var left = 5;

	          	this.initialSize;
	          	
	          	if(!_this.initialSize)
          			_this.initialSize = $(_this.$.lab).css('font-size');
	          	var finalSize = (Number(_this.initialSize.replace("px", "")) - 4)+ "px";
	          	
	          	if(this.value) {
	          		$(this.$.lab).css("top", top+"px");
	          		$(this.$.lab).css("left", left+"px");
	          		$(this.$.lab).css("font-size", finalSize);
	          	}
	          	
	          	$(this.$.input).on('focus', function() {
	          		
		          	
	          		$(_this.$.lab).animate({
	          			top:top,
	          			left:left,
	          			"font-size":finalSize
	          		}, 300)

	          		.css("top", top+"px");
	          		$(_this.$.lab).css("left", "0px");
	          	})

	          	$(this).on('focusout', function() {
	          		if(!$(_this.$.input).val()){
		          		$(_this.$.lab).animate({
		          			top:"25px",
		          			left: left+"px",
		          			"font-size":_this.initialSize
		          		}, 300)
	          	}
	          	})
	        }

	        setValue(val) {
	        	$(this.$.input).focus();
	        	this.value=val;
	        }

	    }
	    
	    customElements.define(CustomInput.is, CustomInput);
	    
    </script> 
</dom-module><dom-module id="infinia-select" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		<style>
		/*Select2*/
		.select2-container{box-sizing:border-box;display:inline-block;margin:0;position:relative;vertical-align:middle}.select2-container .select2-selection--single{box-sizing:border-box;cursor:pointer;display:block;height:28px;user-select:none;-webkit-user-select:none}.select2-container .select2-selection--single .select2-selection__rendered{display:block;padding-left:8px;padding-right:20px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.select2-container .select2-selection--single .select2-selection__clear{position:relative}.select2-container[dir="rtl"] .select2-selection--single .select2-selection__rendered{padding-right:8px;padding-left:20px}.select2-container .select2-selection--multiple{box-sizing:border-box;cursor:pointer;display:block;min-height:32px;user-select:none;-webkit-user-select:none}.select2-container .select2-selection--multiple .select2-selection__rendered{display:inline-block;overflow:hidden;padding-left:8px;text-overflow:ellipsis;white-space:nowrap}.select2-container .select2-search--inline{float:left}.select2-container .select2-search--inline .select2-search__field{box-sizing:border-box;border:none;font-size:100%;margin-top:5px;padding:0}.select2-container .select2-search--inline .select2-search__field::-webkit-search-cancel-button{-webkit-appearance:none}.select2-dropdown{background-color:white;border:1px solid #aaa;border-radius:4px;box-sizing:border-box;display:block;position:absolute;left:-100000px;width:100%;z-index:1051}.select2-results{display:block}.select2-results__options{list-style:none;margin:0;padding:0}.select2-results__option{padding:6px;user-select:none;-webkit-user-select:none}.select2-results__option[aria-selected]{cursor:pointer}.select2-container--open .select2-dropdown{left:0}.select2-container--open .select2-dropdown--above{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--open .select2-dropdown--below{border-top:none;border-top-left-radius:0;border-top-right-radius:0}.select2-search--dropdown{display:block;padding:4px}.select2-search--dropdown .select2-search__field{padding:4px;width:100%;box-sizing:border-box}.select2-search--dropdown .select2-search__field::-webkit-search-cancel-button{-webkit-appearance:none}.select2-search--dropdown.select2-search--hide{display:none}.select2-close-mask{border:0;margin:0;padding:0;display:block;position:fixed;left:0;top:0;min-height:100%;min-width:100%;height:auto;width:auto;opacity:0;z-index:99;background-color:#fff;filter:alpha(opacity=0)}.select2-hidden-accessible{border:0 !important;clip:rect(0 0 0 0) !important;height:1px !important;margin:-1px !important;overflow:hidden !important;padding:0 !important;position:absolute !important;width:1px !important}.select2-container--default .select2-selection--single{background-color:#fff;border:1px solid #aaa;border-radius:4px}.select2-container--default .select2-selection--single .select2-selection__rendered{color:#444;line-height:28px}.select2-container--default .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:bold}.select2-container--default .select2-selection--single .select2-selection__placeholder{color:#999}.select2-container--default .select2-selection--single .select2-selection__arrow{height:26px;position:absolute;top:1px;right:1px;width:20px}.select2-container--default .select2-selection--single .select2-selection__arrow b{border-color:#888 transparent transparent transparent;border-style:solid;border-width:5px 4px 0 4px;height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--default[dir="rtl"] .select2-selection--single .select2-selection__clear{float:left}.select2-container--default[dir="rtl"] .select2-selection--single .select2-selection__arrow{left:1px;right:auto}.select2-container--default.select2-container--disabled .select2-selection--single{background-color:#eee;cursor:default}.select2-container--default.select2-container--disabled .select2-selection--single .select2-selection__clear{display:none}.select2-container--default.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent #888 transparent;border-width:0 4px 5px 4px}.select2-container--default .select2-selection--multiple{background-color:white;border:1px solid #aaa;border-radius:4px;cursor:text}.select2-container--default .select2-selection--multiple .select2-selection__rendered{box-sizing:border-box;list-style:none;margin:0;padding:0 5px;width:100%}.select2-container--default .select2-selection--multiple .select2-selection__rendered li{list-style:none}.select2-container--default .select2-selection--multiple .select2-selection__placeholder{color:#999;margin-top:5px;float:left}.select2-container--default .select2-selection--multiple .select2-selection__clear{cursor:pointer;float:right;font-weight:bold;margin-top:5px;margin-right:10px}.select2-container--default .select2-selection--multiple .select2-selection__choice{background-color:#e4e4e4;border:1px solid #aaa;border-radius:4px;cursor:default;float:left;margin-right:5px;margin-top:5px;padding:0 5px}.select2-container--default .select2-selection--multiple .select2-selection__choice__remove{color:#999;cursor:pointer;display:inline-block;font-weight:bold;margin-right:2px}.select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover{color:#333}.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice,.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__placeholder,.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-search--inline{float:right}.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice{margin-left:5px;margin-right:auto}.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice__remove{margin-left:2px;margin-right:auto}.select2-container--default.select2-container--focus .select2-selection--multiple{border:solid black 1px;outline:0}.select2-container--default.select2-container--disabled .select2-selection--multiple{background-color:#eee;cursor:default}.select2-container--default.select2-container--disabled .select2-selection__choice__remove{display:none}.select2-container--default.select2-container--open.select2-container--above .select2-selection--single,.select2-container--default.select2-container--open.select2-container--above .select2-selection--multiple{border-top-left-radius:0;border-top-right-radius:0}.select2-container--default.select2-container--open.select2-container--below .select2-selection--single,.select2-container--default.select2-container--open.select2-container--below .select2-selection--multiple{border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--default .select2-search--dropdown .select2-search__field{border:1px solid #aaa}.select2-container--default .select2-search--inline .select2-search__field{background:transparent;border:none;outline:0;box-shadow:none;-webkit-appearance:textfield}.select2-container--default .select2-results>.select2-results__options{max-height:200px;overflow-y:auto}.select2-container--default .select2-results__option[role=group]{padding:0}.select2-container--default .select2-results__option[aria-disabled=true]{color:#999}.select2-container--default .select2-results__option[aria-selected=true]{background-color:#ddd}.select2-container--default .select2-results__option .select2-results__option{padding-left:1em}.select2-container--default .select2-results__option .select2-results__option .select2-results__group{padding-left:0}.select2-container--default .select2-results__option .select2-results__option .select2-results__option{margin-left:-1em;padding-left:2em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-2em;padding-left:3em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-3em;padding-left:4em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-4em;padding-left:5em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-5em;padding-left:6em}.select2-container--default .select2-results__option--highlighted[aria-selected]{background-color:#5897fb;color:white}.select2-container--default .select2-results__group{cursor:default;display:block;padding:6px}.select2-container--classic .select2-selection--single{background-color:#f7f7f7;border:1px solid #aaa;border-radius:4px;outline:0;background-image:-webkit-linear-gradient(top, #fff 50%, #eee 100%);background-image:-o-linear-gradient(top, #fff 50%, #eee 100%);background-image:linear-gradient(to bottom, #fff 50%, #eee 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFFFFFFF', endColorstr='#FFEEEEEE', GradientType=0)}.select2-container--classic .select2-selection--single:focus{border:1px solid #5897fb}.select2-container--classic .select2-selection--single .select2-selection__rendered{color:#444;line-height:28px}.select2-container--classic .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:bold;margin-right:10px}.select2-container--classic .select2-selection--single .select2-selection__placeholder{color:#999}.select2-container--classic .select2-selection--single .select2-selection__arrow{background-color:#ddd;border:none;border-left:1px solid #aaa;border-top-right-radius:4px;border-bottom-right-radius:4px;height:26px;position:absolute;top:1px;right:1px;width:20px;background-image:-webkit-linear-gradient(top, #eee 50%, #ccc 100%);background-image:-o-linear-gradient(top, #eee 50%, #ccc 100%);background-image:linear-gradient(to bottom, #eee 50%, #ccc 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFEEEEEE', endColorstr='#FFCCCCCC', GradientType=0)}.select2-container--classic .select2-selection--single .select2-selection__arrow b{border-color:#888 transparent transparent transparent;border-style:solid;border-width:5px 4px 0 4px;height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--classic[dir="rtl"] .select2-selection--single .select2-selection__clear{float:left}.select2-container--classic[dir="rtl"] .select2-selection--single .select2-selection__arrow{border:none;border-right:1px solid #aaa;border-radius:0;border-top-left-radius:4px;border-bottom-left-radius:4px;left:1px;right:auto}.select2-container--classic.select2-container--open .select2-selection--single{border:1px solid #5897fb}.select2-container--classic.select2-container--open .select2-selection--single .select2-selection__arrow{background:transparent;border:none}.select2-container--classic.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent #888 transparent;border-width:0 4px 5px 4px}.select2-container--classic.select2-container--open.select2-container--above .select2-selection--single{border-top:none;border-top-left-radius:0;border-top-right-radius:0;background-image:-webkit-linear-gradient(top, #fff 0%, #eee 50%);background-image:-o-linear-gradient(top, #fff 0%, #eee 50%);background-image:linear-gradient(to bottom, #fff 0%, #eee 50%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFFFFFFF', endColorstr='#FFEEEEEE', GradientType=0)}.select2-container--classic.select2-container--open.select2-container--below .select2-selection--single{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0;background-image:-webkit-linear-gradient(top, #eee 50%, #fff 100%);background-image:-o-linear-gradient(top, #eee 50%, #fff 100%);background-image:linear-gradient(to bottom, #eee 50%, #fff 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFEEEEEE', endColorstr='#FFFFFFFF', GradientType=0)}.select2-container--classic .select2-selection--multiple{background-color:white;border:1px solid #aaa;border-radius:4px;cursor:text;outline:0}.select2-container--classic .select2-selection--multiple:focus{border:1px solid #5897fb}.select2-container--classic .select2-selection--multiple .select2-selection__rendered{list-style:none;margin:0;padding:0 5px}.select2-container--classic .select2-selection--multiple .select2-selection__clear{display:none}.select2-container--classic .select2-selection--multiple .select2-selection__choice{background-color:#e4e4e4;border:1px solid #aaa;border-radius:4px;cursor:default;float:left;margin-right:5px;margin-top:5px;padding:0 5px}.select2-container--classic .select2-selection--multiple .select2-selection__choice__remove{color:#888;cursor:pointer;display:inline-block;font-weight:bold;margin-right:2px}.select2-container--classic .select2-selection--multiple .select2-selection__choice__remove:hover{color:#555}.select2-container--classic[dir="rtl"] .select2-selection--multiple .select2-selection__choice{float:right}.select2-container--classic[dir="rtl"] .select2-selection--multiple .select2-selection__choice{margin-left:5px;margin-right:auto}.select2-container--classic[dir="rtl"] .select2-selection--multiple .select2-selection__choice__remove{margin-left:2px;margin-right:auto}.select2-container--classic.select2-container--open .select2-selection--multiple{border:1px solid #5897fb}.select2-container--classic.select2-container--open.select2-container--above .select2-selection--multiple{border-top:none;border-top-left-radius:0;border-top-right-radius:0}.select2-container--classic.select2-container--open.select2-container--below .select2-selection--multiple{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--classic .select2-search--dropdown .select2-search__field{border:1px solid #aaa;outline:0}.select2-container--classic .select2-search--inline .select2-search__field{outline:0;box-shadow:none}.select2-container--classic .select2-dropdown{background-color:#fff;border:1px solid transparent}.select2-container--classic .select2-dropdown--above{border-bottom:none}.select2-container--classic .select2-dropdown--below{border-top:none}.select2-container--classic .select2-results>.select2-results__options{max-height:200px;overflow-y:auto}.select2-container--classic .select2-results__option[role=group]{padding:0}.select2-container--classic .select2-results__option[aria-disabled=true]{color:grey}.select2-container--classic .select2-results__option--highlighted[aria-selected]{background-color:#3875d7;color:#fff}.select2-container--classic .select2-results__group{cursor:default;display:block;padding:6px}.select2-container--classic.select2-container--open .select2-dropdown{border-color:#5897fb}
		
		.container{
			position:relative;
		}

		iron-input, select {
			width:100%;
			background-color:transparent;
		}

		label {
			color:var(--input-label);
			font-size:10px;
		}
		
		
		
		
		.select2-selection--single {
			border:none!important;
			border:1px solid var(--input-border)!important;
			border-radius: 0!important;
			-webkit-appearance: none!important;
			margin-top:5px!important;
			outline:none;
			box-shadow: var(--box-shadow);
		}
		
		.select2-container--default .select2-selection--single .select2-selection__arrow {
			top:6px;
		}
		
		.select2-container .select2-selection--single {
			height:34px;
			padding-top:3px;
			margin-top:0!important;
		}
		
		.select2.select2-container.select2-container--default {
			width:100%!important;
		}
		
		
		.select2-selection--single {
			border:none!important;
			border:1px solid var(--input-border)!important;
			border-radius: 0!important;
			-webkit-appearance: none!important;
			margin-top:5px!important;
			outline:none;
			box-shadow: var(--box-shadow);
		}
		
		 :host(.icon) .select2-selection--single {
			padding-left:50px;
			border:none!important;
			border-radius: 0!important;
			-webkit-appearance: none!important;
			margin-top:5px!important;
			outline:none;
			box-shadow: none;
			background-color:var(--lighter-background);
		}	
		
		:host(.icon) .select2-container--default .select2-selection--single .select2-selection__arrow b {
			border-color: black transparent transparent transparent;
		}
		
		iron-icon.big {
          height:50px;
          width: 50px;
          position:absolute;
          z-index:200;
          top:-10px;
          left:3px;
          color:var(--contrast-color);
        }
        
        .relative {
        	position:relative;
        }
        
        :host(.gold) .select2-container  {
        	border:none!important;
        }
        
        :host(.gold) .select2-selection {
        	border:1px solid var(--primary-color)!important;
        	border-radius:10px!important;
        
        }
        
        :host(.gold) .select2-container .select2-selection--single {
        	height:29px;
        	padding:0;
        }
        
        :host(.gold) .select2-container--default .select2-selection--single .select2-selection__arrow {
        	top:0;
        }
		</style>
		
	<div class="relative">
		<iron-icon icon$="{{icon}}" class="big"></iron-icon>
		<iron-input bind-value="{{value}}">
		<select id="inf-select">
			<option value="">Seleccionar</option>
			<template is="dom-repeat" items="{{options}}" sort="_sort">
				<option value="{{item.id}}">{{item.value}} <template is="dom-if" if="{{item.parentValue}}"> ({{item.parentValue}})</template></option>
			</template>
		</select>
		</iron-input>
	</div>
	</template> 
	<script>
	/*! Select2 4.0.3 | https://github.com/select2/select2/blob/master/LICENSE.md */!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){var b=function(){if(a&&a.fn&&a.fn.select2&&a.fn.select2.amd)var b=a.fn.select2.amd;var b;return function(){if(!b||!b.requirejs){b?c=b:b={};var a,c,d;!function(b){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.slice(0,n.length-1).concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,c){return function(){var d=v.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),n.apply(b,d.concat([a,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var c=r[a];delete r[a],t[a]=!0,m.apply(b,c)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,c,d,f){var h,k,l,m,n,s,u=[],v=typeof d;if(f=f||a,"undefined"===v||"function"===v){for(c=!c.length&&d.length?["require","exports","module"]:c,n=0;n<c.length;n+=1)if(m=o(c[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=d?d.apply(q[a],u):void 0,a&&(h&&h.exports!==b&&h.exports!==q[a]?q[a]=h.exports:l===b&&s||(q[a]=l))}else a&&(q[a]=d)},a=c=n=function(a,c,d,e,f){if("string"==typeof a)return p[a]?p[a](c):j(o(a,c).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(a=c,c=d,d=null):a=b}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(b,a,c,d):setTimeout(function(){m(b,a,c,d)},4),n},n.config=function(a){return n(a)},a._defined=q,d=function(a,b,c){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},d.amd={jQuery:!0}}(),b.requirejs=a,b.require=c,b.define=d}}(),b.define("almond",function(){}),b.define("jquery",[],function(){var b=a||$;return null==b&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),b}),b.define("select2/utils",["jquery"],function(a){function b(a){var b=a.prototype,c=[];for(var d in b){var e=b[d];"function"==typeof e&&"constructor"!==d&&c.push(d)}return c}var c={};c.Extend=function(a,b){function c(){this.constructor=a}var d={}.hasOwnProperty;for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},c.Decorate=function(a,c){function d(){var b=Array.prototype.unshift,d=c.prototype.constructor.length,e=a.prototype.constructor;d>0&&(b.call(arguments,a.prototype.constructor),e=c.prototype.constructor),e.apply(this,arguments)}function e(){this.constructor=d}var f=b(c),g=b(a);c.displayName=a.displayName,d.prototype=new e;for(var h=0;h<g.length;h++){var i=g[h];d.prototype[i]=a.prototype[i]}for(var j=(function(a){var b=function(){};a in d.prototype&&(b=d.prototype[a]);var e=c.prototype[a];return function(){var a=Array.prototype.unshift;return a.call(arguments,b),e.apply(this,arguments)}}),k=0;k<f.length;k++){var l=f[k];d.prototype[l]=j(l)}return d};var d=function(){this.listeners={}};return d.prototype.on=function(a,b){this.listeners=this.listeners||{},a in this.listeners?this.listeners[a].push(b):this.listeners[a]=[b]},d.prototype.trigger=function(a){var b=Array.prototype.slice,c=b.call(arguments,1);this.listeners=this.listeners||{},null==c&&(c=[]),0===c.length&&c.push({}),c[0]._type=a,a in this.listeners&&this.invoke(this.listeners[a],b.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},d.prototype.invoke=function(a,b){for(var c=0,d=a.length;d>c;c++)a[c].apply(this,b)},c.Observable=d,c.generateChars=function(a){for(var b="",c=0;a>c;c++){var d=Math.floor(36*Math.random());b+=d.toString(36)}return b},c.bind=function(a,b){return function(){a.apply(b,arguments)}},c._convertData=function(a){for(var b in a){var c=b.split("-"),d=a;if(1!==c.length){for(var e=0;e<c.length;e++){var f=c[e];f=f.substring(0,1).toLowerCase()+f.substring(1),f in d||(d[f]={}),e==c.length-1&&(d[f]=a[b]),d=d[f]}delete a[b]}}return a},c.hasScroll=function(b,c){var d=a(c),e=c.style.overflowX,f=c.style.overflowY;return e!==f||"hidden"!==f&&"visible"!==f?"scroll"===e||"scroll"===f?!0:d.innerHeight()<c.scrollHeight||d.innerWidth()<c.scrollWidth:!1},c.escapeMarkup=function(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof a?a:String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})},c.appendMany=function(b,c){if("1.7"===a.fn.jquery.substr(0,3)){var d=a();a.map(c,function(a){d=d.add(a)}),c=d}b.append(c)},c}),b.define("select2/results",["jquery","./utils"],function(a,b){function c(a,b,d){this.$element=a,this.data=d,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<ul class="select2-results__options" role="tree"></ul>');return this.options.get("multiple")&&b.attr("aria-multiselectable","true"),this.$results=b,b},c.prototype.clear=function(){this.$results.empty()},c.prototype.displayMessage=function(b){var c=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var d=a('<li role="treeitem" aria-live="assertive" class="select2-results__option"></li>'),e=this.options.get("translations").get(b.message);d.append(c(e(b.args))),d[0].className+=" select2-results__message",this.$results.append(d)},c.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},c.prototype.append=function(a){this.hideLoading();var b=[];if(null==a.results||0===a.results.length)return void(0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"}));a.results=this.sort(a.results);for(var c=0;c<a.results.length;c++){var d=a.results[c],e=this.option(d);b.push(e)}this.$results.append(b)},c.prototype.position=function(a,b){var c=b.find(".select2-results");c.append(a)},c.prototype.sort=function(a){var b=this.options.get("sorter");return b(a)},c.prototype.highlightFirstItem=function(){var a=this.$results.find(".select2-results__option[aria-selected]"),b=a.filter("[aria-selected=true]");b.length>0?b.first().trigger("mouseenter"):a.first().trigger("mouseenter"),this.ensureHighlightVisible()},c.prototype.setClasses=function(){var b=this;this.data.current(function(c){var d=a.map(c,function(a){return a.id.toString()}),e=b.$results.find(".select2-results__option[aria-selected]");e.each(function(){var b=a(this),c=a.data(this,"data"),e=""+c.id;null!=c.element&&c.element.selected||null==c.element&&a.inArray(e,d)>-1?b.attr("aria-selected","true"):b.attr("aria-selected","false")})})},c.prototype.showLoading=function(a){this.hideLoading();var b=this.options.get("translations").get("searching"),c={disabled:!0,loading:!0,text:b(a)},d=this.option(c);d.className+=" loading-results",this.$results.prepend(d)},c.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},c.prototype.option=function(b){var c=document.createElement("li");c.className="select2-results__option";var d={role:"treeitem","aria-selected":"false"};b.disabled&&(delete d["aria-selected"],d["aria-disabled"]="true"),null==b.id&&delete d["aria-selected"],null!=b._resultId&&(c.id=b._resultId),b.title&&(c.title=b.title),b.children&&(d.role="group",d["aria-label"]=b.text,delete d["aria-selected"]);for(var e in d){var f=d[e];c.setAttribute(e,f)}if(b.children){var g=a(c),h=document.createElement("strong");h.className="select2-results__group";a(h);this.template(b,h);for(var i=[],j=0;j<b.children.length;j++){var k=b.children[j],l=this.option(k);i.push(l)}var m=a("<ul></ul>",{"class":"select2-results__options select2-results__options--nested"});m.append(i),g.append(h),g.append(m)}else this.template(b,c);return a.data(c,"data",b),c},c.prototype.bind=function(b,c){var d=this,e=b.id+"-results";this.$results.attr("id",e),b.on("results:all",function(a){d.clear(),d.append(a.data),b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("results:append",function(a){d.append(a.data),b.isOpen()&&d.setClasses()}),b.on("query",function(a){d.hideMessages(),d.showLoading(a)}),b.on("select",function(){b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("unselect",function(){b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("open",function(){d.$results.attr("aria-expanded","true"),d.$results.attr("aria-hidden","false"),d.setClasses(),d.ensureHighlightVisible()}),b.on("close",function(){d.$results.attr("aria-expanded","false"),d.$results.attr("aria-hidden","true"),d.$results.removeAttr("aria-activedescendant")}),b.on("results:toggle",function(){var a=d.getHighlightedResults();0!==a.length&&a.trigger("mouseup")}),b.on("results:select",function(){var a=d.getHighlightedResults();if(0!==a.length){var b=a.data("data");"true"==a.attr("aria-selected")?d.trigger("close",{}):d.trigger("select",{data:b})}}),b.on("results:previous",function(){var a=d.getHighlightedResults(),b=d.$results.find("[aria-selected]"),c=b.index(a);if(0!==c){var e=c-1;0===a.length&&(e=0);var f=b.eq(e);f.trigger("mouseenter");var g=d.$results.offset().top,h=f.offset().top,i=d.$results.scrollTop()+(h-g);0===e?d.$results.scrollTop(0):0>h-g&&d.$results.scrollTop(i)}}),b.on("results:next",function(){var a=d.getHighlightedResults(),b=d.$results.find("[aria-selected]"),c=b.index(a),e=c+1;if(!(e>=b.length)){var f=b.eq(e);f.trigger("mouseenter");var g=d.$results.offset().top+d.$results.outerHeight(!1),h=f.offset().top+f.outerHeight(!1),i=d.$results.scrollTop()+h-g;0===e?d.$results.scrollTop(0):h>g&&d.$results.scrollTop(i)}}),b.on("results:focus",function(a){a.element.addClass("select2-results__option--highlighted")}),b.on("results:message",function(a){d.displayMessage(a)}),a.fn.mousewheel&&this.$results.on("mousewheel",function(a){var b=d.$results.scrollTop(),c=d.$results.get(0).scrollHeight-b+a.deltaY,e=a.deltaY>0&&b-a.deltaY<=0,f=a.deltaY<0&&c<=d.$results.height();e?(d.$results.scrollTop(0),a.preventDefault(),a.stopPropagation()):f&&(d.$results.scrollTop(d.$results.get(0).scrollHeight-d.$results.height()),a.preventDefault(),a.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(b){var c=a(this),e=c.data("data");return"true"===c.attr("aria-selected")?void(d.options.get("multiple")?d.trigger("unselect",{originalEvent:b,data:e}):d.trigger("close",{})):void d.trigger("select",{originalEvent:b,data:e})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(b){var c=a(this).data("data");d.getHighlightedResults().removeClass("select2-results__option--highlighted"),d.trigger("results:focus",{data:c,element:a(this)})})},c.prototype.getHighlightedResults=function(){var a=this.$results.find(".select2-results__option--highlighted");return a},c.prototype.destroy=function(){this.$results.remove()},c.prototype.ensureHighlightVisible=function(){var a=this.getHighlightedResults();if(0!==a.length){var b=this.$results.find("[aria-selected]"),c=b.index(a),d=this.$results.offset().top,e=a.offset().top,f=this.$results.scrollTop()+(e-d),g=e-d;f-=2*a.outerHeight(!1),2>=c?this.$results.scrollTop(0):(g>this.$results.outerHeight()||0>g)&&this.$results.scrollTop(f)}},c.prototype.template=function(b,c){var d=this.options.get("templateResult"),e=this.options.get("escapeMarkup"),f=d(b,c);null==f?c.style.display="none":"string"==typeof f?c.innerHTML=e(f):a(c).append(f)},c}),b.define("select2/keys",[],function(){var a={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46};return a}),b.define("select2/selection/base",["jquery","../utils","../keys"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,b.Observable),d.prototype.render=function(){var b=a('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=this.$element.data("old-tabindex")?this._tabindex=this.$element.data("old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),b.attr("title",this.$element.attr("title")),b.attr("tabindex",this._tabindex),this.$selection=b,b},d.prototype.bind=function(a,b){var d=this,e=(a.id+"-container",a.id+"-results");this.container=a,this.$selection.on("focus",function(a){d.trigger("focus",a)}),this.$selection.on("blur",function(a){d._handleBlur(a)}),this.$selection.on("keydown",function(a){d.trigger("keypress",a),a.which===c.SPACE&&a.preventDefault()}),a.on("results:focus",function(a){d.$selection.attr("aria-activedescendant",a.data._resultId)}),a.on("selection:update",function(a){d.update(a.data)}),a.on("open",function(){d.$selection.attr("aria-expanded","true"),d.$selection.attr("aria-owns",e),d._attachCloseHandler(a)}),a.on("close",function(){d.$selection.attr("aria-expanded","false"),d.$selection.removeAttr("aria-activedescendant"),d.$selection.removeAttr("aria-owns"),d.$selection.focus(),d._detachCloseHandler(a)}),a.on("enable",function(){d.$selection.attr("tabindex",d._tabindex)}),a.on("disable",function(){d.$selection.attr("tabindex","-1")})},d.prototype._handleBlur=function(b){var c=this;window.setTimeout(function(){document.activeElement==c.$selection[0]||a.contains(c.$selection[0],document.activeElement)||c.trigger("blur",b)},1)},d.prototype._attachCloseHandler=function(b){a(document.body).on("mousedown.select2."+b.id,function(b){var c=a(b.target),d=c.closest(".select2"),e=a(".select2.select2-container--open");e.each(function(){var b=a(this);if(this!=d[0]){var c=b.data("element");c.select2("close")}})})},d.prototype._detachCloseHandler=function(b){a(document.body).off("mousedown.select2."+b.id)},d.prototype.position=function(a,b){var c=b.find(".selection");c.append(a)},d.prototype.destroy=function(){this._detachCloseHandler(this.container)},d.prototype.update=function(a){throw new Error("The `update` method must be defined in child classes.")},d}),b.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(a,b,c,d){function e(){e.__super__.constructor.apply(this,arguments)}return c.Extend(e,b),e.prototype.render=function(){var a=e.__super__.render.call(this);return a.addClass("select2-selection--single"),a.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),a},e.prototype.bind=function(a,b){var c=this;e.__super__.bind.apply(this,arguments);var d=a.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",d),this.$selection.attr("aria-labelledby",d),this.$selection.on("mousedown",function(a){1===a.which&&c.trigger("toggle",{originalEvent:a})}),this.$selection.on("focus",function(a){}),this.$selection.on("blur",function(a){}),a.on("focus",function(b){a.isOpen()||c.$selection.focus()}),a.on("selection:update",function(a){c.update(a.data)})},e.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},e.prototype.display=function(a,b){var c=this.options.get("templateSelection"),d=this.options.get("escapeMarkup");return d(c(a,b))},e.prototype.selectionContainer=function(){return a("<span></span>")},e.prototype.update=function(a){if(0===a.length)return void this.clear();var b=a[0],c=this.$selection.find(".select2-selection__rendered"),d=this.display(b,c);c.empty().append(d),c.prop("title",b.title||b.text)},e}),b.define("select2/selection/multiple",["jquery","./base","../utils"],function(a,b,c){function d(a,b){d.__super__.constructor.apply(this,arguments)}return c.Extend(d,b),d.prototype.render=function(){var a=d.__super__.render.call(this);return a.addClass("select2-selection--multiple"),a.html('<ul class="select2-selection__rendered"></ul>'),a},d.prototype.bind=function(b,c){var e=this;d.__super__.bind.apply(this,arguments),this.$selection.on("click",function(a){e.trigger("toggle",{originalEvent:a})}),this.$selection.on("click",".select2-selection__choice__remove",function(b){if(!e.options.get("disabled")){var c=a(this),d=c.parent(),f=d.data("data");e.trigger("unselect",{originalEvent:b,data:f})}})},d.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},d.prototype.display=function(a,b){var c=this.options.get("templateSelection"),d=this.options.get("escapeMarkup");return d(c(a,b))},d.prototype.selectionContainer=function(){var b=a('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>');return b},d.prototype.update=function(a){if(this.clear(),0!==a.length){for(var b=[],d=0;d<a.length;d++){var e=a[d],f=this.selectionContainer(),g=this.display(e,f);f.append(g),f.prop("title",e.title||e.text),f.data("data",e),b.push(f)}var h=this.$selection.find(".select2-selection__rendered");c.appendMany(h,b)}},d}),b.define("select2/selection/placeholder",["../utils"],function(a){function b(a,b,c){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c)}return b.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},b.prototype.createPlaceholder=function(a,b){var c=this.selectionContainer();return c.html(this.display(b)),c.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),c},b.prototype.update=function(a,b){var c=1==b.length&&b[0].id!=this.placeholder.id,d=b.length>1;if(d||c)return a.call(this,b);this.clear();var e=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(e)},b}),b.define("select2/selection/allowClear",["jquery","../keys"],function(a,b){function c(){}return c.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(a){d._handleClear(a)}),b.on("keypress",function(a){d._handleKeyboardClear(a,b)})},c.prototype._handleClear=function(a,b){if(!this.options.get("disabled")){var c=this.$selection.find(".select2-selection__clear");if(0!==c.length){b.stopPropagation();for(var d=c.data("data"),e=0;e<d.length;e++){var f={data:d[e]};if(this.trigger("unselect",f),f.prevented)return}this.$element.val(this.placeholder.id).trigger("change"),this.trigger("toggle",{})}}},c.prototype._handleKeyboardClear=function(a,c,d){d.isOpen()||(c.which==b.DELETE||c.which==b.BACKSPACE)&&this._handleClear(c)},c.prototype.update=function(b,c){if(b.call(this,c),!(this.$selection.find(".select2-selection__placeholder").length>0||0===c.length)){var d=a('<span class="select2-selection__clear">&times;</span>');d.data("data",c),this.$selection.find(".select2-selection__rendered").prepend(d)}},c}),b.define("select2/selection/search",["jquery","../utils","../keys"],function(a,b,c){function d(a,b,c){a.call(this,b,c)}return d.prototype.render=function(b){var c=a('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" /></li>');this.$searchContainer=c,this.$search=c.find("input");var d=b.call(this);return this._transferTabIndex(),d},d.prototype.bind=function(a,b,d){var e=this;a.call(this,b,d),b.on("open",function(){e.$search.trigger("focus")}),b.on("close",function(){e.$search.val(""),e.$search.removeAttr("aria-activedescendant"),e.$search.trigger("focus")}),b.on("enable",function(){e.$search.prop("disabled",!1),e._transferTabIndex()}),b.on("disable",function(){e.$search.prop("disabled",!0)}),b.on("focus",function(a){e.$search.trigger("focus")}),b.on("results:focus",function(a){e.$search.attr("aria-activedescendant",a.id)}),this.$selection.on("focusin",".select2-search--inline",function(a){e.trigger("focus",a)}),this.$selection.on("focusout",".select2-search--inline",function(a){e._handleBlur(a)}),this.$selection.on("keydown",".select2-search--inline",function(a){a.stopPropagation(),e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented();var b=a.which;if(b===c.BACKSPACE&&""===e.$search.val()){var d=e.$searchContainer.prev(".select2-selection__choice");if(d.length>0){var f=d.data("data");e.searchRemoveChoice(f),a.preventDefault()}}});var f=document.documentMode,g=f&&11>=f;this.$selection.on("input.searchcheck",".select2-search--inline",function(a){return g?void e.$selection.off("input.search input.searchcheck"):void e.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(a){if(g&&"input"===a.type)return void e.$selection.off("input.search input.searchcheck");var b=a.which;b!=c.SHIFT&&b!=c.CTRL&&b!=c.ALT&&b!=c.TAB&&e.handleSearch(a)})},d.prototype._transferTabIndex=function(a){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},d.prototype.createPlaceholder=function(a,b){this.$search.attr("placeholder",b.text)},d.prototype.update=function(a,b){var c=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),a.call(this,b),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),c&&this.$search.focus()},d.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var a=this.$search.val();this.trigger("query",{term:a})}this._keyUpPrevented=!1},d.prototype.searchRemoveChoice=function(a,b){this.trigger("unselect",{data:b}),this.$search.val(b.text),this.handleSearch()},d.prototype.resizeSearch=function(){this.$search.css("width","25px");var a="";if(""!==this.$search.attr("placeholder"))a=this.$selection.find(".select2-selection__rendered").innerWidth();else{var b=this.$search.val().length+1;a=.75*b+"em"}this.$search.css("width",a)},d}),b.define("select2/selection/eventRelay",["jquery"],function(a){function b(){}return b.prototype.bind=function(b,c,d){var e=this,f=["open","opening","close","closing","select","selecting","unselect","unselecting"],g=["opening","closing","selecting","unselecting"];b.call(this,c,d),c.on("*",function(b,c){if(-1!==a.inArray(b,f)){c=c||{};var d=a.Event("select2:"+b,{params:c});e.$element.trigger(d),-1!==a.inArray(b,g)&&(c.prevented=d.isDefaultPrevented())}})},b}),b.define("select2/translation",["jquery","require"],function(a,b){function c(a){this.dict=a||{}}return c.prototype.all=function(){return this.dict},c.prototype.get=function(a){return this.dict[a]},c.prototype.extend=function(b){this.dict=a.extend({},b.all(),this.dict)},c._cache={},c.loadPath=function(a){if(!(a in c._cache)){var d=b(a);c._cache[a]=d}return new c(c._cache[a])},c}),b.define("select2/diacritics",[],function(){var a={"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"Dz","":"Dz","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"F","":"F","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"J","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"Lj","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"Nj","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OI","":"OO","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"Q","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oi","":"ou","":"oo","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};return a}),b.define("select2/data/base",["../utils"],function(a){function b(a,c){b.__super__.constructor.call(this)}return a.Extend(b,a.Observable),b.prototype.current=function(a){throw new Error("The `current` method must be defined in child classes.")},b.prototype.query=function(a,b){throw new Error("The `query` method must be defined in child classes.")},b.prototype.bind=function(a,b){},b.prototype.destroy=function(){},b.prototype.generateResultId=function(b,c){var d=b.id+"-result-";return d+=a.generateChars(4),d+=null!=c.id?"-"+c.id.toString():"-"+a.generateChars(4)},b}),b.define("select2/data/select",["./base","../utils","jquery"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,a),d.prototype.current=function(a){var b=[],d=this;this.$element.find(":selected").each(function(){var a=c(this),e=d.item(a);b.push(e)}),a(b)},d.prototype.select=function(a){var b=this;if(a.selected=!0,c(a.element).is("option"))return a.element.selected=!0,void this.$element.trigger("change");
	if(this.$element.prop("multiple"))this.current(function(d){var e=[];a=[a],a.push.apply(a,d);for(var f=0;f<a.length;f++){var g=a[f].id;-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")});else{var d=a.id;this.$element.val(d),this.$element.trigger("change")}},d.prototype.unselect=function(a){var b=this;if(this.$element.prop("multiple"))return a.selected=!1,c(a.element).is("option")?(a.element.selected=!1,void this.$element.trigger("change")):void this.current(function(d){for(var e=[],f=0;f<d.length;f++){var g=d[f].id;g!==a.id&&-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")})},d.prototype.bind=function(a,b){var c=this;this.container=a,a.on("select",function(a){c.select(a.data)}),a.on("unselect",function(a){c.unselect(a.data)})},d.prototype.destroy=function(){this.$element.find("*").each(function(){c.removeData(this,"data")})},d.prototype.query=function(a,b){var d=[],e=this,f=this.$element.children();f.each(function(){var b=c(this);if(b.is("option")||b.is("optgroup")){var f=e.item(b),g=e.matches(a,f);null!==g&&d.push(g)}}),b({results:d})},d.prototype.addOptions=function(a){b.appendMany(this.$element,a)},d.prototype.option=function(a){var b;a.children?(b=document.createElement("optgroup"),b.label=a.text):(b=document.createElement("option"),void 0!==b.textContent?b.textContent=a.text:b.innerText=a.text),a.id&&(b.value=a.id),a.disabled&&(b.disabled=!0),a.selected&&(b.selected=!0),a.title&&(b.title=a.title);var d=c(b),e=this._normalizeItem(a);return e.element=b,c.data(b,"data",e),d},d.prototype.item=function(a){var b={};if(b=c.data(a[0],"data"),null!=b)return b;if(a.is("option"))b={id:a.val(),text:a.text(),disabled:a.prop("disabled"),selected:a.prop("selected"),title:a.prop("title")};else if(a.is("optgroup")){b={text:a.prop("label"),children:[],title:a.prop("title")};for(var d=a.children("option"),e=[],f=0;f<d.length;f++){var g=c(d[f]),h=this.item(g);e.push(h)}b.children=e}return b=this._normalizeItem(b),b.element=a[0],c.data(a[0],"data",b),b},d.prototype._normalizeItem=function(a){c.isPlainObject(a)||(a={id:a,text:a}),a=c.extend({},{text:""},a);var b={selected:!1,disabled:!1};return null!=a.id&&(a.id=a.id.toString()),null!=a.text&&(a.text=a.text.toString()),null==a._resultId&&a.id&&null!=this.container&&(a._resultId=this.generateResultId(this.container,a)),c.extend({},b,a)},d.prototype.matches=function(a,b){var c=this.options.get("matcher");return c(a,b)},d}),b.define("select2/data/array",["./select","../utils","jquery"],function(a,b,c){function d(a,b){var c=b.get("data")||[];d.__super__.constructor.call(this,a,b),this.addOptions(this.convertToOptions(c))}return b.Extend(d,a),d.prototype.select=function(a){var b=this.$element.find("option").filter(function(b,c){return c.value==a.id.toString()});0===b.length&&(b=this.option(a),this.addOptions(b)),d.__super__.select.call(this,a)},d.prototype.convertToOptions=function(a){function d(a){return function(){return c(this).val()==a.id}}for(var e=this,f=this.$element.find("option"),g=f.map(function(){return e.item(c(this)).id}).get(),h=[],i=0;i<a.length;i++){var j=this._normalizeItem(a[i]);if(c.inArray(j.id,g)>=0){var k=f.filter(d(j)),l=this.item(k),m=c.extend(!0,{},j,l),n=this.option(m);k.replaceWith(n)}else{var o=this.option(j);if(j.children){var p=this.convertToOptions(j.children);b.appendMany(o,p)}h.push(o)}}return h},d}),b.define("select2/data/ajax",["./array","../utils","jquery"],function(a,b,c){function d(a,b){this.ajaxOptions=this._applyDefaults(b.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),d.__super__.constructor.call(this,a,b)}return b.Extend(d,a),d.prototype._applyDefaults=function(a){var b={data:function(a){return c.extend({},a,{q:a.term})},transport:function(a,b,d){var e=c.ajax(a);return e.then(b),e.fail(d),e}};return c.extend({},b,a,!0)},d.prototype.processResults=function(a){return a},d.prototype.query=function(a,b){function d(){var d=f.transport(f,function(d){var f=e.processResults(d,a);e.options.get("debug")&&window.console&&console.error&&(f&&f.results&&c.isArray(f.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),b(f)},function(){d.status&&"0"===d.status||e.trigger("results:message",{message:"errorLoading"})});e._request=d}var e=this;null!=this._request&&(c.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var f=c.extend({type:"GET"},this.ajaxOptions);"function"==typeof f.url&&(f.url=f.url.call(this.$element,a)),"function"==typeof f.data&&(f.data=f.data.call(this.$element,a)),this.ajaxOptions.delay&&null!=a.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(d,this.ajaxOptions.delay)):d()},d}),b.define("select2/data/tags",["jquery"],function(a){function b(b,c,d){var e=d.get("tags"),f=d.get("createTag");void 0!==f&&(this.createTag=f);var g=d.get("insertTag");if(void 0!==g&&(this.insertTag=g),b.call(this,c,d),a.isArray(e))for(var h=0;h<e.length;h++){var i=e[h],j=this._normalizeItem(i),k=this.option(j);this.$element.append(k)}}return b.prototype.query=function(a,b,c){function d(a,f){for(var g=a.results,h=0;h<g.length;h++){var i=g[h],j=null!=i.children&&!d({results:i.children},!0),k=i.text===b.term;if(k||j)return f?!1:(a.data=g,void c(a))}if(f)return!0;var l=e.createTag(b);if(null!=l){var m=e.option(l);m.attr("data-select2-tag",!0),e.addOptions([m]),e.insertTag(g,l)}a.results=g,c(a)}var e=this;return this._removeOldTags(),null==b.term||null!=b.page?void a.call(this,b,c):void a.call(this,b,d)},b.prototype.createTag=function(b,c){var d=a.trim(c.term);return""===d?null:{id:d,text:d}},b.prototype.insertTag=function(a,b,c){b.unshift(c)},b.prototype._removeOldTags=function(b){var c=(this._lastTag,this.$element.find("option[data-select2-tag]"));c.each(function(){this.selected||a(this).remove()})},b}),b.define("select2/data/tokenizer",["jquery"],function(a){function b(a,b,c){var d=c.get("tokenizer");void 0!==d&&(this.tokenizer=d),a.call(this,b,c)}return b.prototype.bind=function(a,b,c){a.call(this,b,c),this.$search=b.dropdown.$search||b.selection.$search||c.find(".select2-search__field")},b.prototype.query=function(b,c,d){function e(b){var c=g._normalizeItem(b),d=g.$element.find("option").filter(function(){return a(this).val()===c.id});if(!d.length){var e=g.option(c);e.attr("data-select2-tag",!0),g._removeOldTags(),g.addOptions([e])}f(c)}function f(a){g.trigger("select",{data:a})}var g=this;c.term=c.term||"";var h=this.tokenizer(c,this.options,e);h.term!==c.term&&(this.$search.length&&(this.$search.val(h.term),this.$search.focus()),c.term=h.term),b.call(this,c,d)},b.prototype.tokenizer=function(b,c,d,e){for(var f=d.get("tokenSeparators")||[],g=c.term,h=0,i=this.createTag||function(a){return{id:a.term,text:a.term}};h<g.length;){var j=g[h];if(-1!==a.inArray(j,f)){var k=g.substr(0,h),l=a.extend({},c,{term:k}),m=i(l);null!=m?(e(m),g=g.substr(h+1)||"",h=0):h++}else h++}return{term:g}},b}),b.define("select2/data/minimumInputLength",[],function(){function a(a,b,c){this.minimumInputLength=c.get("minimumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){return b.term=b.term||"",b.term.length<this.minimumInputLength?void this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:b.term,params:b}}):void a.call(this,b,c)},a}),b.define("select2/data/maximumInputLength",[],function(){function a(a,b,c){this.maximumInputLength=c.get("maximumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){return b.term=b.term||"",this.maximumInputLength>0&&b.term.length>this.maximumInputLength?void this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:b.term,params:b}}):void a.call(this,b,c)},a}),b.define("select2/data/maximumSelectionLength",[],function(){function a(a,b,c){this.maximumSelectionLength=c.get("maximumSelectionLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){var d=this;this.current(function(e){var f=null!=e?e.length:0;return d.maximumSelectionLength>0&&f>=d.maximumSelectionLength?void d.trigger("results:message",{message:"maximumSelected",args:{maximum:d.maximumSelectionLength}}):void a.call(d,b,c)})},a}),b.define("select2/dropdown",["jquery","./utils"],function(a,b){function c(a,b){this.$element=a,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<span class="select2-dropdown"><span class="select2-results"></span></span>');return b.attr("dir",this.options.get("dir")),this.$dropdown=b,b},c.prototype.bind=function(){},c.prototype.position=function(a,b){},c.prototype.destroy=function(){this.$dropdown.remove()},c}),b.define("select2/dropdown/search",["jquery","../utils"],function(a,b){function c(){}return c.prototype.render=function(b){var c=b.call(this),d=a('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" /></span>');return this.$searchContainer=d,this.$search=d.find("input"),c.prepend(d),c},c.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),this.$search.on("keydown",function(a){e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented()}),this.$search.on("input",function(b){a(this).off("keyup")}),this.$search.on("keyup input",function(a){e.handleSearch(a)}),c.on("open",function(){e.$search.attr("tabindex",0),e.$search.focus(),window.setTimeout(function(){e.$search.focus()},0)}),c.on("close",function(){e.$search.attr("tabindex",-1),e.$search.val("")}),c.on("focus",function(){c.isOpen()&&e.$search.focus()}),c.on("results:all",function(a){if(null==a.query.term||""===a.query.term){var b=e.showSearch(a);b?e.$searchContainer.removeClass("select2-search--hide"):e.$searchContainer.addClass("select2-search--hide")}})},c.prototype.handleSearch=function(a){if(!this._keyUpPrevented){var b=this.$search.val();this.trigger("query",{term:b})}this._keyUpPrevented=!1},c.prototype.showSearch=function(a,b){return!0},c}),b.define("select2/dropdown/hidePlaceholder",[],function(){function a(a,b,c,d){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c,d)}return a.prototype.append=function(a,b){b.results=this.removePlaceholder(b.results),a.call(this,b)},a.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},a.prototype.removePlaceholder=function(a,b){for(var c=b.slice(0),d=b.length-1;d>=0;d--){var e=b[d];this.placeholder.id===e.id&&c.splice(d,1)}return c},a}),b.define("select2/dropdown/infiniteScroll",["jquery"],function(a){function b(a,b,c,d){this.lastParams={},a.call(this,b,c,d),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return b.prototype.append=function(a,b){this.$loadingMore.remove(),this.loading=!1,a.call(this,b),this.showLoadingMore(b)&&this.$results.append(this.$loadingMore)},b.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),c.on("query",function(a){e.lastParams=a,e.loading=!0}),c.on("query:append",function(a){e.lastParams=a,e.loading=!0}),this.$results.on("scroll",function(){var b=a.contains(document.documentElement,e.$loadingMore[0]);if(!e.loading&&b){var c=e.$results.offset().top+e.$results.outerHeight(!1),d=e.$loadingMore.offset().top+e.$loadingMore.outerHeight(!1);c+50>=d&&e.loadMore()}})},b.prototype.loadMore=function(){this.loading=!0;var b=a.extend({},{page:1},this.lastParams);b.page++,this.trigger("query:append",b)},b.prototype.showLoadingMore=function(a,b){return b.pagination&&b.pagination.more},b.prototype.createLoadingMore=function(){var b=a('<li class="select2-results__option select2-results__option--load-more"role="treeitem" aria-disabled="true"></li>'),c=this.options.get("translations").get("loadingMore");return b.html(c(this.lastParams)),b},b}),b.define("select2/dropdown/attachBody",["jquery","../utils"],function(a,b){function c(b,c,d){this.$dropdownParent=d.get("dropdownParent")||a(document.body),b.call(this,c,d)}return c.prototype.bind=function(a,b,c){var d=this,e=!1;a.call(this,b,c),b.on("open",function(){d._showDropdown(),d._attachPositioningHandler(b),e||(e=!0,b.on("results:all",function(){d._positionDropdown(),d._resizeDropdown()}),b.on("results:append",function(){d._positionDropdown(),d._resizeDropdown()}))}),b.on("close",function(){d._hideDropdown(),d._detachPositioningHandler(b)}),this.$dropdownContainer.on("mousedown",function(a){a.stopPropagation()})},c.prototype.destroy=function(a){a.call(this),this.$dropdownContainer.remove()},c.prototype.position=function(a,b,c){b.attr("class",c.attr("class")),b.removeClass("select2"),b.addClass("select2-container--open"),b.css({position:"absolute",top:-999999}),this.$container=c},c.prototype.render=function(b){var c=a("<span></span>"),d=b.call(this);return c.append(d),this.$dropdownContainer=c,c},c.prototype._hideDropdown=function(a){this.$dropdownContainer.detach()},c.prototype._attachPositioningHandler=function(c,d){var e=this,f="scroll.select2."+d.id,g="resize.select2."+d.id,h="orientationchange.select2."+d.id,i=this.$container.parents().filter(b.hasScroll);i.each(function(){a(this).data("select2-scroll-position",{x:a(this).scrollLeft(),y:a(this).scrollTop()})}),i.on(f,function(b){var c=a(this).data("select2-scroll-position");a(this).scrollTop(c.y)}),a(window).on(f+" "+g+" "+h,function(a){e._positionDropdown(),e._resizeDropdown()})},c.prototype._detachPositioningHandler=function(c,d){var e="scroll.select2."+d.id,f="resize.select2."+d.id,g="orientationchange.select2."+d.id,h=this.$container.parents().filter(b.hasScroll);h.off(e),a(window).off(e+" "+f+" "+g)},c.prototype._positionDropdown=function(){var b=a(window),c=this.$dropdown.hasClass("select2-dropdown--above"),d=this.$dropdown.hasClass("select2-dropdown--below"),e=null,f=this.$container.offset();f.bottom=f.top+this.$container.outerHeight(!1);var g={height:this.$container.outerHeight(!1)};g.top=f.top,g.bottom=f.top+g.height;var h={height:this.$dropdown.outerHeight(!1)},i={top:b.scrollTop(),bottom:b.scrollTop()+b.height()},j=i.top<f.top-h.height,k=i.bottom>f.bottom+h.height,l={left:f.left,top:g.bottom},m=this.$dropdownParent;"static"===m.css("position")&&(m=m.offsetParent());var n=m.offset();l.top-=n.top,l.left-=n.left,c||d||(e="below"),k||!j||c?!j&&k&&c&&(e="below"):e="above",("above"==e||c&&"below"!==e)&&(l.top=g.top-n.top-h.height),null!=e&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+e),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+e)),this.$dropdownContainer.css(l)},c.prototype._resizeDropdown=function(){var a={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(a.minWidth=a.width,a.position="relative",a.width="auto"),this.$dropdown.css(a)},c.prototype._showDropdown=function(a){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},c}),b.define("select2/dropdown/minimumResultsForSearch",[],function(){function a(b){for(var c=0,d=0;d<b.length;d++){var e=b[d];e.children?c+=a(e.children):c++}return c}function b(a,b,c,d){this.minimumResultsForSearch=c.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),a.call(this,b,c,d)}return b.prototype.showSearch=function(b,c){return a(c.data.results)<this.minimumResultsForSearch?!1:b.call(this,c)},b}),b.define("select2/dropdown/selectOnClose",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("close",function(a){d._handleSelectOnClose(a)})},a.prototype._handleSelectOnClose=function(a,b){if(b&&null!=b.originalSelect2Event){var c=b.originalSelect2Event;if("select"===c._type||"unselect"===c._type)return}var d=this.getHighlightedResults();if(!(d.length<1)){var e=d.data("data");null!=e.element&&e.element.selected||null==e.element&&e.selected||this.trigger("select",{data:e})}},a}),b.define("select2/dropdown/closeOnSelect",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("select",function(a){d._selectTriggered(a)}),b.on("unselect",function(a){d._selectTriggered(a)})},a.prototype._selectTriggered=function(a,b){var c=b.originalEvent;c&&c.ctrlKey||this.trigger("close",{originalEvent:c,originalSelect2Event:b})},a}),b.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(a){var b=a.input.length-a.maximum,c="Please delete "+b+" character";return 1!=b&&(c+="s"),c},inputTooShort:function(a){var b=a.minimum-a.input.length,c="Please enter "+b+" or more characters";return c},loadingMore:function(){return"Loading more results"},maximumSelected:function(a){var b="You can only select "+a.maximum+" item";return 1!=a.maximum&&(b+="s"),b},noResults:function(){return"No results found"},searching:function(){return"Searching"}}}),b.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){function D(){this.reset()}D.prototype.apply=function(l){if(l=a.extend(!0,{},this.defaults,l),null==l.dataAdapter){if(null!=l.ajax?l.dataAdapter=o:null!=l.data?l.dataAdapter=n:l.dataAdapter=m,l.minimumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,r)),l.maximumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,s)),l.maximumSelectionLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,t)),l.tags&&(l.dataAdapter=j.Decorate(l.dataAdapter,p)),(null!=l.tokenSeparators||null!=l.tokenizer)&&(l.dataAdapter=j.Decorate(l.dataAdapter,q)),null!=l.query){var C=b(l.amdBase+"compat/query");l.dataAdapter=j.Decorate(l.dataAdapter,C)}if(null!=l.initSelection){var D=b(l.amdBase+"compat/initSelection");l.dataAdapter=j.Decorate(l.dataAdapter,D)}}if(null==l.resultsAdapter&&(l.resultsAdapter=c,null!=l.ajax&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,x)),null!=l.placeholder&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,w)),l.selectOnClose&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,A))),null==l.dropdownAdapter){if(l.multiple)l.dropdownAdapter=u;else{var E=j.Decorate(u,v);l.dropdownAdapter=E}if(0!==l.minimumResultsForSearch&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,z)),l.closeOnSelect&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,B)),null!=l.dropdownCssClass||null!=l.dropdownCss||null!=l.adaptDropdownCssClass){var F=b(l.amdBase+"compat/dropdownCss");l.dropdownAdapter=j.Decorate(l.dropdownAdapter,F)}l.dropdownAdapter=j.Decorate(l.dropdownAdapter,y)}if(null==l.selectionAdapter){if(l.multiple?l.selectionAdapter=e:l.selectionAdapter=d,null!=l.placeholder&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,f)),l.allowClear&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,g)),l.multiple&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,h)),null!=l.containerCssClass||null!=l.containerCss||null!=l.adaptContainerCssClass){var G=b(l.amdBase+"compat/containerCss");l.selectionAdapter=j.Decorate(l.selectionAdapter,G)}l.selectionAdapter=j.Decorate(l.selectionAdapter,i)}if("string"==typeof l.language)if(l.language.indexOf("-")>0){var H=l.language.split("-"),I=H[0];l.language=[l.language,I]}else l.language=[l.language];if(a.isArray(l.language)){var J=new k;l.language.push("en");for(var K=l.language,L=0;L<K.length;L++){var M=K[L],N={};try{N=k.loadPath(M)}catch(O){try{M=this.defaults.amdLanguageBase+M,N=k.loadPath(M)}catch(P){l.debug&&window.console&&console.warn&&console.warn('Select2: The language file for "'+M+'" could not be automatically loaded. A fallback will be used instead.');continue}}J.extend(N)}l.translations=J}else{var Q=k.loadPath(this.defaults.amdLanguageBase+"en"),R=new k(l.language);R.extend(Q),l.translations=R}return l},D.prototype.reset=function(){function b(a){function b(a){return l[a]||a}return a.replace(/[^\u0000-\u007E]/g,b)}function c(d,e){if(""===a.trim(d.term))return e;if(e.children&&e.children.length>0){for(var f=a.extend(!0,{},e),g=e.children.length-1;g>=0;g--){var h=e.children[g],i=c(d,h);null==i&&f.children.splice(g,1)}return f.children.length>0?f:c(d,f)}var j=b(e.text).toUpperCase(),k=b(d.term).toUpperCase();return j.indexOf(k)>-1?e:null}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:j.escapeMarkup,language:C,matcher:c,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,sorter:function(a){return a},templateResult:function(a){return a.text},templateSelection:function(a){return a.text},theme:"default",width:"resolve"}},D.prototype.set=function(b,c){var d=a.camelCase(b),e={};e[d]=c;var f=j._convertData(e);a.extend(this.defaults,f)};var E=new D;return E}),b.define("select2/options",["require","jquery","./defaults","./utils"],function(a,b,c,d){function e(b,e){if(this.options=b,null!=e&&this.fromElement(e),this.options=c.apply(this.options),e&&e.is("input")){var f=a(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=d.Decorate(this.options.dataAdapter,f)}}return e.prototype.fromElement=function(a){var c=["select2"];null==this.options.multiple&&(this.options.multiple=a.prop("multiple")),null==this.options.disabled&&(this.options.disabled=a.prop("disabled")),null==this.options.language&&(a.prop("lang")?this.options.language=a.prop("lang").toLowerCase():a.closest("[lang]").prop("lang")&&(this.options.language=a.closest("[lang]").prop("lang"))),null==this.options.dir&&(a.prop("dir")?this.options.dir=a.prop("dir"):a.closest("[dir]").prop("dir")?this.options.dir=a.closest("[dir]").prop("dir"):this.options.dir="ltr"),a.prop("disabled",this.options.disabled),a.prop("multiple",this.options.multiple),a.data("select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),a.data("data",a.data("select2Tags")),a.data("tags",!0)),a.data("ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),a.attr("ajax--url",a.data("ajaxUrl")),a.data("ajax--url",a.data("ajaxUrl")));var e={};e=b.fn.jquery&&"1."==b.fn.jquery.substr(0,2)&&a[0].dataset?b.extend(!0,{},a[0].dataset,a.data()):a.data();var f=b.extend(!0,{},e);f=d._convertData(f);for(var g in f)b.inArray(g,c)>-1||(b.isPlainObject(this.options[g])?b.extend(this.options[g],f[g]):this.options[g]=f[g]);return this},e.prototype.get=function(a){return this.options[a]},e.prototype.set=function(a,b){this.options[a]=b},e}),b.define("select2/core",["jquery","./options","./utils","./keys"],function(a,b,c,d){var e=function(a,c){null!=a.data("select2")&&a.data("select2").destroy(),this.$element=a,this.id=this._generateId(a),c=c||{},this.options=new b(c,a),e.__super__.constructor.call(this);var d=a.attr("tabindex")||0;a.data("old-tabindex",d),a.attr("tabindex","-1");var f=this.options.get("dataAdapter");this.dataAdapter=new f(a,this.options);var g=this.render();this._placeContainer(g);var h=this.options.get("selectionAdapter");this.selection=new h(a,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,g);var i=this.options.get("dropdownAdapter");this.dropdown=new i(a,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,g);var j=this.options.get("resultsAdapter");this.results=new j(a,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var k=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(a){k.trigger("selection:update",{data:a})}),a.addClass("select2-hidden-accessible"),a.attr("aria-hidden","true"),this._syncAttributes(),a.data("select2",this)};return c.Extend(e,c.Observable),e.prototype._generateId=function(a){var b="";return b=null!=a.attr("id")?a.attr("id"):null!=a.attr("name")?a.attr("name")+"-"+c.generateChars(2):c.generateChars(4),b=b.replace(/(:|\.|\[|\]|,)/g,""),b="select2-"+b},e.prototype._placeContainer=function(a){a.insertAfter(this.$element);var b=this._resolveWidth(this.$element,this.options.get("width"));null!=b&&a.css("width",b)},e.prototype._resolveWidth=function(a,b){var c=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==b){var d=this._resolveWidth(a,"style");return null!=d?d:this._resolveWidth(a,"element")}if("element"==b){var e=a.outerWidth(!1);return 0>=e?"auto":e+"px"}if("style"==b){var f=a.attr("style");if("string"!=typeof f)return null;for(var g=f.split(";"),h=0,i=g.length;i>h;h+=1){var j=g[h].replace(/\s/g,""),k=j.match(c);if(null!==k&&k.length>=1)return k[1]}return null}return b},e.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},e.prototype._registerDomEvents=function(){var b=this;this.$element.on("change.select2",function(){b.dataAdapter.current(function(a){b.trigger("selection:update",{data:a})})}),this.$element.on("focus.select2",function(a){b.trigger("focus",a)}),this._syncA=c.bind(this._syncAttributes,this),this._syncS=c.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var d=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=d?(this._observer=new d(function(c){a.each(c,b._syncA),a.each(c,b._syncS)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",b._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",b._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",b._syncS,!1))},e.prototype._registerDataEvents=function(){var a=this;this.dataAdapter.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerSelectionEvents=function(){var b=this,c=["toggle","focus"];this.selection.on("toggle",function(){b.toggleDropdown()}),this.selection.on("focus",function(a){b.focus(a)}),this.selection.on("*",function(d,e){-1===a.inArray(d,c)&&b.trigger(d,e)})},e.prototype._registerDropdownEvents=function(){var a=this;this.dropdown.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerResultsEvents=function(){var a=this;this.results.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerEvents=function(){var a=this;this.on("open",function(){a.$container.addClass("select2-container--open")}),this.on("close",function(){a.$container.removeClass("select2-container--open")}),this.on("enable",function(){a.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){a.$container.addClass("select2-container--disabled")}),this.on("blur",function(){a.$container.removeClass("select2-container--focus")}),this.on("query",function(b){a.isOpen()||a.trigger("open",{}),this.dataAdapter.query(b,function(c){a.trigger("results:all",{data:c,query:b})})}),this.on("query:append",function(b){this.dataAdapter.query(b,function(c){a.trigger("results:append",{data:c,query:b})})}),this.on("keypress",function(b){var c=b.which;a.isOpen()?c===d.ESC||c===d.TAB||c===d.UP&&b.altKey?(a.close(),b.preventDefault()):c===d.ENTER?(a.trigger("results:select",{}),b.preventDefault()):c===d.SPACE&&b.ctrlKey?(a.trigger("results:toggle",{}),b.preventDefault()):c===d.UP?(a.trigger("results:previous",{}),b.preventDefault()):c===d.DOWN&&(a.trigger("results:next",{}),b.preventDefault()):(c===d.ENTER||c===d.SPACE||c===d.DOWN&&b.altKey)&&(a.open(),b.preventDefault())})},e.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},e.prototype._syncSubtree=function(a,b){var c=!1,d=this;if(!a||!a.target||"OPTION"===a.target.nodeName||"OPTGROUP"===a.target.nodeName){if(b)if(b.addedNodes&&b.addedNodes.length>0)for(var e=0;e<b.addedNodes.length;e++){var f=b.addedNodes[e];f.selected&&(c=!0)}else b.removedNodes&&b.removedNodes.length>0&&(c=!0);else c=!0;c&&this.dataAdapter.current(function(a){d.trigger("selection:update",{data:a})})}},e.prototype.trigger=function(a,b){var c=e.__super__.trigger,d={open:"opening",close:"closing",select:"selecting",unselect:"unselecting"};if(void 0===b&&(b={}),a in d){var f=d[a],g={prevented:!1,name:a,args:b};if(c.call(this,f,g),g.prevented)return void(b.prevented=!0)}c.call(this,a,b)},e.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},e.prototype.open=function(){this.isOpen()||this.trigger("query",{})},e.prototype.close=function(){this.isOpen()&&this.trigger("close",{})},e.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},e.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},e.prototype.focus=function(a){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},e.prototype.enable=function(a){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),(null==a||0===a.length)&&(a=[!0]);var b=!a[0];this.$element.prop("disabled",b)},e.prototype.data=function(){this.options.get("debug")&&arguments.length>0&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var a=[];return this.dataAdapter.current(function(b){a=b}),a},e.prototype.val=function(b){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==b||0===b.length)return this.$element.val();var c=b[0];a.isArray(c)&&(c=a.map(c,function(a){return a.toString()})),this.$element.val(c).trigger("change")},e.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",this.$element.data("old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null;
	},e.prototype.render=function(){var b=a('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return b.attr("dir",this.options.get("dir")),this.$container=b,this.$container.addClass("select2-container--"+this.options.get("theme")),b.data("element",this.$element),b},e}),b.define("jquery-mousewheel",["jquery"],function(a){return a}),b.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults"],function(a,b,c,d){if(null==a.fn.select2){var e=["open","close","destroy"];a.fn.select2=function(b){if(b=b||{},"object"==typeof b)return this.each(function(){var d=a.extend(!0,{},b);new c(a(this),d)}),this;if("string"==typeof b){var d,f=Array.prototype.slice.call(arguments,1);return this.each(function(){var c=a(this).data("select2");null==c&&window.console&&console.error&&console.error("The select2('"+b+"') method was called on an element that is not using Select2."),d=c[b].apply(c,f)}),a.inArray(b,e)>-1?this:d}throw new Error("Invalid arguments for Select2: "+b)}}return null==a.fn.select2.defaults&&(a.fn.select2.defaults=d),c}),{define:b.define,require:b.require}}(),c=b.require("jquery.select2");return a.fn.select2.amd=b,c});
	</script>
	<script>

		class InfiniaSelect extends Polymer.Element {

	        static get is() { return  'infinia-select' }
	
	        static get properties() {
	          return {
	           	value:{type:String, reflectToAttribute:true, notify:true, observer:'_valueChanged'},
	           	options:{type:Object, value:function(){return [];}},
	           	disableSort:{type:Boolean, value:false},
	           	inputClass:String,
	           	icon:String,
	           	ajax:String,
	           	ajaxColumn:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
				
	          	if(this.ajax) {
	          		_this.select2 = $(_this.root).find('select').select2({
	          		  ajax: {
	          		    url: _this.ajax,
	          		    data: function(params){
	          		    	let q = params.term || "";
	          		    	return {filters:"name|"+q}
	          		    },	          		    		
	          		    dataType: 'json',
						processResults: function(response) {
							let data = [];
							response.tableRows.forEach((row) => {
								data.push({id:row.id, text:row.cells[_this.ajaxColumn].value})
								_this.push('options', {id:row.id, value:row.cells[_this.ajaxColumn].value})
							});
							
							return {results:data};
						}
	          		  }
	          		});
	          	}
	          	else{
					_this.select2 = $(_this.root).find('select').select2();
	          	}
				_this.select2.val(_this.value).trigger("change");
				_this.select2.on("select2:select", () => {
					_this.value = $(_this.root).find('select').val();
					
					_this.options.forEach((elem) => {
						if(elem.icon && elem.id == _this.value)
							_this.setIcon(elem.icon);
					})
					
					var event = new CustomEvent('change', {'detail':_this.value});
		        	_this.dispatchEvent(event);
				});
				
				if(this.icon) {
					this.inputClass = "icon";
				}
				
				//When clicking outside, close the select
				window.addEventListener("click", function(e){
				    if (!$(Polymer.dom(e).event.path[0]).hasClass('select2-selection__rendered') &&
				    		!$(Polymer.dom(e).event.path[0]).hasClass('select2-selection__arrow') && 
				    		!(Polymer.dom(e).event.path[0].nodeName=="B")) {
				        _this.close();
				    }
				});
				
				if(this.ajax) {
					
				} 
				
	        }
	        
	        setValue(val) {
	        	this.value=val;
	        	this.select2.val(this.value).trigger("change");
	        	if($(this.$["inf-select"]).find('option:selected').prop('label') == undefined){
	        		this.value="";
		        	this.select2.val("");
	        	}
	        	
	        	if(this.options) {
	        		this.options.forEach((elem) => {
						if(elem.icon && elem.id == this.value)
							this.setIcon(elem.icon);
					})
	        	}
	        	var event = new CustomEvent('change', {'detail':val});
	        	this.dispatchEvent(event);
	        }
	        
	        setOptions(opt) {
	        	this.options = opt;
	        	var that = this;
	        	
	        	
	        	
	        	setTimeout(function() {
	        		that.dispatchEvent(new Event('onRender'));
	        		$(that.root).find('select').select2("destroy");
	        		that.select2 = $(that.root).find('select').select2();
	        		if(opt.length==0){
	        			that.setValue("");
	        		}
	        		if(opt.length == 1) {
		        		that.setValue(opt[0].id);
		        	}
	        			
	        	}, 200);
	        }
	        
	        text() {
	        	return $(this.$["inf-select"]).find('option:selected').prop('label');
	        }
	        
	        close() {
	        	$(this.$["inf-select"]).select2('close');
	        }
	        
	        disable() {
	        	$(this.$["inf-select"]).prop( "disabled", true );
	        }
	        
	        enable() {
	        	$(this.$["inf-select"]).prop( "disabled", false );
	        }
	        
	        _valueChanged() {
	        	this.select2.val(this.value).trigger("change");
	        }
	        
	        _sort(a, b) {
	        	
	        	if(!this.disableSort) {
		        	if(typeof a.value == "undefined")
		        		return 1;
		        	else if (typeof b.value=="undefined")
		        		return -1;
		        	
		        	if (a.value.toLocaleString().toLowerCase() < b.value.toLocaleString().toLowerCase() )
		        		  return -1;
		        		if ( a.value.toLocaleString().toLowerCase() > b.value.toLocaleString().toLowerCase() )
		        		  return 1;
		        		return 0;
	        	}
	        	else {
	        		let aIndex = this.options.indexOf(a);
	        		let bIndex = this.options.indexOf(b);
	        		return aIndex - bIndex;
	        	}
	        }
	        
	        setIcon(icon) {
	        	this.icon = icon;
	        }
	    }
	    
	    customElements.define(InfiniaSelect.is, InfiniaSelect);
	    
	    
    </script> 
</dom-module><dom-module id="date-picker" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		<style>

		.container{
			position:relative;
			display:flex;
		}

		iron-input, input {
			width:100%;
			background-color:transparent;
		}

		input {
			padding: 6px 0px 6px 5px;
			-webkit-appearance: none!important;
			border-radius:0;
    		outline: none;
    		font-size:14px;
    		border:1px solid #ccc;
		}
		
		input.datepicker {
			border:1px solid var(--input-border);
		}
		
		input.gold{
			border:1px solid var(--primary-color);
			border-radius:10px;
			padding:3px 8px;
		}
		
		input:disabled {
			background-color:var(--lighter-background);
		}

		label {
			color:var(--input-label);
			font-size:10px;
		}
		
		.time {
			display:flex;
			margin-left:5px;
		}
		.time span {
			padding-top:7px;
		}
		.time input {
			width:37px;
			padding:6px 0;
			padding-left:5px;
		}
		
		.date-icon {
			position:absolute;
			right:3px;
			top:2px;
			color:var(--primary-color);
			display:none;
		}
		
		.date-icon.gold {
			display:block;
		}
		
		.date-selector {
			position:relative;
		}
		</style>
		
		<div class="container">
			
			<div class="date-selector">
				<iron-input bind-value="{{value}}">
					<input id="datepicker" value="{{value::input}}" class$="{{inputClass}}" placeholder$="{{placeholder}}">
				</iron-input>
				<iron-icon icon="icons:date-range" id="dateIcon" class$="date-icon {{inputClass}}"></iron-icon>
			</div>
			<template is="dom-if" if="{{showTime}}">
				<div class="time">
					<iron-input bind-value="{{hour}}">
						<input type="number" max="23" min="0" placeholder="hh">
					</iron-input>
					<span style="padding-top:7px;">:</span>
					<iron-input bind-value="{{min}}">
						<input type="number" max="59" min="0" placeholder="mm">
					</iron-input>
				</div>
			</template>
		</div>
	</template> 
	<script>
	!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a,b){function c(){return new Date(Date.UTC.apply(Date,arguments))}function d(){var a=new Date;return c(a.getFullYear(),a.getMonth(),a.getDate())}function e(a,b){return a.getUTCFullYear()===b.getUTCFullYear()&&a.getUTCMonth()===b.getUTCMonth()&&a.getUTCDate()===b.getUTCDate()}function f(c,d){return function(){return d!==b&&a.fn.datepicker.deprecated(d),this[c].apply(this,arguments)}}function g(a){return a&&!isNaN(a.getTime())}function h(b,c){function d(a,b){return b.toLowerCase()}var e,f=a(b).data(),g={},h=new RegExp("^"+c.toLowerCase()+"([A-Z])");c=new RegExp("^"+c.toLowerCase());for(var i in f)c.test(i)&&(e=i.replace(h,d),g[e]=f[i]);return g}function i(b){var c={};if(q[b]||(b=b.split("-")[0],q[b])){var d=q[b];return a.each(p,function(a,b){b in d&&(c[b]=d[b])}),c}}var j=function(){var b={get:function(a){return this.slice(a)[0]},contains:function(a){for(var b=a&&a.valueOf(),c=0,d=this.length;c<d;c++)if(0<=this[c].valueOf()-b&&this[c].valueOf()-b<864e5)return c;return-1},remove:function(a){this.splice(a,1)},replace:function(b){b&&(a.isArray(b)||(b=[b]),this.clear(),this.push.apply(this,b))},clear:function(){this.length=0},copy:function(){var a=new j;return a.replace(this),a}};return function(){var c=[];return c.push.apply(c,arguments),a.extend(c,b),c}}(),k=function(b,c){a.data(b,"datepicker",this),this._process_options(c),this.dates=new j,this.viewDate=this.o.defaultViewDate,this.focusDate=null,this.element=a(b),this.isInput=this.element.is("input"),this.inputField=this.isInput?this.element:this.element.find("input"),this.component=!!this.element.hasClass("date")&&this.element.find(".add-on, .input-group-addon, .btn"),this.component&&0===this.component.length&&(this.component=!1),this.isInline=!this.component&&this.element.is("div"),this.picker=a(r.template),this._check_template(this.o.templates.leftArrow)&&this.picker.find(".prev").html(this.o.templates.leftArrow),this._check_template(this.o.templates.rightArrow)&&this.picker.find(".next").html(this.o.templates.rightArrow),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&this.picker.addClass("datepicker-rtl"),this.o.calendarWeeks&&this.picker.find(".datepicker-days .datepicker-switch, thead .datepicker-title, tfoot .today, tfoot .clear").attr("colspan",function(a,b){return Number(b)+1}),this._process_options({startDate:this._o.startDate,endDate:this._o.endDate,daysOfWeekDisabled:this.o.daysOfWeekDisabled,daysOfWeekHighlighted:this.o.daysOfWeekHighlighted,datesDisabled:this.o.datesDisabled}),this._allow_update=!1,this.setViewMode(this.o.startView),this._allow_update=!0,this.fillDow(),this.fillMonths(),this.update(),this.isInline&&this.show()};k.prototype={constructor:k,_resolveViewName:function(b){return a.each(r.viewModes,function(c,d){if(b===c||a.inArray(b,d.names)!==-1)return b=c,!1}),b},_resolveDaysOfWeek:function(b){return a.isArray(b)||(b=b.split(/[,\s]*/)),a.map(b,Number)},_check_template:function(c){try{if(c===b||""===c)return!1;if((c.match(/[<>]/g)||[]).length<=0)return!0;var d=a(c);return d.length>0}catch(a){return!1}},_process_options:function(b){this._o=a.extend({},this._o,b);var e=this.o=a.extend({},this._o),f=e.language;q[f]||(f=f.split("-")[0],q[f]||(f=o.language)),e.language=f,e.startView=this._resolveViewName(e.startView),e.minViewMode=this._resolveViewName(e.minViewMode),e.maxViewMode=this._resolveViewName(e.maxViewMode),e.startView=Math.max(this.o.minViewMode,Math.min(this.o.maxViewMode,e.startView)),e.multidate!==!0&&(e.multidate=Number(e.multidate)||!1,e.multidate!==!1&&(e.multidate=Math.max(0,e.multidate))),e.multidateSeparator=String(e.multidateSeparator),e.weekStart%=7,e.weekEnd=(e.weekStart+6)%7;var g=r.parseFormat(e.format);e.startDate!==-(1/0)&&(e.startDate?e.startDate instanceof Date?e.startDate=this._local_to_utc(this._zero_time(e.startDate)):e.startDate=r.parseDate(e.startDate,g,e.language,e.assumeNearbyYear):e.startDate=-(1/0)),e.endDate!==1/0&&(e.endDate?e.endDate instanceof Date?e.endDate=this._local_to_utc(this._zero_time(e.endDate)):e.endDate=r.parseDate(e.endDate,g,e.language,e.assumeNearbyYear):e.endDate=1/0),e.daysOfWeekDisabled=this._resolveDaysOfWeek(e.daysOfWeekDisabled||[]),e.daysOfWeekHighlighted=this._resolveDaysOfWeek(e.daysOfWeekHighlighted||[]),e.datesDisabled=e.datesDisabled||[],a.isArray(e.datesDisabled)||(e.datesDisabled=e.datesDisabled.split(",")),e.datesDisabled=a.map(e.datesDisabled,function(a){return r.parseDate(a,g,e.language,e.assumeNearbyYear)});var h=String(e.orientation).toLowerCase().split(/\s+/g),i=e.orientation.toLowerCase();if(h=a.grep(h,function(a){return/^auto|left|right|top|bottom$/.test(a)}),e.orientation={x:"auto",y:"auto"},i&&"auto"!==i)if(1===h.length)switch(h[0]){case"top":case"bottom":e.orientation.y=h[0];break;case"left":case"right":e.orientation.x=h[0]}else i=a.grep(h,function(a){return/^left|right$/.test(a)}),e.orientation.x=i[0]||"auto",i=a.grep(h,function(a){return/^top|bottom$/.test(a)}),e.orientation.y=i[0]||"auto";else;if(e.defaultViewDate instanceof Date||"string"==typeof e.defaultViewDate)e.defaultViewDate=r.parseDate(e.defaultViewDate,g,e.language,e.assumeNearbyYear);else if(e.defaultViewDate){var j=e.defaultViewDate.year||(new Date).getFullYear(),k=e.defaultViewDate.month||0,l=e.defaultViewDate.day||1;e.defaultViewDate=c(j,k,l)}else e.defaultViewDate=d()},_events:[],_secondaryEvents:[],_applyEvents:function(a){for(var c,d,e,f=0;f<a.length;f++)c=a[f][0],2===a[f].length?(d=b,e=a[f][1]):3===a[f].length&&(d=a[f][1],e=a[f][2]),c.on(e,d)},_unapplyEvents:function(a){for(var c,d,e,f=0;f<a.length;f++)c=a[f][0],2===a[f].length?(e=b,d=a[f][1]):3===a[f].length&&(e=a[f][1],d=a[f][2]),c.off(d,e)},_buildEvents:function(){var b={keyup:a.proxy(function(b){a.inArray(b.keyCode,[27,37,39,38,40,32,13,9])===-1&&this.update()},this),keydown:a.proxy(this.keydown,this),paste:a.proxy(this.paste,this)};this.o.showOnFocus===!0&&(b.focus=a.proxy(this.show,this)),this.isInput?this._events=[[this.element,b]]:this.component&&this.inputField.length?this._events=[[this.inputField,b],[this.component,{click:a.proxy(this.show,this)}]]:this._events=[[this.element,{click:a.proxy(this.show,this),keydown:a.proxy(this.keydown,this)}]],this._events.push([this.element,"*",{blur:a.proxy(function(a){this._focused_from=a.target},this)}],[this.element,{blur:a.proxy(function(a){this._focused_from=a.target},this)}]),this.o.immediateUpdates&&this._events.push([this.element,{"changeYear changeMonth":a.proxy(function(a){this.update(a.date)},this)}]),this._secondaryEvents=[[this.picker,{click:a.proxy(this.click,this)}],[this.picker,".prev, .next",{click:a.proxy(this.navArrowsClick,this)}],[this.picker,".day:not(.disabled)",{click:a.proxy(this.dayCellClick,this)}],[a(window),{resize:a.proxy(this.place,this)}],[a(document),{"mousedown touchstart":a.proxy(function(a){this.element.is(a.target)||this.element.find(a.target).length||this.picker.is(a.target)||this.picker.find(a.target).length||this.isInline||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(b,c){var d=c||this.dates.get(-1),e=this._utc_to_local(d);this.element.trigger({type:b,date:e,viewMode:this.viewMode,dates:a.map(this.dates,this._utc_to_local),format:a.proxy(function(a,b){0===arguments.length?(a=this.dates.length-1,b=this.o.format):"string"==typeof a&&(b=a,a=this.dates.length-1),b=b||this.o.format;var c=this.dates.get(a);return r.formatDate(c,b,this.o.language)},this)})},show:function(){if(!(this.inputField.prop("disabled")||this.inputField.prop("readonly")&&this.o.enableOnReadonly===!1))return this.isInline||this.picker.appendTo(this.o.container),this.place(),this.picker.show(),this._attachSecondaryEvents(),this._trigger("show"),(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&this.o.disableTouchKeyboard&&a(this.element).blur(),this},hide:function(){return this.isInline||!this.picker.is(":visible")?this:(this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.setViewMode(this.o.startView),this.o.forceParse&&this.inputField.val()&&this.setValue(),this._trigger("hide"),this)},destroy:function(){return this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date,this},paste:function(b){var c;if(b.originalEvent.clipboardData&&b.originalEvent.clipboardData.types&&a.inArray("text/plain",b.originalEvent.clipboardData.types)!==-1)c=b.originalEvent.clipboardData.getData("text/plain");else{if(!window.clipboardData)return;c=window.clipboardData.getData("Text")}this.setDate(c),this.update(),b.preventDefault()},_utc_to_local:function(a){if(!a)return a;var b=new Date(a.getTime()+6e4*a.getTimezoneOffset());return b.getTimezoneOffset()!==a.getTimezoneOffset()&&(b=new Date(a.getTime()+6e4*b.getTimezoneOffset())),b},_local_to_utc:function(a){return a&&new Date(a.getTime()-6e4*a.getTimezoneOffset())},_zero_time:function(a){return a&&new Date(a.getFullYear(),a.getMonth(),a.getDate())},_zero_utc_time:function(a){return a&&c(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())},getDates:function(){return a.map(this.dates,this._utc_to_local)},getUTCDates:function(){return a.map(this.dates,function(a){return new Date(a)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){var a=this.dates.get(-1);return a!==b?new Date(a):null},clearDates:function(){this.inputField.val(""),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()},setDates:function(){var b=a.isArray(arguments[0])?arguments[0]:arguments;return this.update.apply(this,b),this._trigger("changeDate"),this.setValue(),this},setUTCDates:function(){var b=a.isArray(arguments[0])?arguments[0]:arguments;return this.setDates.apply(this,a.map(b,this._utc_to_local)),this},setDate:f("setDates"),setUTCDate:f("setUTCDates"),remove:f("destroy","Method `remove` is deprecated and will be removed in version 2.0. Use `destroy` instead"),setValue:function(){var a=this.getFormattedDate();return this.inputField.val(a),this},getFormattedDate:function(c){c===b&&(c=this.o.format);var d=this.o.language;return a.map(this.dates,function(a){return r.formatDate(a,c,d)}).join(this.o.multidateSeparator)},getStartDate:function(){return this.o.startDate},setStartDate:function(a){return this._process_options({startDate:a}),this.update(),this.updateNavArrows(),this},getEndDate:function(){return this.o.endDate},setEndDate:function(a){return this._process_options({endDate:a}),this.update(),this.updateNavArrows(),this},setDaysOfWeekDisabled:function(a){return this._process_options({daysOfWeekDisabled:a}),this.update(),this},setDaysOfWeekHighlighted:function(a){return this._process_options({daysOfWeekHighlighted:a}),this.update(),this},setDatesDisabled:function(a){return this._process_options({datesDisabled:a}),this.update(),this},place:function(){if(this.isInline)return this;var b=this.picker.outerWidth(),c=this.picker.outerHeight(),d=10,e=a(this.o.container),f=e.width(),g="body"===this.o.container?a(document).scrollTop():e.scrollTop(),h=e.offset(),i=[0];this.element.parents().each(function(){var b=a(this).css("z-index");"auto"!==b&&0!==Number(b)&&i.push(Number(b))});var j=Math.max.apply(Math,i)+this.o.zIndexOffset,k=this.component?this.component.parent().offset():this.element.offset(),l=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),m=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),n=k.left-h.left,o=k.top-h.top;"body"!==this.o.container&&(o+=g),this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),"auto"!==this.o.orientation.x?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),"right"===this.o.orientation.x&&(n-=b-m)):k.left<0?(this.picker.addClass("datepicker-orient-left"),n-=k.left-d):n+b>f?(this.picker.addClass("datepicker-orient-right"),n+=m-b):this.o.rtl?this.picker.addClass("datepicker-orient-right"):this.picker.addClass("datepicker-orient-left");var p,q=this.o.orientation.y;if("auto"===q&&(p=-g+o-c,q=p<0?"bottom":"top"),this.picker.addClass("datepicker-orient-"+q),"top"===q?o-=c+parseInt(this.picker.css("padding-top")):o+=l,this.o.rtl){var r=f-(n+m);this.picker.css({top:o,right:r,zIndex:j})}else this.picker.css({top:o,left:n,zIndex:j});return this},_allow_update:!0,update:function(){if(!this._allow_update)return this;var b=this.dates.copy(),c=[],d=!1;return arguments.length?(a.each(arguments,a.proxy(function(a,b){b instanceof Date&&(b=this._local_to_utc(b)),c.push(b)},this)),d=!0):(c=this.isInput?this.element.val():this.element.data("date")||this.inputField.val(),c=c&&this.o.multidate?c.split(this.o.multidateSeparator):[c],delete this.element.data().date),c=a.map(c,a.proxy(function(a){return r.parseDate(a,this.o.format,this.o.language,this.o.assumeNearbyYear)},this)),c=a.grep(c,a.proxy(function(a){return!this.dateWithinRange(a)||!a},this),!0),this.dates.replace(c),this.o.updateViewDate&&(this.dates.length?this.viewDate=new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.viewDate>this.o.endDate?this.viewDate=new Date(this.o.endDate):this.viewDate=this.o.defaultViewDate),d?(this.setValue(),this.element.change()):this.dates.length&&String(b)!==String(this.dates)&&d&&(this._trigger("changeDate"),this.element.change()),!this.dates.length&&b.length&&(this._trigger("clearDate"),this.element.change()),this.fill(),this},fillDow:function(){if(this.o.showWeekDays){var b=this.o.weekStart,c="<tr>";for(this.o.calendarWeeks&&(c+='<th class="cw">&#160;</th>');b<this.o.weekStart+7;)c+='<th class="dow',a.inArray(b,this.o.daysOfWeekDisabled)!==-1&&(c+=" disabled"),c+='">'+q[this.o.language].daysMin[b++%7]+"</th>";c+="</tr>",this.picker.find(".datepicker-days thead").append(c)}},fillMonths:function(){for(var a,b=this._utc_to_local(this.viewDate),c="",d=0;d<12;d++)a=b&&b.getMonth()===d?" focused":"",c+='<span class="month'+a+'">'+q[this.o.language].monthsShort[d]+"</span>";this.picker.find(".datepicker-months td").html(c)},setRange:function(b){b&&b.length?this.range=a.map(b,function(a){return a.valueOf()}):delete this.range,this.fill()},getClassNames:function(b){var c=[],f=this.viewDate.getUTCFullYear(),g=this.viewDate.getUTCMonth(),h=d();return b.getUTCFullYear()<f||b.getUTCFullYear()===f&&b.getUTCMonth()<g?c.push("old"):(b.getUTCFullYear()>f||b.getUTCFullYear()===f&&b.getUTCMonth()>g)&&c.push("new"),this.focusDate&&b.valueOf()===this.focusDate.valueOf()&&c.push("focused"),this.o.todayHighlight&&e(b,h)&&c.push("today"),this.dates.contains(b)!==-1&&c.push("active"),this.dateWithinRange(b)||c.push("disabled"),this.dateIsDisabled(b)&&c.push("disabled","disabled-date"),a.inArray(b.getUTCDay(),this.o.daysOfWeekHighlighted)!==-1&&c.push("highlighted"),this.range&&(b>this.range[0]&&b<this.range[this.range.length-1]&&c.push("range"),a.inArray(b.valueOf(),this.range)!==-1&&c.push("selected"),b.valueOf()===this.range[0]&&c.push("range-start"),b.valueOf()===this.range[this.range.length-1]&&c.push("range-end")),c},_fill_yearsView:function(c,d,e,f,g,h,i){for(var j,k,l,m="",n=e/10,o=this.picker.find(c),p=Math.floor(f/e)*e,q=p+9*n,r=Math.floor(this.viewDate.getFullYear()/n)*n,s=a.map(this.dates,function(a){return Math.floor(a.getUTCFullYear()/n)*n}),t=p-n;t<=q+n;t+=n)j=[d],k=null,t===p-n?j.push("old"):t===q+n&&j.push("new"),a.inArray(t,s)!==-1&&j.push("active"),(t<g||t>h)&&j.push("disabled"),t===r&&j.push("focused"),i!==a.noop&&(l=i(new Date(t,0,1)),l===b?l={}:"boolean"==typeof l?l={enabled:l}:"string"==typeof l&&(l={classes:l}),l.enabled===!1&&j.push("disabled"),l.classes&&(j=j.concat(l.classes.split(/\s+/))),l.tooltip&&(k=l.tooltip)),m+='<span class="'+j.join(" ")+'"'+(k?' title="'+k+'"':"")+">"+t+"</span>";o.find(".datepicker-switch").text(p+"-"+q),o.find("td").html(m)},fill:function(){var d,e,f=new Date(this.viewDate),g=f.getUTCFullYear(),h=f.getUTCMonth(),i=this.o.startDate!==-(1/0)?this.o.startDate.getUTCFullYear():-(1/0),j=this.o.startDate!==-(1/0)?this.o.startDate.getUTCMonth():-(1/0),k=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,l=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,m=q[this.o.language].today||q.en.today||"",n=q[this.o.language].clear||q.en.clear||"",o=q[this.o.language].titleFormat||q.en.titleFormat;if(!isNaN(g)&&!isNaN(h)){this.picker.find(".datepicker-days .datepicker-switch").text(r.formatDate(f,o,this.o.language)),this.picker.find("tfoot .today").text(m).css("display",this.o.todayBtn===!0||"linked"===this.o.todayBtn?"table-cell":"none"),this.picker.find("tfoot .clear").text(n).css("display",this.o.clearBtn===!0?"table-cell":"none"),this.picker.find("thead .datepicker-title").text(this.o.title).css("display","string"==typeof this.o.title&&""!==this.o.title?"table-cell":"none"),this.updateNavArrows(),this.fillMonths();var p=c(g,h,0),s=p.getUTCDate();p.setUTCDate(s-(p.getUTCDay()-this.o.weekStart+7)%7);var t=new Date(p);p.getUTCFullYear()<100&&t.setUTCFullYear(p.getUTCFullYear()),t.setUTCDate(t.getUTCDate()+42),t=t.valueOf();for(var u,v,w=[];p.valueOf()<t;){if(u=p.getUTCDay(),u===this.o.weekStart&&(w.push("<tr>"),this.o.calendarWeeks)){var x=new Date(+p+(this.o.weekStart-u-7)%7*864e5),y=new Date(Number(x)+(11-x.getUTCDay())%7*864e5),z=new Date(Number(z=c(y.getUTCFullYear(),0,1))+(11-z.getUTCDay())%7*864e5),A=(y-z)/864e5/7+1;w.push('<td class="cw">'+A+"</td>")}v=this.getClassNames(p),v.push("day");var B=p.getUTCDate();this.o.beforeShowDay!==a.noop&&(e=this.o.beforeShowDay(this._utc_to_local(p)),e===b?e={}:"boolean"==typeof e?e={enabled:e}:"string"==typeof e&&(e={classes:e}),e.enabled===!1&&v.push("disabled"),e.classes&&(v=v.concat(e.classes.split(/\s+/))),e.tooltip&&(d=e.tooltip),e.content&&(B=e.content)),v=a.isFunction(a.uniqueSort)?a.uniqueSort(v):a.unique(v),w.push('<td class="'+v.join(" ")+'"'+(d?' title="'+d+'"':"")+' data-date="'+p.getTime().toString()+'">'+B+"</td>"),d=null,u===this.o.weekEnd&&w.push("</tr>"),p.setUTCDate(p.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").html(w.join(""));var C=q[this.o.language].monthsTitle||q.en.monthsTitle||"Months",D=this.picker.find(".datepicker-months").find(".datepicker-switch").text(this.o.maxViewMode<2?C:g).end().find("tbody span").removeClass("active");if(a.each(this.dates,function(a,b){b.getUTCFullYear()===g&&D.eq(b.getUTCMonth()).addClass("active")}),(g<i||g>k)&&D.addClass("disabled"),g===i&&D.slice(0,j).addClass("disabled"),g===k&&D.slice(l+1).addClass("disabled"),this.o.beforeShowMonth!==a.noop){var E=this;a.each(D,function(c,d){var e=new Date(g,c,1),f=E.o.beforeShowMonth(e);f===b?f={}:"boolean"==typeof f?f={enabled:f}:"string"==typeof f&&(f={classes:f}),f.enabled!==!1||a(d).hasClass("disabled")||a(d).addClass("disabled"),f.classes&&a(d).addClass(f.classes),f.tooltip&&a(d).prop("title",f.tooltip)})}this._fill_yearsView(".datepicker-years","year",10,g,i,k,this.o.beforeShowYear),this._fill_yearsView(".datepicker-decades","decade",100,g,i,k,this.o.beforeShowDecade),this._fill_yearsView(".datepicker-centuries","century",1e3,g,i,k,this.o.beforeShowCentury)}},updateNavArrows:function(){if(this._allow_update){var a,b,c=new Date(this.viewDate),d=c.getUTCFullYear(),e=c.getUTCMonth(),f=this.o.startDate!==-(1/0)?this.o.startDate.getUTCFullYear():-(1/0),g=this.o.startDate!==-(1/0)?this.o.startDate.getUTCMonth():-(1/0),h=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,i=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,j=1;switch(this.viewMode){case 0:a=d<=f&&e<=g,b=d>=h&&e>=i;break;case 4:j*=10;case 3:j*=10;case 2:j*=10;case 1:a=Math.floor(d/j)*j<=f,b=Math.floor(d/j)*j+j>=h}this.picker.find(".prev").toggleClass("disabled",a),this.picker.find(".next").toggleClass("disabled",b)}},click:function(b){b.preventDefault(),b.stopPropagation();var e,f,g,h;e=a(b.target),e.hasClass("datepicker-switch")&&this.viewMode!==this.o.maxViewMode&&this.setViewMode(this.viewMode+1),e.hasClass("today")&&!e.hasClass("day")&&(this.setViewMode(0),this._setDate(d(),"linked"===this.o.todayBtn?null:"view")),e.hasClass("clear")&&this.clearDates(),e.hasClass("disabled")||(e.hasClass("month")||e.hasClass("year")||e.hasClass("decade")||e.hasClass("century"))&&(this.viewDate.setUTCDate(1),f=1,1===this.viewMode?(h=e.parent().find("span").index(e),g=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(h)):(h=0,g=Number(e.text()),this.viewDate.setUTCFullYear(g)),this._trigger(r.viewModes[this.viewMode-1].e,this.viewDate),this.viewMode===this.o.minViewMode?this._setDate(c(g,h,f)):(this.setViewMode(this.viewMode-1),this.fill())),this.picker.is(":visible")&&this._focused_from&&this._focused_from.focus(),delete this._focused_from},dayCellClick:function(b){var c=a(b.currentTarget),d=c.data("date"),e=new Date(d);this.o.updateViewDate&&(e.getUTCFullYear()!==this.viewDate.getUTCFullYear()&&this._trigger("changeYear",this.viewDate),e.getUTCMonth()!==this.viewDate.getUTCMonth()&&this._trigger("changeMonth",this.viewDate)),this._setDate(e)},navArrowsClick:function(b){var c=a(b.currentTarget),d=c.hasClass("prev")?-1:1;0!==this.viewMode&&(d*=12*r.viewModes[this.viewMode].navStep),this.viewDate=this.moveMonth(this.viewDate,d),this._trigger(r.viewModes[this.viewMode].e,this.viewDate),this.fill()},_toggle_multidate:function(a){var b=this.dates.contains(a);if(a||this.dates.clear(),b!==-1?(this.o.multidate===!0||this.o.multidate>1||this.o.toggleActive)&&this.dates.remove(b):this.o.multidate===!1?(this.dates.clear(),this.dates.push(a)):this.dates.push(a),"number"==typeof this.o.multidate)for(;this.dates.length>this.o.multidate;)this.dates.remove(0)},_setDate:function(a,b){b&&"date"!==b||this._toggle_multidate(a&&new Date(a)),(!b&&this.o.updateViewDate||"view"===b)&&(this.viewDate=a&&new Date(a)),this.fill(),this.setValue(),b&&"view"===b||this._trigger("changeDate"),this.inputField.trigger("change"),!this.o.autoclose||b&&"date"!==b||this.hide()},moveDay:function(a,b){var c=new Date(a);return c.setUTCDate(a.getUTCDate()+b),c},moveWeek:function(a,b){return this.moveDay(a,7*b)},moveMonth:function(a,b){if(!g(a))return this.o.defaultViewDate;if(!b)return a;var c,d,e=new Date(a.valueOf()),f=e.getUTCDate(),h=e.getUTCMonth(),i=Math.abs(b);if(b=b>0?1:-1,1===i)d=b===-1?function(){return e.getUTCMonth()===h}:function(){return e.getUTCMonth()!==c},c=h+b,e.setUTCMonth(c),c=(c+12)%12;else{for(var j=0;j<i;j++)e=this.moveMonth(e,b);c=e.getUTCMonth(),e.setUTCDate(f),d=function(){return c!==e.getUTCMonth()}}for(;d();)e.setUTCDate(--f),e.setUTCMonth(c);return e},moveYear:function(a,b){return this.moveMonth(a,12*b)},moveAvailableDate:function(a,b,c){do{if(a=this[c](a,b),!this.dateWithinRange(a))return!1;c="moveDay"}while(this.dateIsDisabled(a));return a},weekOfDateIsDisabled:function(b){return a.inArray(b.getUTCDay(),this.o.daysOfWeekDisabled)!==-1},dateIsDisabled:function(b){return this.weekOfDateIsDisabled(b)||a.grep(this.o.datesDisabled,function(a){return e(b,a)}).length>0},dateWithinRange:function(a){return a>=this.o.startDate&&a<=this.o.endDate},keydown:function(a){if(!this.picker.is(":visible"))return void(40!==a.keyCode&&27!==a.keyCode||(this.show(),a.stopPropagation()));var b,c,d=!1,e=this.focusDate||this.viewDate;switch(a.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),a.preventDefault(),a.stopPropagation();break;case 37:case 38:case 39:case 40:if(!this.o.keyboardNavigation||7===this.o.daysOfWeekDisabled.length)break;b=37===a.keyCode||38===a.keyCode?-1:1,0===this.viewMode?a.ctrlKey?(c=this.moveAvailableDate(e,b,"moveYear"),c&&this._trigger("changeYear",this.viewDate)):a.shiftKey?(c=this.moveAvailableDate(e,b,"moveMonth"),c&&this._trigger("changeMonth",this.viewDate)):37===a.keyCode||39===a.keyCode?c=this.moveAvailableDate(e,b,"moveDay"):this.weekOfDateIsDisabled(e)||(c=this.moveAvailableDate(e,b,"moveWeek")):1===this.viewMode?(38!==a.keyCode&&40!==a.keyCode||(b*=4),c=this.moveAvailableDate(e,b,"moveMonth")):2===this.viewMode&&(38!==a.keyCode&&40!==a.keyCode||(b*=4),c=this.moveAvailableDate(e,b,"moveYear")),c&&(this.focusDate=this.viewDate=c,this.setValue(),this.fill(),a.preventDefault());break;case 13:if(!this.o.forceParse)break;e=this.focusDate||this.dates.get(-1)||this.viewDate,this.o.keyboardNavigation&&(this._toggle_multidate(e),d=!0),this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(a.preventDefault(),a.stopPropagation(),this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}d&&(this.dates.length?this._trigger("changeDate"):this._trigger("clearDate"),this.inputField.trigger("change"))},setViewMode:function(a){this.viewMode=a,this.picker.children("div").hide().filter(".datepicker-"+r.viewModes[this.viewMode].clsName).show(),this.updateNavArrows(),this._trigger("changeViewMode",new Date(this.viewDate))}};var l=function(b,c){a.data(b,"datepicker",this),this.element=a(b),this.inputs=a.map(c.inputs,function(a){return a.jquery?a[0]:a}),delete c.inputs,this.keepEmptyValues=c.keepEmptyValues,delete c.keepEmptyValues,n.call(a(this.inputs),c).on("changeDate",a.proxy(this.dateUpdated,this)),this.pickers=a.map(this.inputs,function(b){return a.data(b,"datepicker")}),this.updateDates()};l.prototype={updateDates:function(){this.dates=a.map(this.pickers,function(a){return a.getUTCDate()}),this.updateRanges()},updateRanges:function(){var b=a.map(this.dates,function(a){return a.valueOf()});a.each(this.pickers,function(a,c){c.setRange(b)})},dateUpdated:function(c){if(!this.updating){this.updating=!0;var d=a.data(c.target,"datepicker");if(d!==b){var e=d.getUTCDate(),f=this.keepEmptyValues,g=a.inArray(c.target,this.inputs),h=g-1,i=g+1,j=this.inputs.length;if(g!==-1){if(a.each(this.pickers,function(a,b){b.getUTCDate()||b!==d&&f||b.setUTCDate(e)}),e<this.dates[h])for(;h>=0&&e<this.dates[h];)this.pickers[h--].setUTCDate(e);else if(e>this.dates[i])for(;i<j&&e>this.dates[i];)this.pickers[i++].setUTCDate(e);this.updateDates(),delete this.updating}}}},destroy:function(){a.map(this.pickers,function(a){a.destroy()}),a(this.inputs).off("changeDate",this.dateUpdated),delete this.element.data().datepicker},remove:f("destroy","Method `remove` is deprecated and will be removed in version 2.0. Use `destroy` instead")};var m=a.fn.datepicker,n=function(c){var d=Array.apply(null,arguments);d.shift();var e;if(this.each(function(){var b=a(this),f=b.data("datepicker"),g="object"==typeof c&&c;if(!f){var j=h(this,"date"),m=a.extend({},o,j,g),n=i(m.language),p=a.extend({},o,n,j,g);b.hasClass("input-daterange")||p.inputs?(a.extend(p,{inputs:p.inputs||b.find("input").toArray()}),f=new l(this,p)):f=new k(this,p),b.data("datepicker",f)}"string"==typeof c&&"function"==typeof f[c]&&(e=f[c].apply(f,d))}),e===b||e instanceof k||e instanceof l)return this;if(this.length>1)throw new Error("Using only allowed for the collection of a single element ("+c+" function)");return e};a.fn.datepicker=n;var o=a.fn.datepicker.defaults={assumeNearbyYear:!1,autoclose:!1,beforeShowDay:a.noop,beforeShowMonth:a.noop,beforeShowYear:a.noop,beforeShowDecade:a.noop,beforeShowCentury:a.noop,calendarWeeks:!1,clearBtn:!1,toggleActive:!1,daysOfWeekDisabled:[],daysOfWeekHighlighted:[],datesDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keepEmptyValues:!1,keyboardNavigation:!0,language:"en",minViewMode:0,maxViewMode:4,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-(1/0),startView:0,todayBtn:!1,todayHighlight:!1,updateViewDate:!0,weekStart:0,disableTouchKeyboard:!1,enableOnReadonly:!0,showOnFocus:!0,zIndexOffset:10,container:"body",immediateUpdates:!1,title:"",templates:{leftArrow:"&#x00AB;",rightArrow:"&#x00BB;"},showWeekDays:!0},p=a.fn.datepicker.locale_opts=["format","rtl","weekStart"];a.fn.datepicker.Constructor=k;var q=a.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM yyyy"}},r={viewModes:[{names:["days","month"],clsName:"days",e:"changeMonth"},{names:["months","year"],clsName:"months",e:"changeYear",navStep:1},{names:["years","decade"],clsName:"years",e:"changeDecade",navStep:10},{names:["decades","century"],clsName:"decades",e:"changeCentury",navStep:100},{names:["centuries","millennium"],clsName:"centuries",e:"changeMillennium",navStep:1e3}],validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\u5e74\u6708\u65e5\[-`{-~\t\n\r]+/g,parseFormat:function(a){if("function"==typeof a.toValue&&"function"==typeof a.toDisplay)return a;var b=a.replace(this.validParts,"\0").split("\0"),c=a.match(this.validParts);if(!b||!b.length||!c||0===c.length)throw new Error("Invalid date format.");return{separators:b,parts:c}},parseDate:function(c,e,f,g){function h(a,b){return b===!0&&(b=10),a<100&&(a+=2e3,a>(new Date).getFullYear()+b&&(a-=100)),a}function i(){var a=this.slice(0,j[n].length),b=j[n].slice(0,a.length);return a.toLowerCase()===b.toLowerCase()}if(!c)return b;if(c instanceof Date)return c;if("string"==typeof e&&(e=r.parseFormat(e)),e.toValue)return e.toValue(c,e,f);var j,l,m,n,o,p={d:"moveDay",m:"moveMonth",w:"moveWeek",y:"moveYear"},s={yesterday:"-1d",today:"+0d",tomorrow:"+1d"};if(c in s&&(c=s[c]),/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/i.test(c)){for(j=c.match(/([\-+]\d+)([dmwy])/gi),c=new Date,n=0;n<j.length;n++)l=j[n].match(/([\-+]\d+)([dmwy])/i),m=Number(l[1]),o=p[l[2].toLowerCase()],c=k.prototype[o](c,m);return k.prototype._zero_utc_time(c)}j=c&&c.match(this.nonpunctuation)||[];var t,u,v={},w=["yyyy","yy","M","MM","m","mm","d","dd"],x={yyyy:function(a,b){return a.setUTCFullYear(g?h(b,g):b)},m:function(a,b){if(isNaN(a))return a;for(b-=1;b<0;)b+=12;for(b%=12,a.setUTCMonth(b);a.getUTCMonth()!==b;)a.setUTCDate(a.getUTCDate()-1);return a},d:function(a,b){return a.setUTCDate(b)}};x.yy=x.yyyy,x.M=x.MM=x.mm=x.m,x.dd=x.d,c=d();var y=e.parts.slice();if(j.length!==y.length&&(y=a(y).filter(function(b,c){return a.inArray(c,w)!==-1}).toArray()),j.length===y.length){var z;for(n=0,z=y.length;n<z;n++){if(t=parseInt(j[n],10),l=y[n],isNaN(t))switch(l){case"MM":u=a(q[f].months).filter(i),t=a.inArray(u[0],q[f].months)+1;break;case"M":u=a(q[f].monthsShort).filter(i),t=a.inArray(u[0],q[f].monthsShort)+1}v[l]=t}var A,B;for(n=0;n<w.length;n++)B=w[n],B in v&&!isNaN(v[B])&&(A=new Date(c),x[B](A,v[B]),isNaN(A)||(c=A))}return c},formatDate:function(b,c,d){if(!b)return"";if("string"==typeof c&&(c=r.parseFormat(c)),c.toDisplay)return c.toDisplay(b,c,d);var e={d:b.getUTCDate(),D:q[d].daysShort[b.getUTCDay()],DD:q[d].days[b.getUTCDay()],m:b.getUTCMonth()+1,M:q[d].monthsShort[b.getUTCMonth()],MM:q[d].months[b.getUTCMonth()],yy:b.getUTCFullYear().toString().substring(2),yyyy:b.getUTCFullYear()};e.dd=(e.d<10?"0":"")+e.d,e.mm=(e.m<10?"0":"")+e.m,b=[];for(var f=a.extend([],c.separators),g=0,h=c.parts.length;g<=h;g++)f.length&&b.push(f.shift()),b.push(e[c.parts[g]]);return b.join("")},headTemplate:'<thead><tr><th colspan="7" class="datepicker-title"></th></tr><tr><th class="prev">'+o.templates.leftArrow+'</th><th colspan="5" class="datepicker-switch"></th><th class="next">'+o.templates.rightArrow+"</th></tr></thead>",
	contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};r.template='<div class="datepicker"><div class="datepicker-days"><table class="table-condensed">'+r.headTemplate+"<tbody></tbody>"+r.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+r.headTemplate+r.contTemplate+r.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+r.headTemplate+r.contTemplate+r.footTemplate+'</table></div><div class="datepicker-decades"><table class="table-condensed">'+r.headTemplate+r.contTemplate+r.footTemplate+'</table></div><div class="datepicker-centuries"><table class="table-condensed">'+r.headTemplate+r.contTemplate+r.footTemplate+"</table></div></div>",a.fn.datepicker.DPGlobal=r,a.fn.datepicker.noConflict=function(){return a.fn.datepicker=m,this},a.fn.datepicker.version="1.7.0",a.fn.datepicker.deprecated=function(a){var b=window.console;b&&b.warn&&b.warn("DEPRECATED: "+a)},a(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(b){var c=a(this);c.data("datepicker")||(b.preventDefault(),n.call(c,"show"))}),a(function(){n.call(a('[data-provide="datepicker-inline"]'))})});
	
	!function(a){a.fn.datepicker.dates.es={days:["Domingo","Lunes","Martes","Mircoles","Jueves","Viernes","Sbado"],daysShort:["Dom","Lun","Mar","Mi","Jue","Vie","Sb"],daysMin:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],today:"Hoy",monthsTitle:"Meses",clear:"Borrar",weekStart:1,format:"dd/mm/yyyy"}}(jQuery);
	</script>
	<script>

		class DatePicker extends Polymer.Element {

	        static get is() { return  'date-picker' }
	
	        static get properties() {
	          return {
	        	text:String,
	           	value:{type:String, reflectToAttribute:true},
	           	hour:{type:Number, value:""},
	           	min:{type:Number, value:""},
	           	options:Object,
	           	language:{type:String, value:"es"},
	           	showTime:{type:Boolean, value:false},
	           	disablePicker:{type:Boolean, value:false},
	           	placeholder:String,
	           	inputClass:{type:String, value:"datepicker"}
	          }
	        }

	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
				
				$(this.$.datepicker).datepicker({autoclose:true, weekStart:1, language:this.language, format:"dd/mm/yyyy"}).
				on('changeDate', function() {
					_this.value = 	$(_this.$.datepicker).val();
					var event = new CustomEvent('dateSelected', {detail:_this.getValue()});
		        	_this.dispatchEvent(event);
		        	_this.$.dateIcon.icon="icons:close";
				});
				
				$(this.$.dateIcon).on('click', function(e) {
					_this.$.dateIcon.icon="icons:date-range";
					_this.reset();
				})
				
				
				if(this.disablePicker) 
					this.disable();
	        }
	        
	        setValue(val) {
	        	if(val ) {
		        	var date = new Date(val);	
		        	$(this.$.datepicker).datepicker('update', date);
		        	this.hour = utils.formatToTwoDigits(date.getHours());
		        	this.min = utils.formatToTwoDigits(date.getMinutes());
		        	$(this.$.datepicker).datepicker("refresh");
		        	this.$.dateIcon.icon="icons:close";
	        	}
	        }
	        
	        setOptions(opt) {
	        	this.options = opt;
	        }
	        
	        getValue() {
	        	
	        	let hour = this.hour || "00";
	        	let min = this.min || "00";
	        	$(this.$.datepicker).data('datepicker').getDate();
	        	let date = $(this.$.datepicker).data('datepicker').getDate();
	        	if(date) {
		        	date.setHours(hour);
		        	date.setMinutes(min);
		        	return date.getTime();
	        	}
	        	
	        	return "";
	        }
	        
	        isValid() {
	        	if (!this.getValue() || !Number.isInteger(Number(this.hour)) || !Number.isInteger(Number(this.min))){
	        		return false;
	        	}
	        	else {
	        		if (this.hour >= 0 && this.hour <= 23 && this.min >= 0 && this.min <= 59){
	        			return true;
	        		}
	        		else {
	        			return false;
	        		}
	        	}
	        }
	        
	        setMinDate(minDate) {
	        	$(this.$.datepicker).data("datepicker").setStartDate(minDate);
	        }
	        setMaxDate(maxDate) {
	        	$(this.$.datepicker).data("datepicker").setEndDate(maxDate);

	        }
	        
	        disable() {
	        	$(this.root).find('input').prop( "disabled", true );
	        }
	        
	        enable() {
	        	$(this.root).find('input').prop( "disabled", false );
	        }
	        
	        reset() {
	        	$(this.root).find('input').val("").datepicker("update");
	        	var event = new CustomEvent('dateSelected', {detail:this.getValue()});
	        	this.dispatchEvent(event);
	        }
	    }
	    
	    customElements.define(DatePicker.is, DatePicker);
	    
    </script> 
</dom-module><dom-module id="file-loader" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		<style>
		
		.container{
			position:relative;
			margin:5px;
		}

		iron-input, input {
			width:100%;
			background-color:transparent;
			display:none;
		}

		input {
			padding:3px 5px;
			margin-top:3px;
			border:0;
			border-bottom:1px solid var(--input-bottom);
    		outline: none;
    		font-size:14px;
    		display:none;
		}

		label {
			
			left:5px;
			top:20px;
			cursor:text;
			color:var(--input-label);
			font-size:14px;
		}
		
		iron-icon {
			cursor:pointer;
			color:var(--input-label)
		}
		
		#files-container {
			display:flex;
			padding:5px;
			flex-wrap:wrap;
		}
		
		#files-container .file-wrapper {
			height:130px;
			width:200px;
			margin-right:10px;
			display:flex;
			justify-content:center;
			align-items:center;
		}
		
		#files-container .file-wrapper img {
			max-height:100%;
			max-width:80%;
		}
		
		.image-resize {
			max-height:70px;
			max-width:70px;
			margin-left:20px;
			opacity:1!important;
		}
		
		.vertical-container {
			display:flex;
			flex-direction:column;
			justify-content:center;
		}
		
		#actions-container {
			margin-left:10px;
		}
		
		.center-content {
			display:flex;
			align-items:center;
			justify-content:center;
		}
	
		
		
		</style>
		
		<div class="container">
			
			<label for="input">{{text}}</label>
			
			<div class="mt10">
				<div class="vertical-container">
					<div style="display:flex">
						<label class="cursor-pointer" for="input">
							<iron-icon icon="icons:file-upload"></iron-icon>
							<span>{{_localize('uploadFiles')}}</span>
						</label>
						<iron-input>
							<input id="input" name="file" type="file" multiple$="{{multipleFiles}}">
						</iron-input>
					</div>
					
				</div>
				
				<div id="files-container"></div>
				
			</div>
			
			
		</div>
	</template> 
	
	<script>
		
		class FileLoader extends Polymer.Element {

	        static get is() { return  'file-loader' }
	
	        static get properties() {
	          return {
	           	text:String,
	           	maxSize:{type:Number, value: 3145728},
	           	maxHeight:{type:Number, value: 2000},
	           	maxWidth:{type:Number, value: 2000},
	           	accept:String,
	           	multipleFiles:{type:String}
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	
	          	this.newFiles = [];
	          	
	          	var fileInput = this.$.input;
	          	fileInput.addEventListener('change', function(e){
	          		_this.onImageSelect();
	          		
	          	})
	        }
	       
	        onImageSelect () {
	        	let fileInput = this.$.input;
				let _this = this;
	          		
	          		if(!_this.multipleFiles) {
	          			$(_this.$['files-container']).empty();
	          		}
	          		
          			let acceptedFiles = "";
          			if(this.accept)
          				acceptedFiles = this.accept.split(',');
          			
          			let imagesArray = ["gif", "jpeg", "png", "jpg"];
          			let videoArray = ["mp4", "avi", "mov"];
          			let otherTypesArray = ["zip", "rar", "pdf"];
          			
	          		$(fileInput.files).each(function(index, file) {
	          			
	          			if(file) {
	          				let split = file.name.split('.');
	              			let fileExtension = split[split.length-1];
	          				
	          				
	              			let fileType= file.type;
		          			if(!fileType){
		          				if(imagesArray.indexOf(fileExtension) >= 0)
		          					fileType = "image";
		          				else if(videoArray.indexOf(fileExtension) >= 0)
		          					fileType = "video";
		          				else 
		          					fileType = fileExtension;
		          			}
	              			
			          		var reader = new FileReader();
			          		reader.onload = function(e) {
			          			
			          			if(file.size > _this.maxSize) {
			          				_this.deleteFile();
			          				alert("El archivo supera el tamao mximo permitido ("+utils.bytesToSize(_this.maxSize)+"): "+file.name );
			          				return;
			          			}
			          			
			          			if(_this.accept) {
			          			 	
			          				let accepted = false;
			          				
			          				acceptedFiles.some((ft) => {
			          					if(file.type.startsWith(ft) || fileType == ft){
			          						accepted = true;
			          						return true;
			          					}
			          				})
			          				if(!accepted) {
			          					if(acceptedFiles.indexOf(fileExtension) >= 0){
			          						accepted = true;
			          					}
			          					else if(acceptedFiles.indexOf(fileExtension) >= 0) {
			          						accepted = true;
			          					}
			          					else if(acceptedFiles.indexOf(fileExtension) >= 0) {
			          						accepted = true;
			          					}
			          				}
			          				
				          			
			          				if(!accepted) {
			          					if(!file.name.endsWith(_this.accept)) {
				          					alert("El tipo de archivo no est permitido");
					          				_this.deleteFile();
					          				return;
			          					}
			          				}
			          				
			          			}
			          			
			          			
			          			
			          			if(fileType.startsWith("image")){
			          				
			          				var image = new Image();
			        				image.src = reader.result;
			          				
									image.onload = function(e) {
										var height = image.height;
										var width = image.width;
										
										if(height > _this.maxHeight || width > _this.maxWidth) {
											_this.deleteFile();
											alert("El archivo supera las dimensiones mximas permitidas ("+_this.maxWidth+"x"+_this.maxHeight+")");
											return;
										}
										_this.newFiles.push(file);
										_this.addImage(file.name, reader.result);
										var event = new CustomEvent('fileSelected');
							        	_this.dispatchEvent(event);
									}
								}
			          			else if(file.type.startsWith("video") || videoArray.indexOf(fileExtension) >= 0) {
			          				_this.newFiles.push(file);
			          				_this.addVideo(file.name, reader.result);
			          			}
			          			else {
			          				_this.newFiles.push(file);
			          				let fileType = file.name.split('\.');
			          				fileType = fileType[fileType.length-1];
			          				_this.addFileNoPreview(file.name, file.name, reader.result, fileType);
			          			}
			          		}
			          		reader.readAsDataURL(file);	
		          		}
		          	})
		          	
		          
	        }
	        
	        addImage(fileName, imgSrc) {
	        	var _this = this;
				var image = new Image();
				image.src = imgSrc;
				this.addFile(fileName, image, imgSrc, "image");
				
	        }
	        
	        addVideo(fileName, videoSrc) {
	        	
	        	var video = document.createElement("video");
  				video.controls="controls";
  				video.height="130";
  				video.width="150";
  				var source = document.createElement("source");
  				source.src = videoSrc;
  				$(video).append(source);
  				this.addFile(fileName, video, videoSrc, "video");
  				
	        }
	        
	        addFile(fileName, fileHTML, fileUrl, fileType) {
	        	
				let _this = this;
	        	let form = document.createElement('form');
				form.fileName = fileName;
				form.fileType = fileType;
				form.fileUrl = fileUrl;
				
				let div = document.createElement('div');
				div.className='file-wrapper';
				
				div.append(fileHTML);
				
				let deleteButton = document.createElement('iron-icon');
				deleteButton.icon = 'icons:delete';
				
				$(deleteButton).on('click', function(e) {_this.deleteFile(this)});
				div.append(deleteButton);
				form.append(div);
				
				let divCenter = document.createElement('div');
				divCenter.className="center-content";
				let span = document.createElement('span');
				span.className='';
				span.innerHTML = fileName;
				divCenter.append(span);
				form.append(divCenter);
				
				$(this.$['files-container']).append(form);
				var event = new CustomEvent('fileLoaded',{'detail':{name:fileName}});
	        	this.dispatchEvent(event); 
	        }
	        
			addFileNoPreview(fileName, fileHTML, fileUrl, fileType) {
	        	
				let _this = this;
	        	let form = document.createElement('form');
				form.fileName = fileName;
				form.fileType = fileType;
				form.fileUrl = fileUrl;
				
				let div = document.createElement('div');
				
				div.append(fileHTML);
				
				let deleteButton = document.createElement('iron-icon');
				deleteButton.icon = 'icons:delete';
				
				$(deleteButton).on('click', function(e) {_this.deleteFile(this)});
				div.append(deleteButton);
				form.append(div);
				
				
				$(this.$['files-container']).append(form);
				var event = new CustomEvent('fileLoaded',{'detail':{name:fileName}});
	        	this.dispatchEvent(event); 
	        }
	        
	        _localize(text) {
	        	return localizer.get(text) ||text;
	        }
	        
	        deleteFile(button) {
	        	$(button).closest('form').remove();
	        }
	        
	        uploadFiles(bucket) {
	        	let _this = this;
	        	
	        	var promise = new Promise((resolve, reject) => {
	        		
	        		var filePromises = [];
        			$(this.$['files-container']).find('form').each(function(index, form) {
        				let isNew = false;
       					
        				$(_this.newFiles).each( (index, elem) => {
       						if(elem.name == form.fileName) {
        						isNew = true;
       							let fd = new FormData();
       							fd.append('file', elem);
       							fd.append('bucket', bucket);
       							fd.append('fileName', form.fileName);
       							var fPromise = new Promise((resolve, reject) => {
	        						utils.fileAjax('/utility/uploadFile', fd, 
		        			        		(response) => {
		        			        			let rsp = {name:form.fileName, url:response, fileType:form.fileType};
		        			        			resolve(rsp);
		        			        		}, 
		        			        		() => {resolve("")});
	        					})
        						filePromises.push(fPromise);
        						return false;
       						}
       					})
        				
        				if(!isNew) {
        					filePromises.push( new Promise((resolve, reject) => {
        						let rsp = {name:form.fileName, url:form.fileUrl, fileType:form.fileType};
        						resolve(rsp);
        					}))
        				}
        			})
	        		
	        		
	        		Promise.all(filePromises).then(values => {
	        			if(values.length > 0)
	        				resolve(values);
	        			else resolve("");
	        		})
	        	});
	        	return promise;
	        }
	        
	        setFiles(filesJSON) {
	        	$(this.$['files-container']).empty();
	        	let files = JSON.parse(filesJSON);
	        	
	        	if(files) {
	        		
	        		if(files instanceof Array) {
	        		
		        		files.forEach((elem) => {
		        			addElem.call(this, elem);
			        	})
	        		}
	        		else {
	        			addElem.call(this, elem);
	        		}
	        	}
	        	
	        	function addElem(elem) {
	        		if(elem.fileType == "video"){
	        			this.addVideo(elem.name, elem.url, elem.fileType);
	        		}
	        		else if(elem.fileType == "image"){
	        			this.addImage(elem.name, elem.url, elem.fileType);
	        		}
	        		else {
	        			this.addFileNoPreview(elem.name, elem.name, elem.url, elem.fileType);
	        		}
	        	}
	        }
	        
	        
	        getFiles() {
	        	let rsp=[];
	        	$(this.$['files-container']).find('form').each((index, form) => {
	        		rsp.push({name:form.fileName, url:form.fileUrl, fileType:form.fileType});
	        	})
	        	return rsp;
	        }
	        
	        hasFiles () {
	        	return $(this.$['files-container']).find('form').length > 0;
	        }

	        hideThumbnails() {
	        	$(this.$['files-container']).hide();
	        }
	        showThumbnails() {
	        	$(this.$['files-container']).hide();
	        }
	        
	        disable() {
        			$(this.$['input']).attr('disabled', true);
	        }
	        
	        enable() {
        			$(this.$['input']).attr('disabled', false);
        		}
	    }
	    
	    customElements.define(FileLoader.is, FileLoader);
	    
    </script> 
</dom-module><dom-module id="csv-reader" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		<style>
		
		.container{
			position:relative;
			margin:5px;
		}

		iron-input, input {
			width:100%;
			background-color:transparent;
			display:none;
		}

		input {
			padding:3px 5px;
			margin-top:3px;
			border:0;
			border-bottom:1px solid var(--input-bottom);
    		outline: none;
    		font-size:14px;
    		display:none;
		}

		label {
			
			left:5px;
			top:20px;
			cursor:text;
			color:var(--input-label);
			font-size:14px;
		}
		
		iron-icon {
			cursor:pointer;
			color:var(--input-label)
		}
		
		#files-container {
			display:flex;
			padding:5px;
			flex-wrap:wrap;
		}
		
		#files-container .file-wrapper {
			height:130px;
			width:200px;
			margin-right:10px;
			display:flex;
			justify-content:center;
			align-items:center;
		}
		
		#files-container .file-wrapper img {
			max-height:100%;
			max-width:80%;
		}
		
		.image-resize {
			max-height:70px;
			max-width:70px;
			margin-left:20px;
			opacity:1!important;
		}
		
		.vertical-container {
			display:flex;
			flex-direction:column;
			justify-content:center;
		}
		
		#actions-container {
			margin-left:10px;
		}
		
		.center-content {
			display:flex;
			align-items:center;
			justify-content:center;
		}
	
		
		
		</style>
		
		<div class="container">
			
			<label for="input">{{text}}</label>
			
			<div class="mt10">
				<div class="vertical-container">
					<div style="display:flex">
						<label class="cursor-pointer" for="input">
							<iron-icon icon="icons:file-upload"></iron-icon>
							<span>{{_localize('loadCSV')}}</span>
						</label>
						<iron-input>
							<input id="input" name="file" type="file" multiple$="{{multipleFiles}}">
						</iron-input>
					</div>
					
				</div>
				
				<div id="files-container">{{fileName}}</div>
				
			</div>
			
			
		</div>
	</template> 
	
	<script>
		
		class CSVReader extends Polymer.Element {

	        static get is() { return  'csv-reader' }
	
	        static get properties() {
	          return {
	           	text:String,
	           	maxSize:{type:Number, value: 3145728},
	           	maxHeight:{type:Number, value: 2000},
	           	maxWidth:{type:Number, value: 2000},
	           	accept:String,
	           	multipleFiles:{type:String},
	           	fileName:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	
	          	this.newFiles = [];
	          	
	          	var fileInput = this.$.input;
	          	fileInput.addEventListener('change', function(e){
	          		let fileInput = _this.$.input;
	          		$(fileInput.files).each(function(index, file) {
	          			_this.newFiles.push(file);
	          			_this.fileName = file.name;
	          			
	          			utils.importCSV(file, (data) => {
	          				var event = new CustomEvent('fileLoaded',{'detail':data});
	        	        	_this.dispatchEvent(event); 
	          			})
	          		})
	          	})
	        }
	        
	        reset() {
	        	this.$.input.value = "";
	        	this.fileName = "";
	        }
	        
	       
	        _localize(text) {
	        	return localizer.get(text) ||text;
	        }
	        
	        getFileName() {
	        	return this.$.input.value;
	        }
	    }
	    
	    customElements.define(CSVReader.is, CSVReader);
	    
    </script> 
</dom-module><dom-module id="account-menu" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		<style>
			
			.account-menu {
				position:relative;
				color:#fff;
			}
			
			.user-icon {
				background-color:var(--dark-background);
				color:var(--primary-color);
				height:40px;
				width:40px;
				z-index:20;
				padding:5px;
				border-radius:50%;
				--iron-icon-height:30px;
				--iron-icon-width:30px;
			}
			
			.menu {
				position:absolute;
				right:0px;
				top:0px;
				height:auto;
				width:auto;
				background-color:var(--dark-background);
				z-index:10;
				 -webkit-transition: width 0.5s, height 0.5s; /* Safari */
    			transition: width 0.5s, height 0.5s;
    			display:none;
    			flex-direction:column;
				overflow:hidden;
				text-align:left;
				white-space:nowrap;
				
			}
			
			.menu li, .menu a {
				color:#fff;
				text-align:left;
				padding:5px;
			}
			
			.menu li:hover {
				background-color:var(--light-background);
				cursor:pointer;
			}
			
			.user-icon:hover {
				border-radius:0;
			}
			.user-icon:hover+.menu, .menu:hover {
				display:flex;
				padding:10px 40px 10px 15px;
				
			}
			
			.small-icon {
				font-size:10px;
				margin-right:5px;
			}
		
			.user-name {
				font-size:16px;
				margin-bottom:5px;
				border-bottom:1px solid #FFF;
				padding:5px 0;
			}
			
			.pt3 {
				padding-top:3px;
			}
			
			
			.roles {
				margin-bottom:5px;
			}
			.roles li {
				display:flex;
			}
			
			.close-session {
				cursor:pointer;
				border-top:1px solid white;
				padding-top:5px;
			}
			
			.flex {
				display:flex!important;
				padding:20px;
			}
			
			.active {
				color:var(--primary-color)!important;
			}
			
			p {
				margin:3px;
			}
		</style>
		<div class="account-menu">
			<iron-icon class="user-icon" icon="social:person"></iron-icon>
			<div class="menu">
				<p class="user-name"> <b>[[name]]</b></p>
				<ul class="roles">
					<template is="dom-repeat" items="{{roles}}" sort="_sort">
						<li class$="[[_getActive(item)]]" data-role$="{{item.idEntity}}##{{item.role.role}}" on-click="_changeAccount">  [[_localizeRole(item.role.role)]]  [[item.nameEntity]]</li>
					</template>
					
				</ul>
				<p class="view-profile">
					<iron-icon class="small-icon" icon="social:person-outline"></iron-icon> 
					<a href="/users/profile" class="pt3"> Ver perfil</a> 
				</p>			
				<p class="close-session">
					<iron-icon class="small-icon" icon="icons:power-settings-new"></iron-icon> 
					<a href="/logout" class="pt3"> Cerrar sesin</a>
				</p>
			</div>
		</div>
	</template> 
	
	<script>

		class AccountMenu extends Polymer.Element {

	        static get is() { return  'account-menu' }
	
	        static get properties() {
	          return {
	           	name:String,
	           	roles:{type:Object, value:function(){return [];}}
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	
	          	var header = localStorage.getItem('accountData')
	          	if(header) {
	          		header = JSON.parse(header);
	          		this.name = header.userHeader.username;
	          		this.roles = header.userHeader.rolesEntities;
	          	}
	          	else {
	          		utils.get('/api/users/header', {}, (response) => {
	          			
	          			this.name = response.username;
		          		this.roles = response.rolesEntities;
		          		
		          		localStorage.setItem("accountData", JSON.stringify(response));
	          		})
	          	}
	          	
	        }

	        _localizeRole(role) {
	        	return localizer.get('roles.'+role);
	        }
	        
	        _getActive(role) {
	        	
	        	var header = JSON.parse(localStorage.getItem('accountData'));
	          	
	        	if(role.idEntity == header.userHeader.roleEntity.idEntity && role.role.role == header.userHeader.roleEntity.role.role) {
	        		return "active";
	        	}
	        }
	        
	        _changeAccount(e){
	        	let elem = utils.getClickedElement(e);
	        	if(!$(elem).hasClass('active')) {
	        		var header = JSON.parse(localStorage.getItem('accountData'));
	        		header.userHeader.rolesEntities.forEach(function(role) {
	        			var split = $(elem).data('role').split('##');
	        			if(role.idEntity == split[0] && role.role.role == split[1] ) {
	        				login.selectProfile(role);
	        			}	
	        		})
	        		
	        	}
	        } 
	        
	        _sort(a, b) {
	        	return a.role.role.toLowerCase().localeCompare(b.role.role.toLowerCase());
	        }			
	    }
	    
	    customElements.define(AccountMenu.is, AccountMenu);
	    
    </script> 
</dom-module><dom-module id="side-bar" assetpath="common/"> 

	<template>
		<style include="styles-conf"></style>
		<style include="common-styles"></style>
		<style>
			.content {
				display:none;
				height:100%;
				z-index: 1000;
				position:fixed; 
				overflow:hidden;
				align-items:flex-start;
				background-color: var(--lighter-background);
				color: #fff;
				padding-top:30px; 
				
			}
			
			
			
			.content:hover {
				overflow-y:auto;
			}
			
			ul , li { 
				list-style : none;
				margin: 0;
				padding: 0;
			}
			
			ul {
				flex-wrap:wrap;
				margin-top:30px;
			}
			
			li {
				width:100%;
				display:flex;
				padding: 5px 12px;
				cursor: pointer; 
				white-space:nowrap;
				color:white;
			}
			
			li a { 
				text-decoration:none;
				margin-left: 10px;
				padding-top: 3px;
				color:inherit;
				padding-right:10px;	
				cursor:pointer;		
				color:var(--primary-color)!important;	
			}
			li:hover {
				background-color: var(--light-background);
				color:var(--dark-background);
			}
			
			li:hover a, li:hover iron-icon {
				color:var(--text-color)!important;
			}
			
			.close-sidebar {
				position: absolute;
				top: 10px;
				right: 10px;
				color:black;
			}
			
			.active {
				color: var(--primary-color);
			}
				
			
			
			.content:hover img {
				visibility:visible;
			}
			
			img {
				display: block;
				width:100%;
				margin-bottom:20px;
				height:70px;
				visibility:hidden;
			}
			
			.submenu {
				width:100%;
			}
			
			.submenu li {
				margin-left:20px;
			}
			
			.hidden {
				display:none;
			}
			
			
			.menu-button {
				border:none;
				background-color:var(--primary-color);
				padding:5px;
				outline: none;
				position:absolute;
			}
			
			
			@media (min-width: 800px) {
				
			
				.content {
					padding-top:10px;
					display:flex;
				}
			}
			
			.active {
				background-color:var(--dark-background);
				position:relative;
			}
			
			.active:after {
				content: "";
			    position: absolute;
			    width: 0;
			    height: 0;
			    right: 0;
			    top: 0;
			    border-top: 17px solid transparent;
			    border-bottom: 17px solid transparent;
			    border-right: 17px solid var(--lighter-background);
			}
			
			.primary {
				color:var(--primary-color);
			}
			
		</style>
		
		
		<button id="menu-button" class="menu-button"><iron-icon icon="icons:menu"></iron-icon></button>
		<div class="content">
			<div id="close-sidebar" on-click="close" class="close-sidebar">
				<iron-icon icon="icons:close"></iron-icon>
			</div>

			<ul id="ul" class="hidden">
				<template is="dom-repeat" items="{{listElems}}">
					<li class$="{{_active(item.url)}}" data-url="{{item.url}}" on-click="menuClick">
						<iron-icon class="primary" icon$="{{_getIcon(item.name)}}"></iron-icon>
						<a href="{{item.url}}">{{_localize(item.name)}}</a>
					</li>
					<ul class="submenu hidden">
						<template is="dom-repeat" items="{{item.sub_menu}}" as="sub">
							<li data-url="{{sub.url}}" on-click="menuClick">
								<a href="{{sub.url}}">{{_localize(sub.name)}}</a>
							</li>
						</template>
					</ul>
				</template>

				<!--li style="text-align: center;">
					<iron-icon icon="icons:explore"></iron-icon>
					<a href="#" style="text-decoration: none;">Attribution model</a>
				</li-->

			</ul>
		</div>
	
	
	
	
	</template> 
	<script>

		class Sidebar extends Polymer.Element {

	        static get is() { return  'side-bar' }
	
	        static get properties() {
	          return {
	          	 listElems:Object
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	
	          	
	          	this.listElems = JSON.parse(localStorage.getItem("accountData")).userHeader.tabs;
	        	/*this.listElems = [
	          		{url:"/campaigns", text:"Campaas", icon:"icons:folder"},
	          		{url:"/creatives", text:"Creatividades", icon:"image:brush"},
	          		{url:"/publishers", text:"Publishers", icon:"hardware:phone-android"},
	          		/*{url:"", text:"Campaas push", icon:"file-download",
	          			sub_menu:[{url:"http://www.google.com", text:"Campaas"}]
	          		},*
	          		
	          		{url:"/agencies", text:"Agencias", icon:"icons:stars"},
	          		{url:"/advertisers", text:"Anunciantes", icon:"icons:chrome-reader-mode"},
	          		
	          		{url:"/offices", text:"Oficinas", icon:"icons:account-balance"},
	          		{url:"/traffickers", text:"Traffickers", icon:"icons:accessibility"}
	          		
	          	];*/
	          	$(this.$['menu-button']).on('click', function() {
	          		$(_this.$.ul).removeClass("hidden");
	    		})
	    		
	    		$(window).click((e) => {
	    			if(e.target != this)
	    				this.close();
	    		})
	    		
	        }
	        
	        close() {
	        	$(this.$.ul).addClass("hidden");
	        }

	        menuClick(e) {
	        	$(this.root).find('.submenu').addClass('hidden');
	        	
	        	var $elem = $(e.srcElement);
          		if($elem.prop('nodeName') !== "LI") {
          			$elem = $elem.closest('li');
          		}
          		
          		$elem.addClass('active');
          		if(!$elem.find('a').attr('href')) {
          			$elem.next().toggleClass('hidden');
          		}
          		else {
          			$elem.find('a')[0].click();
          		}
          	}

			_getIcon(name) {
				let icons = {};
					
				icons.campaigns = "icons:folder";
				icons.creatives = "image:brush";
				icons.publishers = "hardware:phone-android";
				icons.agencies = "icons:stars";
				icons.advertisers = "icons:chrome-reader-mode";
				icons.offices = "icons:account-balance";
				icons.traffickers = "icons:accessibility";
				icons.dashboard = "icons:dashboard";
				icons.pushwoosh_campaigns = "icons:cloud-download";
				icons.pushwoosh_notifications = "icons:cloud-download";
				icons.clusters = "icons:language";
				icons.indoor_analytics = "editor:show-chart";
				icons.outdoor_analytics = "image:wb-sunny";
				icons.omnia = "image:wb-sunny";
				icons.attribution_model = "icons:chrome-reader-mode";
				icons.publisher_report = "social:poll";
				icons.users = "social:people";
				icons.campaign_report = "icons:assignment";
				icons.retailers = "icons:shopping-cart";
				
				return icons[name];
			}
			
			_localize(text) {
				return localizer.get(text);;
			}
	        
			_active(url) {
				return "/"+window.location.pathname.split("/")[1] == url ? "active" : "";
			}
	    }
	    
	    customElements.define(Sidebar.is, Sidebar);
	    
    </script> </dom-module><dom-module id="infinia-header" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		<style>

			header {
				padding:5px;
				display:flex;
				justify-content:center;
				background-color:var(--dark-background);
				color:var(--text-color);
				flex-wrap:wrap;
			}	
			
			.title-section {
				padding:10px;
			}

			.known-users {
				padding-left:10px;
				font-weight:bold;
			}
			
			img {
				max-height:30px;
			}
			a, a:hover {
				text-decoration:none;
				color:inherit;
				position:relative;
				top:-5px;
			}
			
			account-menu {
				position:absolute;
				right:10px;
				top:15px;
			}
			
			.vertical {
				flex-direction:column;
				font-size:10pt;
			}
			
			

			.vertical b {
				font-size:22pt;
			}
			
			.m50 {
					margin:0 50px;
				}
				
			iron-icon.big {
				display:none;
			}
			@media (min-width:700px) {
				iron-icon.big {
					--iron-icon-height:60px;
					--iron-icon-width:60px;
					margin-right:10px;
					display:block;
				}
			}
			
		</style>
		
		<header>
			<div class="flex m50">
				<iron-icon class="big" icon="social:public"></iron-icon>
				<div class="flex vertical">
					<b>{{totalUsers}}</b>
					<a id="am_link" target="_blank">
						{{_upper('known_users_total')}} 
					</a>
				</div>
			</div>
			<div class="flex m50">
				<iron-icon class="big" icon$="maps:{{_getUserCountry()}}"></iron-icon>
				<div class="flex vertical">
					<b>{{users}}</b>
					<a id="am_link" target="_blank">
						{{_upper('known_users_local')}} 
					</a>
				</div>
			</div>
			
				
			
			<account-menu id="menu"></account-menu>
			
		</header>
		
		
	</template> 
	
	<script>

		class InfiniaHeader extends InfiniaPolymer {

	        static get is() { return  'infinia-header' }
	
	        static get properties() {
	          return {
	           	users:String,
	           	totalUsers:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	utils.get("/api/users/_active", {}, function(response) {
	          		_this.users = Number(response).toLocaleString();
	          	})
	          	
	          	utils.get("/api/users/_active/total", {}, function(response) {
	          		_this.totalUsers = Number(response).toLocaleString();
	          	})
	          	
	          	var header = localStorage.getItem('accountData')
	          	if(header) {
	          		header = JSON.parse(header);
	          		if(header.userHeader.username == "fausto") {
	          			$(this.$.am_link).prop('href', 'https://s3.console.aws.amazon.com/s3/buckets/infinia-dmp-landing-pro/?region=eu-west-1&tab=management');
	          		};
	          	}
	        }

			_localize(text) {
				return localizer.get(text);
			}
			_upper(text) {
				return this._localize(text).toUpperCase();
			}
			
			
	    }
	    
	    customElements.define(InfiniaHeader.is, InfiniaHeader);
	    
    </script> 
</dom-module><dom-module id="infinia-table" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			.pagination {
				display:flex;
				justify-content:flex-end;
				margin-right:50px;
				margin-top:20px;
			}
			
			.pagination li {
				padding:5px 10px;
				cursor:pointer;
				border:1px solid var(--primary-color);
			}
			
			.pagination li.active {
				color:white;
				background-color: var(--primary-color);
			}
			
			.filter-div {
				display:flex;
				padding-left:10px;
				margin-top:10px;
				z-index:100;
			}
			
			.filter-container {
				position:absolute;
				z-index:20;
				right:10px;
				background-color:white;
			}
			
			.close {
				display:flex;
				justify-content:flex-end;
				padding:5px;
			}
			
			 .small {
			    --iron-icon-height: 16px;
			    --iron-icon-width: 16px;
			  }
			
			.flex-between {
				display:flex;
				justify-content:space-between;
				padding-right:20px;
			}

			table {
				width:100%;
			}
			th {
				box-sizing:border-box;
				text-transform:uppercase;
				padding:10px;
			}
			
			td {
				box-sizing:border-box;
				padding:10px;
			}

			th, tr {
				cursor:pointer;
			}

			tbody tr:hover {
				background-color:var(--lighter-background);
			}
			thead tr:first-child {
				cursor:pointer;
				border-bottom: 3px solid rgb(17, 46, 54);
			}

			tbody tr {
				border-bottom:1px solid var(--primary-color);
			}

			
			.errorRow {
				background-color:#ff9999!important;
			}
			
			.finalColumn {
				width:60px;
				text-align:right;
			}
		</style>
		
		<div id="title">
			<b>[[title]]</b>
		</div>
		
		
		
		<div id="filter-container" class="filter-div">
		</div>
		
		<table class="">
				<thead>
					<tr>
						<template is="dom-repeat" items="{{tableColumns}}">
							<th on-click="_sortClick">
								<div class="flex-between">  {{_localize(item.value)}}
								<template is="dom-if" if="{{_sortingEnabled()}}"> 
									<iron-icon class="sort-icon small" icon="icons:unfold-more"></iron-icon>
								</template>
								<input type="hidden" value="{{item.value}}">
								</div> 
							</th>
						</template>
						
						<th id="download"><iron-icon on-click="show" style="cursor:pointer" icon="icons:file-download">CSV</iron-icon>
							<iron-dropdown horizontal-align="right" vertical-align="top">
								<div class="drop-down" slot="dropdown-content">
									<ul>		
										<li on-click="_exportCSV"> <iron-icon icon="image:edit"></iron-icon> CSV</li>
										<li on-click="_exportXLS"> <iron-icon icon="icons:menu"></iron-icon> XLS</li>
									</ul>
								</div>
							</iron-dropdown>
						</th>
					</tr>
				</thead>
			
				<tbody>
				
				
					<template id="tableTemplate" is="dom-repeat" items="{{tableRows}}" as="row">
						<tr on-click="_rowClick">					
						<template id="rowTemplate" is="dom-repeat" items="{{row.cells}}" as="cell">
							<td>{{_manageValue(cell)}}</td>
						</template>
						<td class="actions finalColumn"><input type="hidden" value="{{row.id}}"></td>
						</tr>
					</template>
					
								
				</tbody>
			</table>
			
			<div class="pagination-container">
			<ul class="pagination">
				<template is="dom-repeat" items="{{pages}}">
					<li on-click="pageClick">{{item}}</li>			
				</template>
			</ul>
			<div class="pagination mt10">
				mostrando [[currentCount]] de [[totalResults]]
			</div>
			</div>
	</template> 
	
	<script>

		class InfiniaTable extends Polymer.Element {

	        static get is() { return  'infinia-table' }
	
	        static get properties() {
	          return {
	           	tableColumns:{type:Object, value:function(){return[]}},
	           	tableRows:{type:Object, value:function(){return[]}},
	           	totalPages:{type:Number},
	           	disableRowClick:String,
	           	sortingDisabled:{type:String,value:"false"},
	           	currentPage:{type:Number, value:1},
	           	totalResults:{type:Number, value:0},
	           	rowsPerPage:{type:Number, value:15},
	           	currentCount:{type:Number, value:0},
	           	title:{type:String, value:""},
	           	errorColumn:{type:Number, value:0},
	           	disableNumberFormatting:{type:Boolean, value:false}
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	this.$.tableTemplate.addEventListener("dom-change", (event) => {
		          	if(_this.errorColumn) {
		          		$(_this.root).find('.errorRow').removeClass('errorRow');
		          		setTimeout(function() {
		          			_this.tableRows.forEach(function(row) {
		          				if(row.cells[_this.errorColumn].value.startsWith("ERROR")) {
		          					$(_this.root).find('tr').each(function(index, tr) {
		          						if($(tr).find('.actions').find('input').val() == row.id) {
		          							$(tr).addClass('errorRow');
		          						}
		          					})
		          				}
		          			})
		          		}, 100);
	        		}
		          	
		          	if(typeof _this.onHTMLLoaded == "function") {
	      				setTimeout(() => {
	      					_this.onHTMLLoaded(_this, _this.root);
	      				}, 100)
	      			}
	          	});
	        }
	        
	        pageClick(e) {
	        	var page = $(e.target).html();
	        	if(this.currentPage != page && page != "...") {
	        		this.currentPage = page;
	        		var event = new CustomEvent('pageClick', {'detail':{page:page}});
		        	this.dispatchEvent(event);
	        	}
	        }
	        
	        drawPagination() {
	        	var _this = this;
				this.pages = utils.pagination(this.currentPage, this.totalPages);
				
				
				setTimeout(function() {
					_this.activateCurrent();
					
					var showing = (_this.currentPage-1) * _this.rowsPerPage;
					var max = showing+_this.rowsPerPage;
					if(max > _this.totalResults) 
						max = _this.totalResults;
					
					var correct = 1;
					if(_this.totalResults == 0){
						$(_this.root).find('.pagination').addClass('hidden')
					}
					else{
						_this.currentCount = (showing+correct) +"-"+ (max);
					}
					
				}, 100)
	        }
	        
	        activateCurrent() {
	        	$(this.root).find('.pagination .active').removeClass('active');
	        	$(this.root).find('.pagination li').each((index, elem) => {
					if($(elem).html() == this.currentPage){
						$(elem).addClass("active");
						return;
					}
				});
	        }
	        
	        
	        show(e) {
	        	$(utils.getClickedElement(e)).next()[0].open();
			}
	        
	        
	        showFilter() {
	        	$(this.$["filter-container"]).toggleClass('hidden');
	        }
	        
	        /**
        		The action must be the name of a polymer element, e.g "campaign-actions"
	        */
			addAction(action) {
				var _this = this;
				$(this.root).find('.actions').each(function(index, elem) {
					
					$(elem).find('input').next().remove();	
					let actionObject = customElements.get(action);
					if(actionObject) {
						let act = new actionObject;
						act.elemId = $(elem).find('input').val();
						$(elem).append(act);
						$(act).on('click', (e) => {
							e.stopPropagation();
							$(_this.root).find('.actions').each((index, el)  => {
								if(el != elem)
									$(el).children().last()[0].$.context.hide(); 
							})
						});
						$(act).on('rowDelete', (e) => {
							var event = new CustomEvent('rowDelete');
							_this.dispatchEvent(event);
						});
					}
				})
			}
	        
			 /**
        		The filter must be the name of a polymer element, e.g "campaign-filter"
	        */
			addFilter(fil) {
				 
					
					$(this.$["filter-container"]).append(fil);
					
					$(fil).on('applyFilter', (e) => {
						var event = new CustomEvent('applyFilter', {'detail':e.detail});
						this.dispatchEvent(event);
					})
				
			}
	        
	        _localize(text) {
	        	return localizer.get(text) ||text;
	        }
	        
	        _rowClick(e) {
	        	
	        	if(!this.disableRowClick) {
	        	
		        	var elem = utils.getClickedElement(e);
		        	let tr = elem;
		        	if(elem.nodeName != "TR") {
		        		tr = $(elem).closest('tr');
		        	}
		        	var event = new CustomEvent('rowClick', {'detail':$(tr).find('.actions input').val()});
					this.dispatchEvent(event);
	        	}
	        }
	        _exportCSV(e) {
	        	var event = new CustomEvent('exportCSV', {});
				this.dispatchEvent(event);	        	
	        }
	        _exportXLS(e) {
	        	var event = new CustomEvent('exportXLS', {});
				this.dispatchEvent(event);	        	
	        }
	        _sortClick(e) {
	        	
	        	if(this._sortingEnabled()) {
	        	
		        	let th = utils.getClickedElement(e);
		           	if(th.nodeName != "TH") {
		        		th = $(th).closest('th');
		        	}
		           	
		           	var id = $(th).find('input').val();
		        	var current = $(th).find('iron-icon').attr('icon');
		        	var sort = "";
		        	var next;
		        	if(current == 'icons:unfold-more') {
		        		next =  'icons:arrow-drop-up';
		        		sort = 'asc';
		        	}
		        	else if(current == 'icons:arrow-drop-down') {
		        		next =  'icons:unfold-more';
		        		sort = ''
		        	}
		        	
		        	else if(current == 'icons:arrow-drop-up') {
		        		next =  'icons:arrow-drop-down';
		        		sort = 'desc';
		        	}
		        	$(this.root).find('th').find('iron-icon').attr('icon', 'icons:unfold-more');
		        	$(th).find('iron-icon').attr('icon', next);
		        	
		        	var detail = {id:id, sort: sort};
		        	var event = new CustomEvent('sortClick', {'detail':detail});
					this.dispatchEvent(event);
	        	}
	        }
	        
	        _manageValue(item) {
	        	let found=false;
	        	var retValue = item.value;
	        	
	        	if(typeof this.valueManager === "function") {
	        		$(this.tableColumns).each((index, elem) => {
	        			if(item.id == elem.id)
	        				retValue =  this.valueManager(item, elem);
		        	})
	        	}
	        	
	        	
	        	
        		var n = Number(retValue);
        		if(isNaN(n) || this.disableNumberFormatting){
        			if(retValue.startsWith('date_')) {
    	        		let d = new Date(Number(retValue.replace("date_", "")));
    	        		retValue =  utils.formatDate(d);
    	        	}
        		}
        		else 
        			retValue = n.toLocaleString();
        		
	        	return retValue.replace('&amp;', '&');
	        }
	        
	        
	        update(data) {
	        	
	    		this.tableColumns = data.tableColumns;
	    		this.tableRows = data.tableRows;
	    		this.totalResults = data.totalResults;
	    		this.rowsPerPage = data.rowsPerPage;
	    		this.currentPage = data.numPage+1;
	    		this.totalPages = data.totalPages;
				this.drawPagination();
	        	
	        }
	        
	        hidePagination() {
	        	$(this.root).find('.pagination-container').hide();
	        }
	        
	        setTitle(tit) {
	        	this.title = tit;
	        }
	        
	        disableDownload() {
                $(this.$.download).remove();
            }
	        
	        _sortingEnabled() {
	        	return this.sortingDisabled == "false";
	        }
	        
	        disableSorting() {
	        	this.sortingDisabled = "true";
	        	$(this.root).find('.sort-icon').remove();
	        }
	        
	        disableDownload() {
                $(this.$.download).remove();
            }
	    }
	    
	    customElements.define(InfiniaTable.is, InfiniaTable);
	    
    </script> 
</dom-module><dom-module id="accept-block" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
		
			.imports {
				justify-content:flex-end;
				margin-bottom:5px;
			}
			.container {
				display:flex;
				margin-top:20px;
				justify-content:flex-end;
			}
			
			.container > div {
				width:50%;
				min-width:200px;
				margin:0 10px;
			}
			
			header {
				padding:10px;
				background-color:var(--lighter-background);
			}
			
			ul {
				border: 1px solid var(--lighter-background);
				height:200px;
				overflow-y:auto;
			}
			
			li {
				border-top:1px solid var(--lighter-background);
				padding:10px;
				display:flex;
				justify-content:space-between;
			}
			
			@media(min-width:700px) {
				.container {
					margin-top:0;
				}
			}
			
			a, li {
				cursor:pointer;
			}
			
			.mr10 {
				margin-right:10px;
			}
			
			.mr20 {
				margin-right:20px;
			}
			
			header {
				display:flex;
				justify-content:space-between;
			}
		</style>
		
		<div class="container imports">
			<a class="mr20" on-click="exportcsv"><iron-icon icon="icons:file-upload"></iron-icon> Exportar CSV</a>
			<label for="import-csv" class="mr10"><a><iron-icon icon="icons:file-download"></iron-icon> Importar CSV</a></label>
			<input type="file" class="hidden" id="import-csv" on-change="importcsv">
		</div>
		
		<div class="container">

		
			<div>
				<header>
					<div><iron-icon icon="icons:check"></iron-icon> Aceptados</div>
					<div><iron-icon icon="icons:delete" on-click="_removeAllAccepted"></iron-icon></div>
				</header>
				<ul id="accepted">
					<template is="dom-repeat" id="accepted-dom-rep" items="{{accepted}}" sort="_sort">
						<li on-click="remove" item-id="{{item.id}}">
							<span>{{item.value}}</span>
							<iron-icon icon="icons:close"></iron-icon>
						</li>
					</template>
					
				</ul>
			</div>
			
			<div id="block-container">
				<header>
					<div><iron-icon icon="icons:block"></iron-icon> Bloqueados</div>
					<div><iron-icon icon="icons:delete" on-click="_removeAllBlocked"></iron-icon></div>
				</header>
				<ul id="blocked">
					<template is="dom-repeat" id="blocked-dom-rep" items="{{blocked}}" sort="_sort">
						<li on-click="remove" item-id="{{item.id}}">
							<span>{{item.value}}</span>
							<iron-icon icon="icons:close"></iron-icon>
						</li>
					</template>
				</ul>
			</div>
			
		</div>
			
			
	</template> 
	
	<script>

		class AcceptBlock extends Polymer.Element {

	        static get is() { return  'accept-block' }
	
	        static get properties() {
	          return {
	           	accepted:{type:Object, value:function(){return []}, notify:true},
	           	blocked:{type:Object, value:function(){return []}, notify:true},
	           	exportFile: String,
	           	hideBlock:{type:String, value:false}
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	
	          	this.$['accepted-dom-rep'].addEventListener("dom-change", function(event){
	 	        	var event = new CustomEvent('acceptedUpdated', {'detail':this.accepted});
	 	        	this.dispatchEvent(event);
	             });
	          	if(!this.hideBlock) {
		          	this.$['blocked-dom-rep'].addEventListener("dom-change", function(event){
		          		var event = new CustomEvent('blockedUpdated', {'detail':this.blocked});
		 	        	this.dispatchEvent(event);
		             });
	          	}
	          	else {
	          		$(this.$['block-container']).remove();
	          	}
	        }

	        remove(e) {
	        	var clickedLi;
	        	if(typeof e.target.nodeName == 'LI')
	        		clickedLi = e.target;
	        	else
	        		clickedLi = $(e.target).closest('li');
	        	
	        	let id = $(clickedLi).prop('itemId')
	        	
	        	var list = $(e.target).parents('ul');
	        	
	        	let eventData = {};
	        	
	        	if($(list).attr('id') == "blocked"){
	        		this.removeBlocked(id);
		        	eventData.type="blocked";
	        	}
	        	else {
	        		this.removeAccepted(id);
		        	eventData.type="accepted";
	        	}
	        	eventData.id = id;
	        	var event = new CustomEvent('elemRemoved', {'detail':eventData});
	        	this.dispatchEvent(event);
	        }
	        
	        getData(){
	        	return {"accepted":this.accepted, "blocked": this.blocked};
	        }
	        
	        setData(data) {
	        	this.accepted = data.accepted;
	        	this.blocked = data.blocked;
	        }
	        
	        accept(item) {
	        	
	        	if(!item.id || !item.value) return;
	        	
	        	var exists=false;
	        	this.accepted.forEach((elem) => {
	        		if(item.id == elem.id)
	        			exists = true;
	        	})
	        	
	        	this.removeBlocked(item.id);
	        	
	        	if(!exists) {
	        		this.push('accepted',item);
	        		return true;
	        	}
	        	return false;
	        }
	        
	        block(item) {
	        	
	        	if(!item.id || !item.value) return;
	        	
	        	var exists=false;
	        	this.blocked.forEach((elem) => {
	        		if(item.id == elem.id)
	        			exists = true;
	        	})
	        	
	        	this.removeAccepted(item.id);
	        	
	        	if(!exists) {
		        	this.push('blocked', item);
		        	return true;
	        	}
	        	return false;
	        }
	        
	        removeBlocked(id) {
	        	var i;
	        	for (i = 0; i<this.blocked.length; i++) {
	        		if(this.blocked[i].id == id)
	        			break;
	        	}
	        	this.splice('blocked', i,1);
	        	this.blocked = this.blocked.slice();
	        }

	        removeAccepted(id) {
	        	var i;
	        	for (i = 0; i<this.accepted.length; i++) {
	        		if(this.accepted[i].id == id)
	        			break;
	        	}
	        	this.splice('accepted',i,1);
	        }	
	        
	        exportcsv() {
	        	var rows = [];
	        	$(this.accepted).each(function(index, elem) {
	        		rows.push([elem.id, elem.value, "accepted"]);
	        	})
	        	
	        	$(this.blocked).each(function(index, elem) {
	        		rows.push([elem.id, elem.value, "blocked"]);
	        	})
	        	
	        	var file = this.exportFile || "export";
	        	if(rows.length > 0)
	        		utils.generateCSV(file, rows);
	        }
	        
	        importcsv() {
	        	var file = $(this.$["import-csv"])[0].files[0];
	        	var _this = this;
	        	
	        	utils.importCSV(file, function(data) {
	        		data.forEach(function(elem) {
	    				if(elem){
	    					var split = elem.split(";");
	    					if(split.length == 3){
	    						if(split[2].startsWith("accepted")) {
	    							_this.accept({id:split[0], value:split[1]});
	    						}
	    						else if(split[2].startsWith("blocked")) {
	    							_this.block({id:split[0], value:split[1]});
	    						}
	    					}
	    				}
	    			})
	        	})
	        }
	        
	        _removeAllAccepted() {
	        	let _this = this;
	        	this.accepted.forEach(function(elem) {
	        		let eventData = {};
	        		eventData.id = elem.id;
	        		eventData.type="accepted";
		        	var event = new CustomEvent('elemRemoved', {'detail':eventData});
		        	_this.dispatchEvent(event);
	        	})
	        	
				this.accepted = [];
			}
			
			_removeAllBlocked() {
				let _this = this;
				this.blocked.forEach(function(elem) {
	        		let eventData = {};
	        		eventData.id = elem.id;
	        		eventData.type="blocked";
		        	var event = new CustomEvent('elemRemoved', {'detail':eventData});
		        	_this.dispatchEvent(event);
	        	})
				this.blocked = [];
			}

			_sort(a, b) {
	        	return utils.sortAsc(a, b);
	        }
			
	    }
		
	    
	    customElements.define(AcceptBlock.is, AcceptBlock);
	    
    </script> 
</dom-module><dom-module id="infinia-card" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			header {
				background-color: var(--card-title-bg);
				color: var(--card-title-color);
			    padding: 10px;
			    border-bottom: 1px solid var(--primary-color);
			}
			
			header iron-icon {
				margin-right:5px;
			}
			
			section {
				border:1px solid var(--lighter-background);
				padding:10px 20px;
			}
			
			
		</style>
		
		<header>
			<iron-icon icon$="{{titleIcon}}"></iron-icon><b>{{_localizeTitle()}}</b>
		</header>
		<section>
			<slot id="slot"><div class="center-content"><paper-spinner active="active"></paper-spinner></div></slot>
		</section>
			
	</template> 
	
	<script>

		class InfiniaCard extends Polymer.Element {

	        static get is() { return  'infinia-card' }
	
	        static get properties() {
	          return {
	           	title:String,
	           	titleIcon:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	setTimeout(() => {
	          		$(this.root).find('paper-spinner').remove();
	          	}, 5000)
	        }
	        
	        setLoader() {
	        	$(this.$.slot).html('<div class="center-content"><paper-spinner active="active"></paper-spinner></div>');
	        }
	        
	        _localizeTitle() {
	        	return localizer.get(this.title);
	        }
	    }
	    
	    customElements.define(InfiniaCard.is, InfiniaCard);
	    
    </script> 
</dom-module><dom-module id="list-accept-block" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			.content {
				display:flex;
				justify-content:space-between;
				flex-wrap:wrap;
			}
			
			.content > div {
				max-width:49%;
			}
		</style>
		<div class="content">
			<div><selectable-list id="list" hide-block$="[[hideBlock]]"></selectable-list></div>
			<div><accept-block id="ab" hide-block$="[[hideBlock]]"></accept-block></div>
		</div>	
	</template> 
	
	<script>

		class ListAcceptBlock extends Polymer.Element {

	        static get is() { return  'list-accept-block' }
	
	        static get properties() {
	          return {
	        	  hideBlock:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	
	          	$(this.$.list).on('itemAccepted', function(e){
	          		_this.$.ab.accept(e.detail);
	          		var event = new CustomEvent('elem-added', {'detail':e.detail});
	 	        	_this.dispatchEvent(event);
	          	})
	          	
	          	
	          	$(this.$.list).on('acceptedRemoved', function(e){
	          		_this.$.ab.removeAccepted(e.detail.id);
	          		var event = new CustomEvent('elem-removed', {'detail':e.detail});
	 	        	_this.dispatchEvent(event);
	          	})
	          	
	          	$(this.$.list).on('blockedRemoved', function(e){
	          		_this.$.ab.removeBlocked(e.detail.id);
	          		var event = new CustomEvent('elem-removed', {'detail':e.detail});
	 	        	_this.dispatchEvent(event);
	          	})
	          	
	          	$(this.$.list).on('itemBlocked', function(e){
	          		_this.$.ab.block(e.detail);
	          		var event = new CustomEvent('elem-blocked', {'detail':e.detail});
	 	        	_this.dispatchEvent(event);
	          	})
	          	
	          	$(this.$.ab).on('elemRemoved', function(e) {
	          		_this.$.list.removeAccepted(e.detail);
	          		_this.$.list.removeBlocked(e.detail);
	          		var event = new CustomEvent('elem-removed', {'detail':e.detail});
	 	        	_this.dispatchEvent(event);
	          	});
	        }

	        getData() {
	        	if(this.hideBlock == "true")
	        		return this.$.ab.getData().accepted;
	        	else
	        		return this.$.ab.getData();
	        }
	        
	        getList() {
	        	return this.$.list.list;
	        }
	        
	        setList(data) {
	        	this.$.list.setList(data);
	        }
	        
	        accept(item) {
	        	this.$.list.acceptItem(item);
	        }
	        
	        block(item) {
	        	this.$.list.blockItem(item);
	        }
	        
	        removeAccepted(item) {
	        	this.$.list.removeAccepted(item);
	        	this.$.ab.removeAccepted(item.id);
	        }
	        
	        removeBlocked(item) {
	        	this.$.list.removeBlocked(item);
	        	this.$.ab.removeBlocked(item.id);
	        }
	    }
	    
	    customElements.define(ListAcceptBlock.is, ListAcceptBlock);
	    
    </script> 
</dom-module><dom-module id="collapsible-content" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
		
		header {
			display:flex;
			justify-content:space-between;
			align-items:center;
			padding:5px 10px 2px;
			border-bottom:1px solid var(--light-background);
		}
		
		.gold {
			color:var(--primary-color);
			border-bottom:1px solid var(--primary-color);
		}
		
		#content {
			padding:10px;
		}
		</style>
		
		
		<header id="head" class$="{{styleClass}}">
			<span id="title">{{_localizeTitle()}}</span>
			<span><iron-icon id="icon" icon="icons:expand-more"></iron-icon></span>			
		</header>
		<div id="content" class="hidden"><slot></slot></div>
	</template> 
	
	
	<script>

	class CollapsibleContent extends Polymer.Element {

        static get is() { return  'collapsible-content' }

        static get properties() {
          return {
        	  title:String,
        	  styleClass:String,
        	  collapsed:{type:Boolean, value:false}
          }
        }

        constructor() {
          super();
        }

        ready() {
          	super.ready();
          	let _this = this;
          	$(this.$.head).on('click', function() {
          		if($(_this.$.content).is(":visible")) 
          			_this.collapse();
          		else
          			_this.expand();
          	})
          	
          	if(!this.collapsed) {
          		this.expand();
          	} 
        }
        
        collapse() {
        	$(this.$.content).slideUp();
          	$(this.$.icon).attr('icon', 'icons:expand-more');
          
        }
        
        expand() {
        	$(this.$.content).removeClass('hidden');
        	$(this.$.content).slideDown();
        	$(this.$.icon).attr('icon', 'icons:expand-less');
 
        }
        
        _localizeTitle() {
        	return localizer.get(this.title);
        }
	}
	
	
	    
	customElements.define(CollapsibleContent.is, CollapsibleContent);
	    
    </script> 
</dom-module><dom-module id="selectable-list" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			.content {
				display:flex;
				justify-content:space-between;
				flex-wrap:wrap;
			}
			
			.content > div {
				min-width:300px;
			}
			
			.check {
				color:var(--success);
				cursor:pointer;
			}
			
			.block {
				color:var(--error);
				cursor:pointer;
			}
		
			.imports {
				justify-content:flex-end;
				margin-bottom:5px;
			}
			.container {
				display:flex;
				margin-top:20px;
			}
			
			
			
			header {
				padding:10px;
				background-color:var(--lighter-background);
			}
			
			.selectable-list {
				overflow:auto;
				max-height:230px;
				
			}
			
			li {
				border:1px solid var(--lighter-background);
				padding:10px;
				display:flex;
				justify-content:space-between;
			}
			
			
			@media(min-width:700px) {
				.container {
					margin-top:0;
				}
			}
			
			a, li {
				cursor:pointer;
			}
			
			.mr10 {
				margin-right:10px;
			}
			
			.mr20 {
				margin-right:20px;
			}
			
			.header {
				padding:10px;
				background-color:var(--lighter-background);
			}
			
			#selected-list {
				border: 1px solid var(--lighter-background);
				height:200px;
				overflow-y:auto;
			}
			
			#selected-list li {
				border-right:none;
				border-left:none;
			}
			
			.search {
				margin-bottom:10px;
				display:flex;
				justify-content:space-between;
			}
			
			input {
				outline:none;
				border:none;
				border-bottom:1px solid var(--input-border);
			}
			
			.list {
				width:40%;
			}
			
			.accept-block {
				width:50%;
			}
			
			.idelem {
				display:flex;
			}
			
			.selected {
				background-color:var(--lighter-background);
			}
			
		</style>
		<div class="content">
			<div class="list">
				<div class="search">
					<div><label>Buscar: </label><iron-input bind-value="{{filterValue}}">
						<input value="{{value::input}}">
					</iron-input>
					</div>
					<div>
						<template is="dom-if" if="{{_showAcceptAll()}}"><iron-icon on-click="_acceptAll" icon="icons:check" class="check"></iron-icon></template>
						<template is="dom-if" if="{{_showBlock()}}"> <iron-icon on-click="_blockAll" icon="icons:block" class="block"></iron-icon></template>
					</div>
				</div>
				<div id="spinner-container">
					<paper-spinner active="active"></paper-spinner>
				</div>
				
				
				<ul class="list-group selectable-list" id="selectable-list">
					<template id="list-template" is="dom-repeat" items="{{list}}" filter="_search" sort="_sort">
						<li data-id="{{item.id}}" on-click="_selectClick">
							<span class="text">{{item.value}}</span>
							<span class="center-content">
								<template is="dom-if" if="{{_showAccept(item)}}"><iron-icon on-click="_acceptClick" icon="icons:check" class="check"></iron-icon></template>
								<template is="dom-if" if="{{_showBlock(item)}}"><iron-icon on-click="_blockClick" icon="icons:block" class="block"></iron-icon></template>
							</span>
						</li>
					</template>
				</ul>
			</div>
			
		</div>	
	</template> 
	
	
	<script>

	class SelectableList extends Polymer.Element {

        static get is() { return  'selectable-list' }

        static get properties() {
          return {
        	filterValue:{type:String,observer:"_filterType"},
           	list:{type:Object, value:function(){return []}},
        	hideBlock:{type:String, value:false},
        	hideAccept:{type:String, value:false},
        	accepted:{type:Object, value:function(){return []}},
           	blocked:{type:Object, value:function(){return []}},
           	selected:{type:Object, value:function(){return []}},
           	selectable:{type:String, value:"false"},
           	multiSelect:{type:Boolean, value:false},
           	disableSort:{type:Boolean, value:false},
           	selectOne:{type:Boolean, value:false}
          }
        }

        constructor() {
          super();
        }

        ready() {
          	super.ready();
			var _this = this;
			
			setTimeout(function() {
				$(_this.$['spinner-container']).empty();
          	}, 4000)
		}
        
        _search(item) {
        	var str = item.value.toLowerCase()
        	return !this.filterValue || str.indexOf(this.filterValue.toLowerCase()) !== -1;
        }
        
        _filterType() {
        	var event = new CustomEvent('filterList', {'detail':this.filterValue});
    		this.dispatchEvent(event);
    		this._filterList();
        }
        	
        
        _filterList() {
        	
        	
        	
        	let _this = this;
        	this.list = this.list.slice();
        	setTimeout(() => {
        		$(_this.$['selectable-list']).find('.accepted').removeClass('accepted');
            	$(_this.$['selectable-list']).find('.blocked').removeClass('blocked');

        		_this.blocked.forEach(function(elem){
        			$(_this.$['selectable-list']).find('li').each(function(index, li) {
                		if(elem.id == $(li).prop('dataId'))
                			$(li).addClass('blocked');
                	});
        		})
        		
        		_this.accepted.forEach(function(elem){
        			$(_this.$['selectable-list']).find('li').each(function(index, li) {
                		if(elem.id == $(li).prop('dataId'))
                			$(li).addClass('accepted');
                	});
        		})
        		
        		_this.selected.forEach(function(elem){
        			$(_this.$['selectable-list']).find('li').each(function(index, li) {
                		if(elem.id == $(li).prop('dataId'))
                			$(li).addClass('selected');
                	});
        		})
        	}, 200)
        }

        _sort(a, b) {
        	
        	if(!this.disableSort)
        		return utils.sortAsc(a,b);
        }
        
       
        
        _acceptClick(e) {
        	let li = this.getClickedLi(e);
        	
        	if(li.hasClass('accepted')) {
        		this.removeAccepted({id:li.prop('dataId')});
        		var event = new CustomEvent('acceptedRemoved', {'detail':{id:li.prop('dataId')}});
	        	this.dispatchEvent(event);
        	}
        	else {
        		this.accept(this.getClickedLi(e));
        	}
        	e.stopPropagation();
        }
        _blockClick(e) {
        	let li = this.getClickedLi(e);
        	if(li.hasClass('blocked')) {
        		this.removeBlocked({id:li.prop('dataId')})
        		var event = new CustomEvent('blockedRemoved', {id:li.prop('dataId')});
	        	this.dispatchEvent(event);
        	}
        	else {
        		this.block(this.getClickedLi(e));
        	}
        	e.stopPropagation();
        }
        _selectClick(e) {
        	
        	if(this.hideAccept) {
        		this._acceptClick(e);
        	}
        	else {
        	
	        	if(this.selectable=="true") {
		        	let li = this.getClickedLi(e);
		        	
		        	if(li.hasClass('selected')) {
		        		li.removeClass('selected');
		        		let id = li.prop('dataId');
		        		let selected;
		        		let i;
		        		for(i in this.selected) {
		        			if(this.selected[i].id == id) {
								selected = this.selected[i];
		        				break;	        				
		        			}
		        			i++;
		        		}
		        		this.splice('selected', i, 1);
			        	var event = new CustomEvent('elemUnClicked', {'detail':selected});
			        	this.dispatchEvent(event);
		        		return;
		        	}
		        	
		        	else {
			        	if(!this.multiSelect){
			        		this.selected =[];
		        			$(this.root).find('.selected').removeClass('selected');
			        	}
			        	li.toggleClass('selected');
			        	let id = li.prop('dataId');
			        	let selected;
			        	this.list.forEach((elem) => {
			        		if(id == elem.id)
			        			selected = elem;
			        	})
			        	
	
			        	this.push('selected', selected);
			        	var event = new CustomEvent('elemClicked', {'detail':selected});
			        	this.dispatchEvent(event);
		        	}
	        	}
        	}
        }
        
        
        getClickedLi(e) {
        	var clickedLi;
        	if(typeof e.target.nodeName == 'LI')
        		clickedLi = e.target;
        	else
        		clickedLi = $(e.target).closest('li');
        	
        	return $(clickedLi);
        }
        
        
        acceptItem(item) {
        	let _this = this;
        	$(this.$['selectable-list']).find('li').each(function(index, li) {
        		if($(li).prop('dataId') == item.id) {
        			_this.accept($(li));
        		}
        	})
        }
        
        blockItem(item) {
        	let _this = this;
        	$(this.$['selectable-list']).find('li').each(function(index, li) {
        		if($(li).prop('dataId') == item.id) {
        			_this.block($(li));
        		}
        	})
        }
        
        accept(li) {
        	let _this = this;
        	li.addClass('accepted');
        	li.removeClass('blocked');
        	let id = li.prop('dataId');
        	
        	if(this.selectOne) {
        		$(_this.root).find('.accepted').removeClass('accepted');
        		li.addClass('accepted');
        		this.list.forEach(function(elem) {
        			if(elem.id == id) {
        				_this.accepted = [];
        				_this.push('accepted', elem);
        				var event = new CustomEvent('itemAccepted', {'detail':elem});
    	 	        	_this.dispatchEvent(event);
        			}
        		})
        	}
        	
        	else {
        		this.list.forEach(function(elem) {
            		if(elem.id == id) {
            			let exists = false;
            			_this.accepted.forEach((ac) => {
            				if(ac.id == elem.id) exists = true;
            			})
            			
            			let i = 0;
            			_this.blocked.forEach((ac) => {
            				if(ac.id == elem.id) {
            					_this.blocked.splice(i, 1);
            				}
            				i++;
            			})
            			
            			if(!exists) {
            				_this.accepted.push(elem);
            				var event = new CustomEvent('itemAccepted', {'detail':elem});
        	 	        	_this.dispatchEvent(event);
            			}
            		}        			
            	})
        	}
        }
        
        block(li) {
        	let _this = this;
        	li.addClass('blocked');
        	li.removeClass('accepted');
        	let id = li.prop('dataId');
        	
        	if(this.selectOne) {
        		$(_this.root).find('.blocked').removeClass('blocked');
        		li.addClass('blocked');
        		this.list.forEach(function(elem) {
        			if(elem.id == id) {
        				_this.accepted = [];
        				_this.push('accepted', elem);
        			}
        		})
        	}
        	
        	else {

        	
	        	this.list.forEach(function(elem) {
	        		if(elem.id == id) {
	        			let exists = false;
	        			_this.blocked.forEach((ac) => {
	        				if(ac.id == elem.id) exists = true;
	        			})
	        			
	        			
	        			
	        			let i = 0;
	        			_this.accepted.forEach((bl) => {
	        				if(bl.id == elem.id) {
	        					_this.accepted.splice(i, 1);
	        				}
	        				i++;
	        			})
	        			
	        			if(!exists) {
	        				_this.blocked.push(elem);
	        				var event = new CustomEvent('itemBlocked', {'detail':elem});
	    	 	        	_this.dispatchEvent(event);
	        			}
	        		}        			
	        	})
        	}
        }
        
        removeAccepted(elem) {
        	let _this = this;
        	$(this.$['selectable-list']).find('li').each(function(index, li) {
        		if($(li).prop('dataId') == elem.id)
        			$(li).removeClass('accepted');
        		
        		let i = 0;
        		_this.accepted.forEach((bl) => {
    				if(bl.id == elem.id) {
    					_this.splice('accepted', i, 1);
    				}
    				i++;
    			})
        	})
        }
        
        removeBlocked(elem) {
        	let _this = this;
        	$(this.$['selectable-list']).find('li').each(function(index, li) {
        		if($(li).prop('dataId') == elem.id)
        			$(li).removeClass('blocked');
        		
        		let i = 0;
        		_this.blocked.forEach((bl) => {
    				if(bl.id == elem.id) {
    					_this.splice('blocked', i, 1);    					
    				}
    				i++;
    			})
        	})
        }
       
        setAccepted(accList) {
        	let _this = this;
        	accList.forEach((elem) => {
        		$(this.$['selectable-list']).find('li').each(function(index, li) {
	        		if(elem.id == $(li).prop('dataId'))
        				_this.accept($(li))        			
        		})
        	})
        }
        
        setBlocked(accList) {
        	let _this = this;
        	accList.forEach((elem) => {
        		$(this.$['selectable-list']).find('li').each(function(index, li) {
	        		if(elem.id == $(li).prop('dataId'))
        				_this.block($(li))        			
        		})
        	})
        }
        
        _acceptAll() {
        	let _this = this;
        	if(!this.allAccepted) {
        		this.allAccepted = true;
        		$(this.$['selectable-list']).find('li').each(function(index, li) {
            		_this.accept($(li))
            	});
        	}
        	else {
        		this.allAccepted = false;
        		$(this.$['selectable-list']).find('li').each(function(index, li) {
        			_this.removeAccepted({id:$(li).prop('dataId')});
        			var event = new CustomEvent('acceptedRemoved', {'detail':{id:$(li).prop('dataId')}});
    	        	_this.dispatchEvent(event);
            	});
        		
        	}
        }
        
        _blockAll() {
        	let _this = this;
        	if(!this.allBlocked) {
        		this.allBlocked = true;
        		$(this.$['selectable-list']).find('li').each(function(index, li) {
            		_this.block($(li))
            	});
        	}
        	else {
        		this.allBlocked = false;
        		$(this.$['selectable-list']).find('li').each(function(index, li) {
        			_this.removeBlocked({id:$(li).prop('dataId')});
        			var event = new CustomEvent('blockedRemoved', {'detail':{id:$(li).prop('dataId')}});
    	        	_this.dispatchEvent(event);
            	});
        		
        	}
        }
        
        setList(list) {
        	this.list = list;
        	this.list.forEach((elem) => {
        		elem.value = elem.value.replace("&amp;", "&")
        	})
        	this._filterList();
        	$(this.$['spinner-container']).empty();
        }
        
        addList(list) {

        	list.forEach((elem) => {
        		let exists = false;
        		this.list.some((el) => {
        			if(elem.id == el.id) {
        				exists = true;
        				return true;
        			}
        		})
        		if(!exists) {
        			elem.value = elem.value.replace("&amp;", "&")
        			this.push('list', elem);
        		}
        	})
        	this._filterList();
        	$(this.$['spinner-container']).empty();
        }
        
        getData() {
        	return {accepted: this.accepted, blocked: this.blocked};
        }
        
        setAcceptedBlocked(data) {
        	this.setAccepted(data.accepted);
        	this.setBlocked(data.blocked);
        	this._filterList();
        }
        
        setSelected(data) {
        	this.selected = data;
        	this._filterList();
        }
        
        _showBlock(item) {
        	if (item && item.hideBlock){
				return !item.hideBlock;
        	}
			return !this.hideBlock || this.hideBlock == "false";
		}
        
        _showAccept(item) {
        	if (item && item.hideAccept){
				return !item.hideAccept;
        	}
			return !this.hideAccept || this.hideAccept == "false";
		}
        
        clear(id) {
        	let _this = this;
        	$(this.$['selectable-list']).find('li').each(function(index, listelem) {
        		_this.removeAccepted({id:id});
        		_this.removeBlocked({id:id});
        	})
        }
        
       	setLoader() {
       		$(this.$['spinner-container']).html('<paper-spinner active="active"></paper-spinner>');
       	}
       	
        
        removeLoader() {
       		$(this.$['spinner-container']).empty();
       	}
       	
       	removeAllAccepted() {
       		let i = this.accepted.length;
			while (i--) {
				this.removeAccepted(this.accepted[i]);
			}
       	}
       	
       	_showAcceptAll() {
    		return !this.selectOne;
    	}
       	
	}
	
	
	    
	customElements.define(SelectableList.is, SelectableList);
	    
    </script> 
</dom-module><dom-module id="multi-list-selector" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		
		<style>
			.flex {
				display:flex;
				flex-wrap:wrap;
				justify-content:flex-start;
			}
		
			.between {
				justify-content:space-between;
				
			}
			
			.accept-block-container {
				width:35%;
			}
			
			selectable-list {
				margin:10px 10px 10px;
				width:45%;
			}
			
			@media (min-width:800px) {
				#lists-container {
					width:60%;
				} 
			}
			
			.content-center {
				display:flex;
				justify-content:center;
				align-items:center;
				padding:20px;
			}
			
		</style>
		
		<div class="flex between">
				<div class="flex" id="lists-container">
				</div>
				<div class="accept-block-container">
					<accept-block id="accept-block" hide-block$="{{hideBlock}}"></accept-block>
				</div>
		</div>
	</template> 
	
	<script>

		class MultiListSelector extends Polymer.Element {

	        static get is() { return  'multi-list-selector' }
	
	        static get properties() {
	          return {
	        	filterValue:{type:String,observer:"_filterList"},
	           	list:{type:Object, value:function(){return []}, notify:true},
	           	componentData:{type:Object, value: function(){return {}}},
	           	selectedList:{type:Object, value:function(){return []}, notify:true},
				hideBlock:{type:String, value:false}
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	
	          	$(this.$['accept-block']).on('elemRemoved', function(e) {
	          		let id = e.detail.id;
	          		$(_this.$['lists-container']).find('selectable-list').each(function(index, elem) {
	          			elem.clear(id);
	          		})
	          	})
	        }
	        
	        addList(listData) {
				
          		let list = customElements.get('selectable-list');
          		var firstList = new list;
          		firstList.selectable="true";
          		firstList.hideBlock = this.hideBlock;
          		
          		$(this.$['lists-container']).children().last().remove();
          		
          		$(this.$['lists-container']).append(firstList);
          		this.list = listData;
          		firstList.setList(listData);
          		this.setEvents(firstList);
	        }
	        
	        setEvents(elem) {
	        	$(elem).on('itemAccepted', (e) => {
					this.$['accept-block'].accept(e.detail)
				})
				$(elem).on('itemBlocked', (e) => {
					this.$['accept-block'].block(e.detail)
				})
				
				$(elem).on('acceptedRemoved', (e) =>{
					this.$['accept-block'].removeAccepted(e.detail.id);
	          	})
	          	
	          	$(elem).on('blockedRemoved', (e) => {
	          		this.$['accept-block'].removeBlocked(e.detail.id);
	          	})
				
				
				$(elem).on('elemClicked', (e) => {
					var listSelected = (e.target);
					var i;
					var event = new CustomEvent('elemClicked', {'detail':e.detail});
					this.dispatchEvent(event);
					$(this.root).find('selectable-list').each((index, elem) => {
						if(elem == listSelected) 
							i = index;
						else {
							if(index > i)
								$(elem).remove();
						}	
					})
				})
	        }
	        
	        _search(item) {
	        	var str = item.value.toLowerCase()
	        	return !this.filterValue || str.indexOf(this.filterValue.toLowerCase()) !== -1;
	        }
	        
	        _filterList() {
	        	this.list = this.list.slice();
	        }
	        
	        getData() {
	        	return this.$['accept-block'].getData(); 
	        }
	        
	        acceptList(list) {
	        	list.forEach(function(item) {
	        		this.$["accept-block"].accept(item);
	        	})
	        }
	        
	       	blockList(list) {
	        	list.forEach(function(item) {
	        		this.$["accept-block"].block(item);
	        	})
	        }
	        
	        accept(item) {
	        	$(this.root).find('selectable-list').each((index, elem) => {
	        		elem.acceptItem(item);
	        	})
	        	this.$["accept-block"].accept(item);
	        }
	        
	        block(item) {
	        	this.$["accept-block"].block(item);
	        	$(this.root).find('selectable-list').each((index, elem) => {
	        		elem.blockItem(item);
	        	})
	        }
	        
	        setLoader() {
	        	let div = document.createElement('div');
	        	div.className="content-center loader";
	        	let paperSpinner = customElements.get('paper-spinner');
	        	let spinner = new paperSpinner();
	        	
	        	spinner.active = "active";
	        	div.append(spinner);
	        	this.removeLoader();
	        	$(this.$['lists-container']).append(div);
	        }
	        
	        removeLoader() {
	        	$(this.$['lists-container']).find('div.loader').remove();
	        }
	    }
	    
	    customElements.define(MultiListSelector.is, MultiListSelector);
	    
    </script> 
</dom-module><dom-module id="time-table-selector" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
	
			.container {
				display:flex;
				flex-wrap:wrap;
			}
			
			.right {
				justify-content:flex-end;
				padding-right:10px;
				margin-bottom:5px;
			}
			
			.square {
				height:30px;
				width:4.15%;
				border:1px solid var(--input-border);
				display:flex;
				justify-content:center;
				align-items:center;
				cursor:pointer;
			}
			
			.ui-selected {
				background-color:var(--primary-color);
			}
			.ui-selecting {
				background-color:var(--lighter-background);
			}
			
			.labels {
				width:10%;
				display:flex;
				flex-direction:column;
			}
			.table {
				width:90%;
				margin-bottom:0;
			}
			
			.label {
				height:30px;
				border:1px solid var(--input-border);
				display:flex;
				padding-left:10px;
				align-items:center;
				background-color:var(--lighter-background);
			}
			
			a {
				cursor:pointer;
			}
		</style>
		
		<div class="container right">
			<a on-click="clean">Borrar</a>
		</div>
				<div class="container">
					<div class="labels"></div>
					<ul class="container table">
					<template is="dom-repeat" items="{{hours}}" as="hour">
						<li class="square label">{{hour}}</li>
					</template>
					</ul>
				</div>
				
				<div class="container">
					<div class="labels">
						<template is="dom-repeat" items="{{dayNames}}">
						<div class="label">
							{{item}}
						</div>
						</template>
					</div>
					
					<ul class="container table">
					<template is="dom-repeat" items="{{days}}" as="day">
						
						<template is="dom-repeat" items="{{hours}}" as="hour">
							<li data-date="{{day}}-{{hour}}" class="square"></li>
						</template>
					</template>
					</ul>
				
				</div>
				
			
			
	</template> 
	
	<script>

		class TimeTableSelector extends Polymer.Element {

	        static get is() { return  'time-table-selector' }
	
	        static get properties() {
	          return {
	          	hours:{type:Object, value:function(){return []}},
	          	days:{type:Object, value:function(){return []}},
	          	dayNames:{type:Object, value: function() {return [localizer.get('weekDays.monday'), localizer.get('weekDays.tuesday'),localizer.get('weekDays.wednesday'),localizer.get('weekDays.thursday'),
	          		localizer.get('weekDays.friday'),localizer.get('weekDays.saturday'),localizer.get('weekDays.sunday')];}}
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	var _this = this;
	          	
	          	for(var i=0; i<24;i++){
	          		this.push('hours', i);
	          	}
	          	
	          	for(i=1; i<8; i++) {
	          		this.push('days', i);
	          	}
	          	
	          	setTimeout(function() {
	          		$(_this.root).find('.table').selectable();
	          	}, 300);
	        }
	        
	        getData() {
	        	var timetable={};
	        	$(this.root).find('.ui-selected').each(function(index, elem) {
	        		var dat = $(elem).prop('dataDate').split('-');
	        		if(typeof timetable[dat[0]] == "undefined")
	        			timetable[dat[0]] = [];
	        		timetable[dat[0]].push(dat[1]);
	        	})
	        	return timetable;
	        }
	        
	        setData(data) {
	        	if (data){
		        	Object.keys(data).forEach((day) => {
		        		data[day].forEach((hour) => {
		        			$(this.root).find('.square').each((index, elem) => {
		        				if($(elem).prop('dataDate') == day+"-"+hour)
		        					$(elem).addClass('ui-selected');
		        			});
		        		});
		        	});
	        	}
	        }
	        
	        
	        clean() {
	        	$(this.root).find('.ui-selected').removeClass('ui-selected');
	        }
	    }
	    
	    customElements.define(TimeTableSelector.is, TimeTableSelector);
	    
    </script> 
</dom-module><dom-module id="table-filter" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		<style>
		
		:host {
			width:100%;
			padding-bottom:10px;
		}
		
		a {
			cursor:pointer;
			color:var(--primary-color);
		}
		
		#filter-list {
			display:flex;
			flex-wrap:wrap;
			border-bottom:2px solid var(--lighter-background);
			padding-bottom:5px;
			width:100%;
		}
		
		#filter-list > div {
			margin-right:20px;
			margin-bottom:10px;
		}
		
		input.gold, select {
			
			padding:3px 8px;
			border:1px solid var(--primary-color);
			border-radius: 10px;
		}
		
		select {
			background-color:var(--primary-color);
			margin-right:3px;
			color:white;
			opacity:0.8;
		}
		
		.flex-end {
			display:flex;
			justify-content:flex-end;
			width:100%;
		}
		
		label {
			display:block;
		}
		
		
		.container {
			width:100%;
		}
		
		@media(min-width:1000px) {
			#filter-list {
				flex-wrap:nowrap;
			}
		}
		
		</style>
		
		
			<div class="container">
				
				<div class="mt10" id="filter-list">
					<template is="dom-repeat" items="{{fields}}" as="field">
					
						<template is="dom-if" if="{{!field.date}}">
							<div><input placeholder$="{{_localize(field.name)}}" type="text" class="gold keyup" name="{{field.name}}"></div>
						</template>
					
						<template is="dom-if" if="{{field.date}}">
							<div>
								
								<div style="display:flex;">
								<select on-change="setFilter">
									<option value="<">{{_localize('lowerThan')}}</option>
									<option value="=">{{_localize('equal')}}</option>
									<option value=">">{{_localize('greaterThan')}}</option>
								</select>
									<date-picker id="{{field.name}}" input-class="gold" placeholder$="{{_localize(field.name)}}"></date-picker>
								</div>
							</div>
						</template>
					</template>
				</div>
			</div>
		
			
			
		
		
	</template> 
	
	<script>

		class TableFilter extends Polymer.Element {

	        static get is() { return  'table-filter' }
	
	        static get properties() {
	          return {
	        	  fields:{type:Object, value: function() {return [];}, observer:"_setEvents"},
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	
	          	
	          	
	        }

	        show(e) {
	        	$(this.$['filter-list']).toggleClass("hidden");
			}
	        
	        setFilter() {
	        	let data={};
	        	$(this.root).find('input').each((index, elem) => {
	        		if($(elem).val())
	        			data[$(elem).prop('name')] = $(elem).val();
	        	})
	        	$(this.root).find('date-picker').each((index, elem) => {
	        		let dat = elem.getValue();
	        		if(dat) {
	        			dat = new Date(dat);
	        			let date = dat.getFullYear()+"-"+(dat.getMonth()+1)+"-"+dat.getDate()+" 00:00:00";
	        			data[$(elem).attr('id')] = date + "|" + $(elem).prev().val(); 
	        		}
	        	})
	        	
	          	var event = new CustomEvent('applyFilter', {'detail':data});
	        	this.dispatchEvent(event);
	        	
	        	return data;
	        }
	        
	        _localize(textId) {
	        	return localizer.get(textId);
	        }
	        
	        _setEvents () {
	        	setTimeout(() => {
	        		$(this.root).find('.keyup').keyup(() => {
		          		this.setFilter();
		          	})
		          	
		          	$(this.root).find('date-picker').on('dateSelected',() => {
		          		this.setFilter();
		          	})
	        	}, 100)
	        }
	    }
	    
	    customElements.define(TableFilter.is, TableFilter);
	    
    </script> 
</dom-module><dom-module id="quantitative-analytical" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<!-- Estilos del propio componente -->
		<style>
			.container {
				border: 1px solid var(--primary-color);
				box-shadow: 2px 2px 1px #888888;
				margin: 0 auto;
				padding: 5px;
				height:100%;
			}
			
			hr {
				size: 100%;
				height: 1px;
				background-color: var(--primary-color);
				margin: 0;
			}
			
			h3, h2 {
				margin-left: 2px;
			}
			
			span {
				margin-left: 2px;
				color: #999;
				font-size: 12px;				
			}
			
			.col-container {
			    display: table; /* Make the container element behave like a table */
			    width: 100%; /* Set full-width to expand the whole page */		    
			}
			
			.col {
			    display: table-cell; /* Make elements inside the container behave like table cells */
			}					
		</style>
		
		<div class="container">
			<div class="row">
				<h3>{{_localize(title)}}</h3>
				<span>{{_localize(subTitle)}}</span>
			</div>
			<hr>
			<div class="col-container">
				<div class="col" style="vertical-align: middle;text-align: center;color: #999;">
					<iron-icon icon="{{logo}}"></iron-icon>
				</div>
				<div class="col">
					<h3>{{_localize(content)}}</h3>
					<span>{{_localize(contentSubtitle)}}</span>
				</div>
			</div>
		</div>
	</template>
	
	<script>
		class QuantitativeAnalytical extends Polymer.Element {
			static get is() {
				return "quantitative-analytical";
			}
			
			static get properties() {
				return {
					title: String,
					subTitle: String,
					logo: String,
					content: String,
					contentSubtitle: String
				}
			}
			
			constructor() {
				super();
			}
			
			ready() {
				super.ready();
			}
			
			setTitle(title) {
				this.title = title;
			}
			
			setSubTitle(subTitle) {
				this.subTitle = subTitle;
			}
			
			setLogo(logo) {
				this.setLogo = logo;
			}
			
			setContent(content) {
				this.content = content;
			}
			
			setContentSubTitle(contentSubTitle) {
				this.contentSubTitle = contentSubTitle;
			}

			_localize(text) {
				return localizer.get(text);
			}
		}
		
		customElements.define(QuantitativeAnalytical.is, QuantitativeAnalytical);
	</script>
</dom-module><dom-module id="line-chart" assetpath="common/charts/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			#chart {
				height:300px;
			}
		</style>
		<div id="chart">
			
		</div>	
	</template> 
	
	
	<script>

	
	
	class LineChart extends Polymer.Element {

        static get is() { return  'line-chart' }

        static get properties() {
          	return {
        	  	title:String,
          		data:{type:Object, value:function(){return [];}}
          	}
        }

        constructor() {
          super();
        }

        ready() {
          	super.ready();
          	
        }
        
        drawChart() {
        	let _this = this;
        	google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(function() {
            	
	            var options = {
	              title: _this.title,
	              legend: { position: 'right' },
	              chartArea: {'left':'5%','width': '80%', 'height': '60%'},
	              lineWidth: 1,
	            };
	
	            var chart = new google.visualization.LineChart(_this.$.chart);
	            let data =  google.visualization.arrayToDataTable(_this.data);
	            chart.draw(data, options);
        	})
        
		}
        
        setData(dat) {
        	this.data = dat;
        }
        
        setTitle(tit) {
        	this.title = localizer.get(tit);
        }
	
	}
	    
	customElements.define(LineChart.is, LineChart);
	    
    </script> 
</dom-module><dom-module id="pushwoosh-chart" assetpath="common/charts/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			#chart {
				width: 100%;
				height: 300px;
			}
		</style>
		
		<div id="chart">
		</div>
	</template>
	<script>
		class PushwooshChart extends Polymer.Element {
			static get is() {
				return "pushwoosh-chart";
			}
			
			static get properties() {
				return {
					title: String,
					subtitle: String,
					data: {
						type: Object, 
						value: function() {return [];}
					},
					width: String,
					height: String,
					margin: String,
					colors: {
						type: Object,
						value: function() {return [];}
					}
				};
			}
			
			constructor() {
				super();
			}
			
			ready() {
				super.ready();
			}			
			
			drawChart() {
				let _this = this;
				
				google.charts.load('current', {'packages':['bar']});
	            google.charts.setOnLoadCallback(function() {	            	
		            var options = {
		              title: _this.title,
		              subtitle: _this.subtitle,
		              colors: _this.colors
		            };
		
		            var chart = new google.charts.Bar(_this.$.chart);
		            
		            if(_this.width)
		            		_this.$.chart.style.width = _this.width;
		            
		            if(_this.height)
	            			_this.$.chart.style.height = _this.height;
		            
		            if(_this.margin)
	            			_this.$.chart.style.margin = _this.margin;
		            
		            let dat = _this.data;
		            let data =  google.visualization.arrayToDataTable(dat);
		            chart.draw(data, google.charts.Bar.convertOptions(options));
	        		});
			}
			
			setData(dat) {
				this.data = dat;
			}
			
			setTitle(tit) {
				this.title = tit;
			}
			
			setSubtitle(sub) {
				this.subtitle = sub;
			}
			
			setWidth(width) {
				this.width = width;
			}
			
			setHeight(height) {
				this.height = height;
			}
			
			setMargin(margin) {
				this.margin = margin;
			}
			
			setColors(colors) {
				this.colors = colors;
			}
		}
		
		customElements.define(PushwooshChart.is, PushwooshChart);
	</script>
</dom-module><dom-module id="progress-bar" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			
			.container {
				margin:0;
				width:100%;
				border:1px solid var(--dark-background);
				height:100%;
				border-radius:8px;
				overflow:hidden;
			}
			
			.progress {
				height:100%;
				font-size:10pt;
				padding:3px 0;
				max-width:100%;
			}
			
			.value {
				margin-left:10px;
			}
		</style>
		
		<div class="container" style$="border-color:{{color}}">
			<div class="progress" style$="width:{{progress}}%; background-color:{{color}}">
				<span class="value">{{progress}}%</span>
			</div>
		
		</div>
	</template> 
	
	<script>

		class ProgressBar extends Polymer.Element {

	        static get is() { return  'progress-bar' }
	
	        static get properties() {
	          return {
				   progress:{type:Number, value:0, observer: 'updateColor'},
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }
	        
	        updateColor() {
	        	if(this.progress < 70) 
					  this.color = "#E75954";
	          	else if(this.progress < 94)
					  this.color = "#FECC50";
	          	else 
					  this.color = "#2FD566";
	        }
	    }
	    
	    customElements.define(ProgressBar.is, ProgressBar);
	    
    </script> 
</dom-module><dom-module id="summary-data" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			.summary iron-icon {
				height: 80px;
			    width: 80px;
			    color:var(--primary-color);
			}
			
			.summary .top-value {
				font-size:25px;
				font-weight:bold;
				color:var(--dark-background);
			}
			
			p {
				margin:0;
				padding:0;
				
			}
			.flex-center {
				margin:15px 10px;
				
			}
			
			
		</style>
		
		<div class="summary">
			<div class="flex-center mt20 mb20 content">
				<div class="flex-center mb20"> 
					<iron-icon class="summary" icon="notification:wc" style="."></iron-icon>
					<p style="width:100%;" class="mt10 center-content top-value" id="summary-top-gender">{{gender}}</p>
					<p>{{localize('gender')}}</p>
				</div>
				
				<div class="flex-center mb20"> 
					<iron-icon class="summary" icon="icons:face"></iron-icon>
					<p style="width:100%;" class="mt10 center-content top-value" id="summary-top-age">{{age}}</p>
					<p>{{localize('age')}}</p>
				</div>
				
				<div class="flex-center mb20"> 
					<iron-icon class="summary" icon="editor:attach-money"></iron-icon>
					<p style="width:100%;" class="mt10 center-content top-value" id="summary-top-income_level">{{income_level}}</p>
					<p>{{localize('income.level')}}</p>
				</div>
				
				<div class="flex-center mb20"> 
					<iron-icon class="summary" icon="icons:bookmark-border"></iron-icon>
					<p style="width:100%;" class="mt10 center-content top-value" id="summary-top-categories_app">{{categories_app}}</p>
					<p>{{localize('categories_app')}}</p>
				</div>
			
				
				<div class="flex-center mb20"> 
					<iron-icon class="summary" icon="icons:track-changes"></iron-icon>
					<p style="width:100%;" class="mt10 center-content top-value" id="summary-top-iab">{{iab}}</p>
					<p>{{localize('iab')}}</p>
				</div>
				
				<div class="flex-center mb20"> 
					<iron-icon class="" icon="av:new-releases"></iron-icon>
					<p style="width:100%;" class="mt10 center-content top-value" id="summary-top-interests">{{interests}}</p>
					<p>{{localize('interests')}}</p>
				</div>
			</div>	
		</div>
	</template> 
	
	<script>

		class SummaryData extends Polymer.Element {

	        static get is() { return  'summary-data' }
	
	        static get properties() {
	          return {
	           	gender:{type:String, value:"-"},
	           	age:{type:String, value:"-"},
	           	income_level:{type:String, value:"-"},
	           	categories_app:{type:String, value:"-"},
	           	iab:{type:String, value:"-"},
	           	interests:{type:String, value:"-"}
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }			
	        
	        localize(text) {
	        	return localizer.get(text);
	        }
	    }
	    
	    customElements.define(SummaryData.is, SummaryData);
	    
    </script> 
</dom-module><dom-module id="cluster-selector" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
				
		
		</style>
		
		
		<div class="center-content mt20 ml10">
			<selectable-list id="clusters_list" hide-accept="true" hide-block="true" select-one="true"></selectable-list>
		</div>
	</template> 
	
	<script>

		class ClusterSelector extends Polymer.Element {

	        static get is() { return  'cluster-selector' }
	
	        static get properties() {
	          return {
	          	
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	let _this = this;
	          	
	          //Load clusters
	        	this.doSearch(this.$.clusters_list, "");
	        	
	        	$(this.$.clusters_list).on('filterList', function(e) {
	        		_this.doSearch(this, e.detail);
	        	})
	        	
	          	$(this.$.clusters_list).on('itemAccepted', function(e) {
	        		
	          		var event = new CustomEvent('clusterSelected', {'detail':e.detail.id});
	        		_this.dispatchEvent(event);
	        		
	        	})
	        	
	        	$(this.$.clusters_list).on('acceptedRemoved', function(e) {
	        		var event = new CustomEvent('clusterRemoved', {'detail':e.detail.id});
	        		_this.dispatchEvent(event);
	        		
	        		
	        	})
	        }			
	        
	        doSearch(selList, filter) {
	        	utils.get('/api/clusters?filters=name|'+filter+'&numRecords=100',{}, function(response){
	        		let list = [];
	        		response.tableRows.forEach((row) => {
	        			let elem = {id:row.id, value:row.cells[0].value};
	        			list.push(elem);
	        		})
	        		selList.setList(list);
	        	})
	        }
	    }
	    
	    customElements.define(ClusterSelector.is, ClusterSelector);
	    
    </script> 
</dom-module>
<dom-module id="infinia-tabs" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			.section-breadcrumb {
				display:flex;
				margin:10px 0;
				padding:0;
				border-bottom:3px solid var(--primary-color);
				padding-left:5px;
			}
			
			.section-breadcrumb a {
				list-style:none;
				padding:7px 12px;
				cursor:pointer;
				background-color:var(--lighter-background);
				color:var(--dark-background);
				margin-right:5px;
				font-size:12pt;
				text-decoration:none!important;
			}
			
			.section-breadcrumb	a.active {
				background-color:var(--primary-color);
				text-decoration:none!important;
				color:black;
				font-weight:bold;
			}
		
			.disabled{
				position:relative;
				background-color: #a5a5a540!important;
    			color: white!important;
			}
			.disabled:before {
				content: "";
			    position: absolute;
			    height: 100%;
			    width: 100%;
			    cursor: default;
			    top: 0px;
			    left: 0px;
			    z-index: 1000;
			    opacity: 0.8;
			    background-image: -webkit-repeating-radial-gradient(center center, rgba(0,0,0,0.2), rgba(0,0,0,0.2) 1px, transparent 1px, transparent 100%);
			    background-image: -moz-repeating-radial-gradient(center center, rgba(0,0,0,0.2), rgba(0,0,0,0.2) 1px, transparent 1px, transparent 100%);
			    background-image: -ms-repeating-radial-gradient(center center, rgba(0,0,0,0.2), rgba(0,0,0,0.2) 1px, transparent 1px, transparent 100%);
			    background-image: repeating-radial-gradient(center center, rgba(0,0,0,0.2), rgba(0,0,0,0.2) 1px, transparent 1px, transparent 100%);
			    -webkit-background-size: 3px 3px;
			    -moz-background-size: 3px 3px;
			    background-size: 3px 3px;
			}				
		
		</style>
		
	<div class="section-breadcrumb mt20" id="tabs">
		<template id="template" is="dom-repeat" items="{{labels}}">
				<a href$="{{item.href}}" on-click="tabClick">
					<template is="dom-if" if="{{item.icon}}">
						<iron-icon icon$="{{item.icon}}"></iron-icon>
					</template>	
					 {{_localize(item.text)}}</a>
			
		</template>
	</div>
	
	<div id="slots">
		<template is="dom-repeat" id="slots_template" items="{{slots}}">
			<div><slot name="{{item}}"></slot></div>
		</template>
	</div>
			
	</template> 
	
	<script>

		class InfiniaTabs extends InfiniaPolymer {

	        static get is() { return  'infinia-tabs' }
	
	        static get properties() {
	          return {
	           	dataText:String,
	           	icons:String,
	           	hrefs:String,
	           	labels:{type:Array, value(){return []}},
	            slots:{type:Array, value(){return []}},
	            active:{type:Number, value:0}
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	this.drawTabs();
	          	
	          	this.$.slots_template.addEventListener("dom-change", (event) => {
	          		$(this.$.slots).find('div').hide();
	          		$(this.$.slots).find('div').first().show();
	          	})
	        }
	        
	        drawTabs() {
	        	this.labels = [];
	        	let dataSplit = this.dataText.split(',');
	          	let iconsSplit = this.icons ? this.icons.split(",") : null;
	          	let hrefSplit = this.hrefs ? this.hrefs.split(",") : null;
	          	dataSplit.forEach((elem, i) => {
	          		let icon = iconsSplit && iconsSplit[i] ? iconsSplit[i] : "";
	          		let href = hrefSplit && hrefSplit[i] ? hrefSplit[i] : "#";
	          		this.push('labels',{text:elem.trim(), icon:icon, href:href});
	          	})
	          	
	          	setTimeout(() => {
		          	$(this.$.tabs).find('a').removeClass('active');
		          	$($(this.$.tabs).find('a').get(this.active)).addClass('active');
	          	}, 100)

	          	
	          	for (let i=0; i< dataSplit.length; i++){
	          		this.push('slots', i);
	          	}
	        }
	        
	        tabClick(e) {
	        	
	        	let elem = utils.getClickedElement(e);
	        	
	        	if(elem.nodeName != 'A') elem = elem.closest('a');
	        	
	        	if($(elem).hasClass('disabled')) {
	        		e.preventDefault();
	        		return;
	        	}
	        	
	        	if(elem.nodeName == 'A' && elem.href.endsWith("#"))
	        		e.preventDefault();
	        	else return;	
	        	
	        	$(this.$.tabs).find('a').removeClass('active');
	        	$(elem).addClass('active');
	        	$(this.$.slots).find('div').hide();
	        	$(this.$.tabs).find('a').each((index, a) => {
	        		if(a == elem) {
	        			$($(this.$.slots).find('div').get(index)).show();
	        			let event = new CustomEvent('tabClicked', {detail:index});
	    	        	this.dispatchEvent(event);
	        		}
	        		
	        		
	        	})
	        }
	        
	      	addTab(index, text, icon, href) {
	      		icon = icon || "";
	      		href = href || "";
	      		
	      		let split = this.dataText.split(",");
	      		split.splice(index, 0,text);
	      		this.dataText = split.join(",");
	      		
	      		if(this.icons){
	      			let iconsSplit = this.icons.split(",");
	      			iconsSplit.splice(index, 0, icon);
	      			this.icons = iconsSplit.join(",");
	      		}
	      		if(this.hrefs){
	      			let refSplit = this.hrefs.split(",");
	      			refSplit.splice(index, 0, href);
	      			this.hrefs = refSplit.join(",");
	      		}
	      		this.drawTabs();
	      	}
	      	
	      	disableTab(index) {
	      		$($(this.$.tabs).find('a').get(index)).addClass('disabled');
	      	}
	      	
	      	enableTab(index) {
	      		$($(this.$.tabs).find('a').get(index)).removeClass('disabled');
	      	}
	      	
	      	setActive(index) {
	      		this.active = index;
	      	}
	    }
	    
	    customElements.define(InfiniaTabs.is, InfiniaTabs);
	    
    </script> 
</dom-module><dom-module id="infinia-context" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			iron-dropdown {
				left:auto!important;
				right:60px!important;
			}

		</style>
		
		<div style="position:relative;">
		<iron-icon on-click="toggle" icon="icons:settings" class="settings"></iron-icon>
		<iron-dropdown horizontal-align="right" vertical-align="top" id="dropdown">
			<div class="right-arrow"></div>
			<div class="drop-down" slot="dropdown-content">
				<slot name="context-slot"></slot>
			</div>
		</iron-dropdown>
	</div>

	</template> 
	
	<script>

		class infiniaContext extends Polymer.Element {

	        static get is() { return  'infinia-context' }
	
	        static get properties() {
	          return {
	           	
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }			

	        show() {
	        	this.$.dropdown.show();
			}

			toggle() {
	        	this.$.dropdown.toggle();
			}
	        
	        
	        hide() {
	        	this.$.dropdown.close();
			}

	    }
	    
	    customElements.define(infiniaContext.is, infiniaContext);
	    
    </script> 
</dom-module><dom-module id="removable-content" assetpath="common/">
	<template>
		<style include="common-styles"></style>
		
		<style>
		
		</style>
		
		<div>
			<iron-icon icon="icons:close"></iron-icon>
		</div>
		<slot>
		</slot>
			
	</template> 
	
	<script>

		class RemovableContent extends Polymer.Element {

	        static get is() { return  'removable-content' }
	
	        static get properties() {
	          return {
	           	
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }			
	    }
	    
	    customElements.define(RemovableContent.is, RemovableContent);
	    
    </script> 
</dom-module><dom-module id="pie-chart" assetpath="common/charts/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			.content {
				display:flex;
				justify-content:space-between;
				flex-wrap:wrap;
			}
			
			.content > div {
				min-width:300px;
			}
			
			.check {
				color:var(--success);
				cursor:pointer;
			}
			
			.block {
				color:var(--error);
				cursor:pointer;
			}
		
			.imports {
				justify-content:flex-end;
				margin-bottom:5px;
			}
			.container {
				display:flex;
				margin-top:20px;
			}
			
			
			
			header {
				padding:10px;
				background-color:var(--lighter-background);
			}
			
			.selectable-list {
				overflow:auto;
				max-height:200px;
			}
			
			li {
				border:1px solid var(--lighter-background);
				padding:10px;
				display:flex;
				justify-content:space-between;
			}
			
			
			@media(min-width:700px) {
				.container {
					margin-top:0;
				}
			}
			
			a, li {
				cursor:pointer;
			}
			
			.mr10 {
				margin-right:10px;
			}
			
			.mr20 {
				margin-right:20px;
			}
			
			.header {
				padding:10px;
				background-color:var(--lighter-background);
			}
			
			#selected-list {
				border: 1px solid var(--lighter-background);
				height:200px;
				overflow-y:auto;
			}
			
			#selected-list li {
				border-right:none;
				border-left:none;
			}
			
			.search {
				margin-bottom:10px;
				display:flex;
				justify-content:space-between;
			}
			
			input {
				outline:none;
				border:none;
				border-bottom:1px solid var(--input-border);
			}
			
			.list {
				width:40%;
			}
			
			.accept-block {
				width:50%;
			}
			
			.idelem {
				display:flex;
			}
			
		</style>
		<div id="chart"></div>	
		<chart-legend id="legend" legend-values="{{data}}" graph-name="{{graphTitle}}" color-selected="{{colorSelected}}"></chart-legend>
	</template> 
	
	
	<script>

	
	
	class PieChart extends Polymer.Element {

        static get is() { return  'pie-chart' }

        static get properties() {
          	return {
				title:String,
				graphTitle:{type:String},   
          		data:{type:Object, value:function(){return [];}},
          	}
        }

        constructor() {
          super();
        }

        ready() {
          	super.ready();
          	this.colors = {
          		primary: ['#132f37','#c6a278'],
          		blue: ['#012c40', '#5da6ca'],
          	};
			this.colorSelected = "primary";
        }

        attached() {
          	super.attached();
        }
        
        drawChart() {
			let _this = this;
			let colors = this.colors[this.colorSelected];
			let dat = _this.data;
			let sortedData = [];
			let finalValues = [];
			let finalColors = [];
			let highestValue;

			
			

			// Calculate the Highest Value by evaluating the highest integer on the pie chart graph parameter and updating colors accordingly.

			
			for (var i = 0; i < dat.length; i++) {
				finalValues.push(dat[i][1]);
			}
			
			for (i = 0; i < finalValues.length; i++) {
				finalColors.push(colors[1])
			}

			highestValue = finalValues.indexOf(Math.max(...finalValues)) -1;
			finalColors.splice(highestValue, 1, colors[0]);

        	google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(function() {
            	
            	
	            var options = {
	              title: _this.title,
	              legend: { position: 'none' },
	              chartArea: {'left':'5%','width': '80%', 'height': '80%'},
				  colors: finalColors,
				  slices: {highestValue: {offset:0.2}}
	            };
	
				var chart = new google.visualization.PieChart(_this.$.chart);
	            let data =  google.visualization.arrayToDataTable(dat);
	            chart.draw(data, options);
        	})
	
			this.$.legend.showLegend();

		}
        
        setData(dat) {
        	this.data = dat;
        }
        
        setTitle(tit) {
        	this.title = localizer.get(tit);
		}
		
	}
	    
	customElements.define(PieChart.is, PieChart);
	    
    </script> 
</dom-module><dom-module id="chart-legend" assetpath="common/charts/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			#legend {
				display:flex;
				justify-content:space-between;
				flex-wrap:wrap;
			}

			#legend > li {
				font-weight:bold;
				font-size:15px;
				padding-bottom:3px;
			}
			
			
        </style>
        
    <ul id="legend"></ul>
    </template> 

	<script>
	
	class ChartLegend extends Polymer.Element {

        static get is() { return  'chart-legend' }
		
        static get properties() {
          	return {
				legendValues: {type:Object, value:function(){return [];}, notify: true},
				graphName: {type:String, notify: true},
				colorSelected:{type:String, value:"primary"}
          	}
        }

        constructor() {
          super();
        }

        ready() {
			  super.ready();
			  
			 
        }
        
        showLegend() {
			let legendArray = this.legendValues;
			let colors = {primary: ['#132f37','#c6a278'],blue: ['#012c40', '#5da6ca']};
			colors = colors[this.colorSelected];
			let sortedData = [];
			let finalValues = [];
			let finalStrings = [];
			let finalTrimmedStrings;
			let finalColors = [];
			let highestValue;
			let parent = this.$.legend;
			let iconsAge = ["icons:accessibility","icons:accessibility","icons:accessibility","icons:accessibility","icons:accessibility","icons:accessibility"];
			let iconsIncome = ["icons:account-balance","icons:account-balance","icons:account-balance","icons:account-balance","icons:account-balance","icons:account-balance"];
			let iconsGender = ["notification:wc","notification:wc"];
			let iconsNationality = ["social:public","social:public","social:public","social:public","social:public","social:public","social:public"];
			let iconsContainer = [];
			

			// Calculate the Highest Value by evaluating the highest integer on the pie chart graph parameter and updating colors accordingly.

			for (var i = 1; i < legendArray.length; i++) {
				finalValues.push(legendArray[i][1]);
				finalStrings.push(legendArray[i][0]);
				finalColors.push(colors[1]);
			}

			highestValue = finalValues.indexOf(Math.max(...finalValues)) ;
			finalColors[highestValue] = colors[0];


			//received table names.......
			switch (this.graphName){
				case "gender": 
					iconsContainer = iconsGender;
					break;
				case "age": 
					iconsContainer = iconsAge;
					break;
				case "income_level":
					iconsContainer = iconsIncome;
					break;
				case "country":
					iconsContainer = iconsNationality;
				default: 
					iconsContainer.push("menu");
			}

			//prints the table
			for (var i = 0; i < finalStrings.length; i++) {
				$(parent).append( "<li style='color:"+finalColors[i]+"'><iron-icon icon='"+iconsContainer[i]+"'></iron-icon>"+finalStrings[i]+"</li>" );
			}
		}
	}
	    
	customElements.define(ChartLegend.is, ChartLegend);
	    
    </script> 
</dom-module><dom-module id="infinia-map" assetpath="common/maps/">
	<template>
		<style include="common-styles"></style>
		<style>
		
		
		* {
			box-sizing:border-box;
			font-family: 'Lato', sans-serif;
		
		}
		
		.selector {
			outline: none;
			width: 100%;
			padding: 10px;
			border: 1px solid #2196F3;
			background-color: #2196F3;
			color: white;
			cursor: pointer;
			-webkit-appearance: none;
			-moz-appearance: none;
			appearance: none;
			padding: 6px 12px;
			border-radius: 0;
			font-size: 14px;
		}
		
		.shadow {
			box-shadow: 0 0px 10px rgba(0, 0, 0, 0.3);
			-webkit-box-shadow: 0 0px 10px rgba(0, 0, 0, 0.3);
		}
		
		ul, li {
			list-style: none;
			display: block;
			padding: 0;
		}
		
		.colorShow {
			height: 8px;
			width: 8px;
			display: inline-block;
			margin-right: 5px;
			border-radius: 50%;
			margin-top: 5px;
		}
		
		.fields-list {
			margin-top: 5px;
		}
		
		.fields-list li {
			font-size: 14px;
			padding: 2px 10px;
		}
		
		.field-name {
			cursor: pointer;
			font-size:14px;
		}
		
		.content {
			display:flex;
			position:relative;
		}
		
		.search-container {
			width:0;
		}
		
		.search {
			margin :10px;padding:5px;
			width:40%;
		}
		
		
		
		.actions-selector-container {
		    display: flex;
		    flex-wrap: wrap;
		    flex-direction: column;
		    position: absolute;
		    right: 0px;
		    padding-top:20px;
		}
		
		
		.full-width {
			width:100%;
		}
		
		.space-between {
			display:flex;
			justify-content:space-between;
			
		}

		
		.action-selector {
			padding:5px 10px;
			color:white;
			border-radius: 5px 0 0 5px;
			cursor:pointer;
			margin-bottom:10px;
			background-color:var(--map-action-selection);
		}
		

		
		.side-container label{
			display:block;
		} 
		
		.side-container {
		   
		    
		    width: 100%;
		    position: absolute;
		    right: 0;
		    background-color: white;
		    height: 100%;
		    -webkit-box-shadow: -2px 0px 5px 1px var(--primary-color);
          	box-shadow: -2px 0px 5px 1px var(--lighter-background);
          	z-index:500;
		}
		
		.side-container .title {
			padding:10px ;
			background-color:var(--lighter-background);
		    border-bottom: 1px solid var(--primary-color);
		}
		
		.side-content {
		padding:5px 15px;}
		
		@media (min-width:600px) {
			.side-container {
				width:30%;
				min-width:300px;
			}
		}
		
		
		
		</style>
		
		<div class="content">
			<div id="map-container" class="shadow" style$="height:{{height}}; width:{{width}};"></div>
			<div class$="search-container {{_searcherClass()}}">
				<input id="searchInput" class="search" placeholder$="{{_localize('search')}}...">
			</div>
			
			<div class="actions-selector-container">
				<label class$="action-selector  {{_cartoClass()}}" on-click="_showClusterVisualization">{{_localize('cluster.visualization')}}</label>
				<label class$="action-selector  {{_cartoClass()}}" on-click="_showCartoManager">{{_localize('profiling')}}</label>
				<label class$="action-selector  {{_cartoClass()}}" on-click="getCartoImage">{{_localize('exportImage')}}</label>
				
				<label class$="action-selector  {{_poisClass()}}" on-click="_showPoisManager">{{_localize('pois')}}</label>
				<label class$="action-selector  {{_csvClass()}}" on-click="_showCSVLoader">{{_localize('loadCSV')}}</label>
			</div>
		
			<div class="side-container hidden" id="carto_manager">
				<div class="space-between title" style="width:100%; position:relative;">
					<b>{{_localize('profiling')}}</b>
					<iron-icon icon="icons:close" class="cursor-pointer" on-click="_hideSideContainer"></iron-icon>
				</div>
				<div style="width:100%; position:relative;"><carto-manager id="cartoManager"></carto-manager></div>
			</div>
		
		
			<div class="side-container hidden" id="pois_container">
				<div class="space-between title">
					<b>{{_localize('pois')}}</b>
					<iron-icon icon="icons:close" class="cursor-pointer" on-click="_hideSideContainer"></iron-icon>

				</div>
				<div class="side-content">
					<div class="mt10">
						<a class="cursor-pointer" on-click="clearPois">Borrar puntos</a>
					</div>
					<div class="mt10">
						<label>{{_localize('category')}}</label>
						<infinia-select id="poi_categories"></infinia-select>
					</div>
					<div class="mt10">
						<label>{{_localize('text')}}</label>
						<iron-input bind-value="{{poiTextSearch}}"> <input class="form-control"> </iron-input>
					</div>
					<div class="mt10">
						<label>{{_localize('radius')}} (m)</label>
						<iron-input bind-value="{{poiRadius}}"> <input class="form-control"> </iron-input>
					</div>
					<div class="mt10">
						<div id="poi_btn_container">
							<button class="btn btn-primary" id="poi_btn">{{_localize('search')}}</button>
						</div>
						<div id="poi_load" class="hidden">
							<paper-spinner active="active"></paper-spinner>
						</div>
					</div>
				</div>
			</div>
			
			
			
			<div class="side-container hidden" id="csv_manager_container">
				<div class="space-between title">
					<b>{{_localize('loadCSV')}}</b>
					<iron-icon icon="icons:close" class="cursor-pointer" on-click="_hideSideContainer"></iron-icon>
				</div>
				<csv-manager id="csv_manager"></csv-manager>
			</div>
			
			<div class="side-container hidden" id="cluster_visualization">
				<div class="space-between title">
					<b>{{_localize('Visualizar Cluster')}}</b>
					<iron-icon icon="icons:close" class="cursor-pointer" on-click="_hideSideContainer"></iron-icon>
				</div>
				<cluster-selector id="cluster_selector"></cluster-selector>	
				
			</div>
		</div>
	</template> 
	
	<script>

		class InfiniaMap extends Polymer.Element {
	       
	        static get is() { return  'infinia-map' }
	
	        static get properties() {
	          return {
	            zoom:{type:Number, value:6},
	            draw:{type:Boolean, value:false},
	            circles:{type:Object, value:function() {return []}},
	            pois:{type:Object, value:function() {return []}},
	            height:{type:String,value:"400px"},
	            width:{type:String,value:"100%"},
	            onStart:{type:Boolean, value:false},
	            showSearcher:{type:Boolean, value:false},
	            poiSearch:{type:Boolean, value:false},
	            poiRadius:{type:Number, value:100},
	            poiTextSearch:{type:String, value:""},
	            cartoManagement:{type:Boolean, value:false},
	            loadCsv:{type:Boolean, value:false}
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	if(typeof map_center != "undefined")
	          		map_center = {lat: 40.4378698,lng: -3.819623};
	          	this.mapCenter = map_center;
	          	
	          	if(this.onStart)
	          		this.init();
	          	
	          	
	        }
	
	        init() {
	        	
	        	if(!this.map) {
	        	
					var _this = this;
		          	
		          	var map = new google.maps.Map(this.$["map-container"], {
			            center: _this.mapCenter,
			            scrollwheel: true,
			            zoom:  this.zoom,
			            streetViewControl: false,
			            mapTypeId: google.maps.MapTypeId.ROADMAP,
			            mapTypeControl:false,
			            fullscreenControl:false,
			            styles: [{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"administrative.locality","elementType":"labels","stylers":[{"visibility":"on"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"},{"visibility":"simplified"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"poi","elementType":"geometry","stylers":[{"visibility":"simplified"},{"saturation":"-65"},{"lightness":"45"},{"gamma":"1.78"}]},{"featureType":"poi","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"on"}]},{"featureType":"road","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.highway","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit.line","elementType":"geometry","stylers":[{"saturation":"-33"},{"lightness":"22"},{"gamma":"2.08"}]},{"featureType":"transit.station.airport","elementType":"geometry","stylers":[{"gamma":"2.08"},{"hue":"#ffa200"}]},{"featureType":"transit.station.airport","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"transit.station.rail","elementType":"labels.text","stylers":[{"visibility":"off"}]},{"featureType":"transit.station.rail","elementType":"labels.icon","stylers":[{"visibility":"simplified"},{"saturation":"-55"},{"lightness":"-2"},{"gamma":"1.88"},{"hue":"#ffab00"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#bbd9e5"},{"visibility":"simplified"}]}]
		          	});
		          	this.map = map;
		         
		          	if(this.draw) {
		          		this.initDrawingManager();
		          	}
		          	
		          	if(this.showSearcher) {
		               this.initSearcher();
		          	}
		          	
		          	if(this.poiSearch) {
		          		this.initPoiSearch();
		          	}
		          	
		          	this.circles.forEach((circle) => {
		          		circle.setMap(this.map);	
		          	})
		          	
		          	this.pois.forEach((poi) => {
		          		poi.setMap(this.map);	
		          	})
		          	
		          	if(this.loadCsv) {
		          		this.initCSVLoad();
		          	}
		          	
		          	if(this.cartoManagement) {
		          		let _this = this;
		          		this.$.cartoManager.map = this.map;
		          		
		          		$(this.$.cluster_selector).on('clusterSelected', function(e) {
		          			_this.$.cartoManager.clearCarto();
			          		let sql = CartoUtils.getClusterHomeQuery(e.detail);
			          		
			          		_this.$.cartoManager.subLayers = [];
			          		_this.$.cartoManager.addCartoLayer(e.detail, sql);
		          		})
		          		
		          		$(this.$.cluster_selector).on('clusterRemoved', function(e) {
		          			_this.$.cartoManager.clearCarto();
			          		_this.$.cartoManager.subLayers = [];
			          		_this.$.cartoManager.addCartoLayer('main', _this.$.cartoManager.mainSql);
		          		})
		          	}
	        	}
	        }
	        
	        initPoiSearch() {
	        	let _this = this;
	        	utils.apiGet('/poi/_categories', {}, (response) => {
          			let categories = [];
          			response.forEach((elem) => {
          				categories.push({id:elem, value:elem})	
          			})
          			this.$.poi_categories.setOptions(categories);
          		})
          		
          		$(this.$.poi_btn).on('click', function() {
          			
          			let _button = this;
          			$(_this.$.poi_btn_container).addClass('hidden');
          			$(_this.$.poi_load).removeClass('hidden');
          			let rad = utils.getVisibleRadius(_this.map);
                    let lat = _this.map.getCenter().lat();
                    let lon = _this.map.getCenter().lng();
          			
                    let exists = false;
                    _this.pois.some((elem) => {
                    	if(_this.poiTextSearch == elem.search && $(_this.$['poi_categories']).val() == elem.category) {
							exists = true;
                    		return true;
                    	}
                    })
                    
                   	if(!exists) {
	                    utils.apiGet("/poi?rad="+rad+"&lat="+lat+"&lon="+lon+"&text="+_this.poiTextSearch+"&category="+$(_this.$.poi_categories).val(), {}, function(response) {
	                    	_this._hideSideContainer();
	                    	response.forEach((elem) => {
	                    		_this.addPoi(Number(elem.lat), Number(elem.lon),(Number(_this.poiRadius)));
	                    		$(_this.$.poi_load).addClass('hidden');
	                    		$(_this.$.poi_btn_container).removeClass('hidden');
	                    	})
	                    });
                   	}
                   	else {
                   		_this._hideSideContainer();
                   	}
          		})
	        }
	        
	        clearPois(category) {
	        	let _this = this;
	        	let positions = [];
	        	let i = this.pois.length;
	        	
	        	while(i--){
	        		
	        		if(typeof category == "object") {
	        			if(this.pois[i].category != "csv-coords") {
	        				this.pois[i].setMap(null);
	        				this.pois.splice(i, 1);
	        			}
	        		}
	        		else {
	        			let cat = category.split(" - ");
	        			if((cat[0] == this.pois[i].category &&	cat[1] == this.pois[i].search) ||
	        				this.pois[i].category == "csv-coords" && cat[0] == "csv-coords"){
	        				this.pois[i].setMap(null);
		        			this.pois.splice(i, 1);
	        			}
	        		}
	        		
	        	}
                
	        	let event = new CustomEvent('poisRemoved');
	        	this.dispatchEvent(event);
	        }
	        
	        clearCircles() {
	        	let _this = this;
	        	let i = this.circles.length;
	        	while (i--){
	        		this.circles[i].setMap(null);
	        		this.circles.splice(i, 1);		        	
	        	}
	        }
	        
	        
	        initDrawingManager() {
	        	let _this = this;
          		var drawingManager = new google.maps.drawing.DrawingManager({
          			drawingControl: true,
          			drawingControlOptions: {
          				position: google.maps.ControlPosition.TOP_CENTER,
          				drawingModes: [
          					google.maps.drawing.OverlayType.CIRCLE,
          					]
          			},
          			circleOptions: {
          				strokeColor: '#785123',
          				strokeWeight: 0.5,
          				fillOpacity: 0.1,
          				clickable: true,
          				editable: true,
          				zIndex: 1
          			},
          		});
          		drawingManager.setMap(this.map);
          		google.maps.event.addListener(drawingManager, 'circlecomplete', function(e){
          			_this._drawCircle(e, 'circles');				
          		});
	        }
	        
	        initSearcher() {
	        	let _this = this;
	        	 var input = this.$.searchInput;
	             var searchBox = new google.maps.places.SearchBox(input);
	             this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
	        	
	             
	            _this.markers = [];
	        	searchBox.addListener('places_changed', function() {
	        		 var places = searchBox.getPlaces();

	                 if (places.length == 0) {
	                   return;
	                 }
	                 var bounds = new google.maps.LatLngBounds();
	                 places.forEach(function(place) {
	                   if (!place.geometry) {
	                     console.log("Returned place contains no geometry");
	                     return;
	                   }
	                   var icon = {
	                     url: place.icon,
	                     size: new google.maps.Size(71, 71),
	                     origin: new google.maps.Point(0, 0),
	                     anchor: new google.maps.Point(17, 34),
	                     scaledSize: new google.maps.Size(25, 25)
	                   };

	                   let marker = new google.maps.Marker({
	                     map: _this.map,
	                     icon: icon,
	                     title: place.name,
	                     position: place.geometry.location
	                   })
	                  
	                   _this.markers.push(marker);
	                  
	                   
	                   google.maps.event.addListener(marker, 'click', function (e) {
	         				
	                	   utils.removeFromArray(_this.markers, marker);
	                	   
	         		        marker.setMap(null);
	         		      	let event = new CustomEvent('markerRemoved', {'detail':marker});
	     	        		_this.dispatchEvent(event);
	         		    });
	                 });
	                 _this.markers.forEach((marker) => {
	                	 bounds.extend(marker.position);
	                 })
	                 _this.map.fitBounds(bounds);
	                 if(_this.markers.length == 1)
	                	_this.map.setZoom(12);
	        	})
	        }
	        
			//Circles management
	        addCircle(latitude, longitude, radius) {
	        	var _this = this;
	        	var circle = new google.maps.Circle({
	        		strokeColor: '#785123',
      				strokeWeight: 0.5,
      				fillOpacity: 0.1,
      				clickable: true,
      				editable: true,
      				zIndex: 1,
	        		map: _this.map,
	        		center: {lat: latitude, lng: longitude},
	        		radius: radius
	        	});
	        	this._drawCircle(circle, 'circles');
	        }
			     
	        addPoi(latitude, longitude, rad, category, search) {
	        	
	        	if(isNaN(latitude) || isNaN(longitude) || isNaN(rad) || latitude == 0 || longitude == 0)
	        		return false;
	        	
	        	var _this = this;
	        	
	        	let map = null; 
	        	if(this.pois.length < 1000) {
	        		map = this.map;
	        	}
		        var poi = new google.maps.Circle({
	        		strokeColor: '#0550af',
	        		strokeOpacity: 1,
	        		strokeWeight: 3,
	        		fillColor: '#0550af',
	        		fillOpacity: 1,
	        		map: map,
	        		center: {lat: latitude, lng: longitude},
	        		radius: rad
	        	});
	        	
	        	
	        	poi.search = search ? search : this.poiTextSearch;
	        	poi.category = category ? category : $(this.$['poi_categories']).val();	
	        	this._drawCircle(poi, 'pois');
	        	return true;
	        }
	        
			_drawCircle(circle, type) {
				this[type].push(circle);
				this.setCircleEvent(circle, type);
				if(circle.map!= null) {
					let event = new CustomEvent('circleAdded', {'detail':{circle:circle, type:type}});
	        		this.dispatchEvent(event);
				}
			}
			
			setCircleEvent(circle, type) {
				let _this = this;
				google.maps.event.addListener(circle, 'click', function (e) {
      				_this[type].splice(_this[type].indexOf(circle), 1);
      		        circle.setMap(null);
      		      	let event = new CustomEvent('circleRemoved', {'detail':{circle:circle, type:type}});
  	        		_this.dispatchEvent(event);
      		    });
	        	return circle;
			}
			
			initCarto(sql, css) {
				this.$.cartoManager.cartoCss = css;
				this.$.cartoManager.addCartoLayer('main', sql);
			}
			
	        //CSV load
	        initCSVLoad() {
	        	this.$.csv_manager.map = this;
	        }
	        
	        redraw() {
		        google.maps.event.trigger(this.map,'resize');
	        } 
	        
	        _searcherClass() {
	        	return this.showSearcher ? "" : "hidden";
	        }
	        
	        _poisClass() {
	        	return this.poiSearch ? "" : "hidden";
	        }
	        
	        _cartoClass() {
	        	return this.cartoManagement ? "" : "hidden";
	        }
	        
	        _csvClass() {
	        	return this.loadCsv ? "" : "hidden";
	        }
	        
	        _localize(text) {
	        	return localizer.get(text);
	        }
	        
	        _hideSideContainer() {
	        	$(this.root).find('.side-container').addClass('hidden');
	        }
	        
	        _showPoisManager() {
	        	$(this.$['pois_container']).removeClass('hidden');
	        }
	        
	        _showCartoManager() {
	        	$(this.$['carto_manager']).removeClass('hidden');
	        }
	        
	        _showCSVLoader() {
	        	$(this.$['csv_manager_container']).removeClass('hidden');
	        }
	        
	        _showClusterVisualization() {
	        	$(this.$['cluster_visualization']).removeClass('hidden');
	        }
	        
	        sendCircleAddedEvent() {
	        	let event = new CustomEvent('circleAdded');
	    		this.dispatchEvent(event);
	        }
	        
	        getCartoOptionsSelected() {
	        	return this.$.cartoManager.getOptionsSelected();
	        }
	        
	        getCartoImage() {
	        	this.$.cartoManager.getCartoImage();
	        }
	        
 	    }
	    
	    customElements.define(InfiniaMap.is, InfiniaMap);
	    
    </script> 
</dom-module><dom-module id="carto-manager" assetpath="common/maps/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			
			.section {
				margin:15px 5px;
			}
			
			.options {
				display:flex;
				list-style:none;
				flex:1;
			}
			
			.options li {
				padding:5px;
				display:flex;
				justify-content:center;
				align-items:center;
				flex:1;
				background-color: #ededed;
		    	border: 1px solid #dedede;
		    	cursor:pointer;
			}
			
			.section-title {
				display:block;
				text-align:center;
			}
		
			.active {
				background-color:var(--light-background)!important;
			}
			
			/*.active.income_E, .active.lt12  {
				color: #E040FB!important;
			}
			.active.income_D, .active.gt12, .active.female {
				color: #2979FF!important;
			}
			.active.income_C, .active.gt18 {
				color: #00E5FF!important;
			}
			.active.income_B, .active.gt26 {
				color: #AEEA00!important;
			}
			.active.income_A, .active.gt41,.active.male {
				color: #E65100!important;
			}
			.active.gt55 {
				color: #00E676!important;
			}*/
			
			#clusters_container {
				position:absolute; 
				background-color:white; 
				height:100%;
				width:98%; 
				top:30px; 
				padding:10px;
			}
 			
		</style>

		
		
		<div class="section" data-section="gender">
			<label class="section-title">{{_localize('gender')}}</label>
			<ul class="options">
				<li class="male" data-query="gender:male">{{_localize('male')}}
				</li><li class="female" data-query="gender:female">{{_localize('female')}}</li>
			</ul>
		</div>
		<div class="section" data-section="age">
			<label class="section-title">{{_localize('age')}}</label>
			<ul class="options">
				<li class="lt12" data-query="age:<12">&lt;12</li>
				<li class="gt12" data-query="age:12-17">12-17</li>
				<li class="gt18" data-query="age:18-25">18-25</li>
				<li class="gt26" data-query="age:26-40">26-40</li>
				<li class="gt41" data-query="age:41-55">41-55</li>
				<li class="gt55" data-query="age:>55">&gt;55</li>
			</ul>
		</div>
		
		<div class="section" data-section="income_level">
			<label class="section-title">{{_localize('income.level')}}</label>
			<ul class="options">
				<li class="income_E" data-query="income_level:income_E">{{_localize('income.income_E')}}</li>
				<li class="income_D" data-query="income_level:income_D">{{_localize('income.income_D')}}</li>
				<li class="income_C" data-query="income_level:income_C">{{_localize('income.income_C')}}</li>
				<li class="income_B" data-query="income_level:income_B">{{_localize('income.income_B')}}</li>
				<li class="income_A" data-query="income_level:income_A">{{_localize('income.income_A')}}</li>
			</ul>
		</div>

</template> 
	
	<script>

		class CartoManager extends Polymer.Element {

	        static get is() { return  'carto-manager' }
	
	        static get properties() {
	          return {
	        	  mainLayer:{type:String,value:""},
	        	  cartoCss:{type:String,value:""}
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	        	super.ready();
	        	let _this = this;
	        	$(this.root).find('li').on('click', function(e) {
	        		let selectedLi = this;
	        		let selected = [];
	        		
	        		let split = $(this).data('query').split(":");
	        		let sectionName = split[0];
	        		
	        		$(_this.root).find('.section').each((i, section) => {
	        			if($(section).data('section') == sectionName) {
	        				
	        				let currentActive = $(selectedLi).hasClass('active');
	        				
	        				$(section).find('li').removeClass('active');
	        				if(!currentActive)
	        					$(selectedLi).addClass('active');
	        			}
	        		})
	        		
	        		
	        		$(_this.root).find('li.active').each(function(index, elem){
	        			selected.push($(elem).data('query'));
	        		})
	        	
	        		
					_this.clearCarto();
					
					let sql =  _this.mainLayer.sql;
					name="";
					if(selected.length > 0) {
						selected.forEach((elem) => {
							let split=elem.split(":");
							
							if(sql.indexOf('where') > -1)
								sql+=" AND "+split[0]+" = '"+split[1]+"'";
							else
								sql += " where "+split[0]+" = '"+split[1]+"'";
							name+=split[1];
						})
						
						if(_this.subLayers && _this.subLayers[name]){
							_this.subLayers[name].show();
						}
						else {
							_this.addCartoLayer(name, sql);
						}
					}
					else{
						_this.addCartoLayer('main', sql);
					}
	        	})
	        }
	        
	        
	        
	        
	        _localize(text) {
	        	return localizer.get(text);
	        }

	        addCartoLayer(name, sql) {
	        	
	        	this.activeLayer = name;
				if(this.subLayers && this.subLayers[name]) {
					this.subLayers[name].show();
					return;
				}
				
				let _this = this;
				
				if(name=="main") {
					this.mainLayer = {sql:sql, css:_this.cartoCss};
					if(typeof this.mainSql == "undefined")
						this.mainSql = this.mainLayer.sql;
				}
				
				if(!sql) return false;
				
				if(typeof this.subLayers == "undefined" || typeof this.subLayers[name] == "undefined"){
					
					let promise = new Promise((resolve, reject) => {
						if(typeof this.cartoLayer == 'undefined') {
							cartodb.createLayer(
			          				this.map, 
			          				{
			          					user_name: 'infiniamaps',
				                		type: 'cartodb',
				                		sublayers:[],
				                	},
				                	{ 
				          				cartodb_logo:false, 
				          				https:true, 
				          				legends:false
				          			})
				          	.addTo(this.map).on('done', (layer) => {
				              	_this.cartoLayer = layer;
				              	_this.subLayers = {};
				              	resolve();
				          	})
						}
						else resolve();
					})
					
					promise.then(() => {
			        	addSubLayer()
					})
				}
				else {
					addSubLayer();
				}
				
				function addSubLayer() {
					_this.subLayers[name] = _this.cartoLayer.createSubLayer({
		        		sql:sql,
		        		cartocss:_this.cartoCss
		        	})
				}
			}
			
			
	        //Carto
	        clearCarto() {
	        	
	        	if(this.subLayers){
	        		Object.keys(this.subLayers).forEach((key) => {
		        		this.subLayers[key].hide();
		        	})
	        	}
	        }
	        
	        removeCartoLayer(name) {
	        	if(this.subLayers && this.subLayers[name]){
			        this.subLayers[name].remove();
			        delete this.subLayers[name];
	        	}
	        }

	        _showClusters() {
	        	$(this.$.clusters_container).toggleClass('hidden');
	        }
	        
	        getOptionsSelected() {
	        	let options = [];
	        	$(this.root).find('.section').find('li.active').each((index, elem) => {
	        		options.push($(elem).data('query'));
	        	})
	        	return options;
	        }
	        
	        
	        getCartoImage() {
	        	
	        	
	        	var mapconfig = {
       				"version": "1.3.1",
       				"layers": [
       			  	{
       			      "type": "http",
       			      "options": {
       			        "urlTemplate": "http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",
       			      }
       			    },
       			  	{
       			    	"type": "cartodb",
       			    	"options": {
       			      		"cartocss_version": "2.1.1",
       			      		"cartocss": this.subLayers[this.activeLayer].getCartoCSS(),
       			      		"sql": this.subLayers[this.activeLayer].getSQL()
       			    	}
       				},
       				]
       			}

	        	utils.lockScreen();
	        	var newWindow = window.open();
	        	
	        	$.ajax({
       			  crossOrigin: true,
       			  type: 'POST',
       			  dataType: 'json',
       			  contentType: 'application/json',
       			  url: 'https://infiniamaps.carto.com/api/v1/map',
       			  data: JSON.stringify(mapconfig),
       			  success: (data) => {
       				utils.unlockScreen();
       			    var url = 
       			    'https://infiniamaps.carto.com/api/v1/map/static/center/' + data.layergroupid + '/'+this.map.getZoom()
       			    +'/'+this.map.getCenter().lat()+'/'+this.map.getCenter().lng()+'/1000/600.png';
       			 	newWindow.location = url;
       			  }
       			})
	        }
	        
	    }
	    
	    customElements.define(CartoManager.is, CartoManager);
	    
    </script> 
</dom-module><dom-module id="csv-manager" assetpath="common/maps/">
	<template>
		<style include="common-styles"></style>
		
		<style>
		
			.container {
				padding:10px;
			}
			#radius {
				max-width:30%;
			}
			
			.reader-container {
				margin-top:10px;
				padding-top:1px;
			}
			
		</style>
		

			

		<div class="container">
			<div>
				<a class="cursor-pointer" on-click="clearPoints">Borrar puntos</a>
			</div>
			<div class="mt10"><span class="mt10">{{_localize('radius')}} (Si no est incluido en CSV)</span></div>
			<div class="flex center-vertical mt10">
				<input type="number" id="radius" min="100" class="form-control"> 
				<span class="ml10">m</span>
			</div>
			<div class="reader-container">
				<csv-reader id="csv_reader"></csv-reader>
				<div id="spinner" class="hidden">
				<paper-spinner active="active"></paper-spinner>
				</div>
			</div>
			
			<div>
				<p>Ejecutar cada</p>
				<infinia-select disable-sort="true" id="frequency_repeat"></infinia-select>
			</div>
		</div>
		
</template> 
	
	<script>
	
		class CSVManager extends Polymer.Element {

	        static get is() { return  'csv-manager' }
	
	        static get properties() {
	          return {}
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	        	super.ready();
	        	let _this = this;
	        	$(this.$.csv_reader).on('fileLoaded', (e) =>  {
	        		let rad = Number($(this.$.radius).val()) || 100;
	        		$(this.$.spinner).removeClass('hidden');
	        		setTimeout(() => {
	        			let first = true;
	        			e.detail.every((line) => {
		        			
	        				
		    				let split = line.split(',');
		    				if(split.length == 1)
		    					split = line.split(';');
		    				
		    				if(split.length == 3) {
		    					if(!this.map.addPoi(Number(split[0]), Number(split[1]), Number(split[2])*1000, 'csv-coords') && !first ) {
		    						csvError();
		    						return false;
		    					}
		    				}
		    				else if(split.length == 2) {
		    					if(!this.map.addPoi(Number(split[0]), Number(split[1]), rad, 'csv-coords', "") && !first) {
		    						csvError();
		    						return false;
		    					}
		    				}
		    				
		    				function csvError() {
		    					utils.modal("Error", "El formato del CSV no es vlido");
		    					_this.clearPoints();
		    				}
		    				if(first) {
		    					first = false;
		    				}
		    				
		    				
		    				
		    				return true;
		    				
		    				
		    			})
		        		this.map.sendCircleAddedEvent();
		        		$(this.$.spinner).addClass('hidden');
	        		}, 100)
	        		
	        	})
	        	
	        	var timing = [ {id:"week", value:localizer.get('week')}, {id:"month", value:localizer.get('month')},{id:"quarter", value:localizer.get('quarter')}];
	        	this.$.frequency_repeat.options = timing;
	        	
	        }
	        
	        clearPoints() {
	        	this.map.clearPois('csv-coords');
	        	this.$.csv_reader.reset();
	        }
	        
	        
	        _localize(text) {
	        	return localizer.get(text);
	        }
	        
	        getFileName() {
	        	return this.$.csv_reader.getFileName();
	        }
	        
	    }
	    
	    customElements.define(CSVManager.is, CSVManager);
	    
    </script> 
</dom-module><dom-module id="campaign-actions" assetpath="campaigns/">
	<template>
		<style include="common-styles"></style>
		
			<infinia-context id="context">
					<ul slot="context-slot" class="context-ul">
						
						<li on-click="editCampaign"> <iron-icon icon="image:edit"></iron-icon> Editar</li>
						<li on-click="orderLines"> <iron-icon icon="icons:menu"></iron-icon> Lineas de pedido</li>
						<li on-click="checkCampaign"> <iron-icon icon="icons:check"></iron-icon> Validar</li>
						
						<li on-click="publicateCampaign"> <iron-icon icon="av:play-arrow"></iron-icon> Publicar</li>
						
						<li on-click="dspError"> <iron-icon icon="icons:error-outline"></iron-icon> Error Dsp</li>
						<li on-click="reporting"> <iron-icon icon="icons:assessment"></iron-icon> Reporting</li>
						<li on-click="duplicate"> <iron-icon icon="icons:content-copy"></iron-icon> Duplicar</li>
						<!--li> <iron-icon icon="av:pause"></iron-icon> Parar</li>
						<li> <iron-icon icon="av:stop"></iron-icon>Finalizar</li>
						
						<li> <iron-icon icon="icons:assignment"></iron-icon> Reporte</li>
						<li> <iron-icon icon="icons:archive"></iron-icon> Archivar</li>
						<li> <iron-icon icon="icons:delete"></iron-icon> Eliminar</li-->
					</ul>
				</infinia-context>
	</template> 
	
	<script>

		class CampaignActions extends Polymer.Element {

	        static get is() { return  'campaign-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show() {
	        	this.$.dropdown.open();
			}
	        
	        hide() {
	        	this.$.dropdown.close();
			}
	        
	        publicateCampaign() {
	        	utils.checkCampaign(this.elemId,true);
	        }
	        checkCampaign() {
	        	utils.checkCampaign(this.elemId,false);
	        }
	        
	        dspError() {
	        	
	        	utils.lockScreen();
				utils.get("/api/mediamath_errors/"+this.elemId+"/campaign", {}, 
				(response) => {
					utils.unlockScreen();
					var messageHTML = "Errores en la campaa <br><br>";
					var max = 100;
					if(response.length<max)
						max = response.length;
					for (var i = 0; i < max; i++){
					    var obj = response[i];
					    var linkToFix = "";
					    if(obj.object == "campaign")
					    	linkToFix="<a href='/campaigns/"+this.elemId+"' >Modificar Campaa</a>";
					    	
					    if(obj.object=="order_line")
							linkToFix = "<a href='/order_lines/" + obj.idObject + "?idCampaign=" + this.elemId + "' >Modificar Linea de Pedido</a>";
							    
					    messageHTML += "Fecha: " + new Date(obj.createdAt) + "<br>";
					    if (obj.object)
					    	messageHTML += "Entidad: " + obj.object + "<br>";
				    	if (obj.field)
					    	messageHTML += "Campo: " + obj.field + "<br>";
				    	
					    messageHTML += "Detalle: " + obj.message + "<br><br>" + linkToFix;
					}
					
					if(response.length==0)
						messageHTML="La campaa no tiene errores de envo a DSP<br><br>"
					
					
					utils.modal("Campaa creada", messageHTML, {closeClick:true});	
				}, 
				(error) => {
					utils.unlockScreen();
					console.log('Error publicating order line', this.elemId, error);
				});
				
				
	        }
	        
	        editCampaign() {
	        	window.location.href = "/campaigns/"+this.elemId;
	        }
	        
	        orderLines() {
	        	window.location.href = "/campaigns/"+this.elemId+"/order_lines";
	        }
	        
	        reporting() {
	        	window.location.href = "/campaigns/"+this.elemId+"/reporting";
	        }
	        
	        duplicate() {
				utils.lockScreen();
				utils.get('/api/campaigns/' + this.elemId + '/duplicate', {}, 
				(response) => {
					utils.unlockScreen();
					window.location.href = "/campaigns";
				}, 
				(error) => {
					utils.unlockScreen();
					console.log('Error duplicating order line', this.elemId, error);
				});
	        }
	        
	    }
	    
	    customElements.define(CampaignActions.is, CampaignActions);
	    
    </script> 
</dom-module><dom-module id="cluster-actions" assetpath="clusters/">
	<template>
		<style include="common-styles"></style>
		
		<infinia-context id="context">
					<ul slot="context-slot">
						<li id="edit_cluster">
							<a href="/clusters/{{elemId}}"> <iron-icon icon="image:edit"></iron-icon> Editar</a>
						</li>
						<li on-click="editPermissions" id="edit_permissions"> <iron-icon icon="image:edit"></iron-icon> Editar Permisos</li>
						<li on-click="profileCluster"> <iron-icon icon="image:remove-red-eye"></iron-icon> Perfil del cluster</li>
						<li on-click="calculateCluster"> <iron-icon icon="av:play-arrow"></iron-icon> Calcular</li>
						<li on-click="linkCluster"> <iron-icon icon="icons:assessment"></iron-icon> Asociar Agencia</li>
						<li on-click="duplicate"><iron-icon icon="icons:content-copy"></iron-icon>Duplicar</li>
						<li on-click=""><iron-icon icon="icons:launch"></iron-icon>Lanzar campaa retargeting</li>
						<li on-click="delete"><iron-icon icon="icons:delete"></iron-icon>Borrar</li>
					</ul>
			</infinia-context>
	</template> 
	
	<script>

		class ClusterActions extends Polymer.Element {

	        static get is() { return  'cluster-actions' }
	
	        static get properties() {
	          return {
	          	elemId:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	if(localStorage.accountData) {
		          	let accountData = JSON.parse(localStorage.accountData);
		          	if(accountData.userHeader.roleEntity.role.role == "ROLE_RESELLER") {
		          		$(this.$.edit_cluster).remove();
		          	}
		          	if(accountData.userHeader.roleEntity.role.role !== "ROLE_ADMIN" && accountData.userHeader.roleEntity.role.role !== "ROLE_ADMIN_EDIT") {
		          		$(this.$.edit_permissions).remove();
		          	}
	          	}
	        }

	        show(e) {
	        	$(utils.getClickedElement(e)).next()[0].open();
			}
			
			delete() {
				utils.lockScreen();
				utils.get('/api/clusters/' + this.elemId + '/delete', {}, 
				(response) => {
					utils.unlockScreen();
					if (confirm("Ests seguro de que deseas borrar el Cluster?")){
						utils.floatingSuccess("Cluster borrado correctamente");
    		        	var event = new CustomEvent('rowDelete');
						this.dispatchEvent(event);
					}
					
				}, 
				(error) => {
					utils.unlockScreen();
					console.log('Error deleting cluster', this.elemId, error);
				});
	        }
	        
	        profileCluster() {
	        	window.location.href= "/clusters/profile/" + this.elemId;
	        }
	        
	        calculateCluster() {
	        	utils.lockScreen();
				utils.apiGet('/cluster/' + this.elemId + '/_calculate', {}, 
				(response) => {
					utils.floatingSuccess('El cluster se ha lanzado correctamente');
					utils.unlockScreen();
				}, 
				(error) => {
					utils.unlockScreen();
					utils.floatingError(localizer.get('cluster.launchError'));
					console.log('Error calculating cluster', this.elemId, error);
				});
	        }
	        
	        duplicate() {
				utils.lockScreen();
				utils.get('/api/clusters/' + this.elemId + '/duplicate', {}, 
				(response) => {
					utils.unlockScreen();
					window.location.href = "/clusters";
				}, 
				(error) => {
					utils.unlockScreen();
					console.log('Error duplicating cluster', this.elemId, error);
				});
	        }
	        
			editPermissions() {
				var clusterId = this.elemId;
	        	utils.get('/clusters/permissions/template',{}, function(response) {
	        		utils.modal('Editar permisos de cluster', response);
		       		utils.post("/api/components/selects", JSON.stringify({
		    			"fields":[
		    				{
		    					"id":"0",
		    					"field":"resellers"
		    				}
		    			]
		    		}), function(selects) {
		       			var resellers = selects[0].options;
		       			$('#reseller')[0].setList(resellers);
		       			
		       			utils.lockScreen();
		       			utils.get('/api/clusters/' + clusterId, {}, 
    		          	(cluster) => {
    		          		$.map(cluster.owner, (owner) => {
    		          			var ownerType = owner.split('-')[0];
    		          			var ownerId = owner.split('-')[1];
    		          			if (ownerType == 'ROLE_RESELLER'){
    		          				$.map(resellers, (reseller) => {
    		          					if (reseller.id === ownerId){
    		          						document.querySelector('#reseller').accept({ id: reseller.id, value: reseller.value });
    		          					}
    		          				});
    		          			}
    		          		});
    		          		utils.unlockScreen();
    		          		$('#save').on('click', function() {
    		          			utils.lockScreen();
    			       			var resellers = $('#reseller')[0].getData();
    			       			cluster.owner = $.map(resellers, (elem) => {
    								return "ROLE_RESELLER-" + elem.id;
    							});
    			       			utils.post('/api/clusters', JSON.stringify(cluster), 
   			       				(response) => {
   		 	       					utils.unlockScreen();
   		 	       					$('.closePopup').trigger('click')
   		 	       				},
   		 	       				(error) => {
   			       					utils.unlockScreen();
   		 	       					console.log('Error editing cluster permissions', clusterId, error);
   		 	       					$('.closePopup').trigger('click');
   		 	       				});
    			       		});
    		          	},
    		          	(error) => {
    		          		console.log('Error getting cluster information', clusterId, error);
    		          	});
		       		});
	        	});
	        }
	        
	        linkCluster() {
	        	var clusterId = this.elemId;
	        	let accountData = JSON.parse(localStorage.accountData);
	        	utils.get('/clusters/agency_link/template',{}, function(response) {
	        		utils.modal('Asociar cluster a agencia', response);
	        		utils.post("/api/components/selects", JSON.stringify({
						"fields":[
							{
								"id" : accountData.userHeader.roleEntity.idEntity,
								"field" : "agencies"
							}
						]
					}), function(agencies) {
	        			$('#agency')[0].setList(agencies[0].options);
	        		});
	        		
	        		utils.get('/api/clusters/' + clusterId + '/agencies', {}, 
       				(agencies) => {
       					$.map(agencies, (agency) => {
							document.querySelector('#agency').accept({id: agency.id, value: agency.name});
						});
       				},
       				(error) => {
       					console.log('Error getting cluster agencies', clusterId, error);
       				});
	        		
	        		$('#save').on('click', function() {
		        		var agencies = $('#agency')[0].getData();
		        		agencies = $.map(agencies, (elem) => {
							return elem.id;
						});
		        		
		        		if (agencies.length > 0){
		        			utils.lockScreen();
		        			
	 		        		utils.get('/api/clusters/' + clusterId + '/_segment?agency_ids=' + agencies.join(), {}, 
	 	       				(response) => {
	 	       					utils.unlockScreen();
	 	       					$('.closePopup').trigger('click')
	 	       				},
	 	       				(error) => {
		       					utils.unlockScreen();
	 	       					console.log('Error linking cluster', clusterId, error);
	 	       					$('.closePopup').trigger('click')
	 	       				});
		        		}
		        	});
	        	});
	        }
	    }
	    
	    customElements.define(ClusterActions.is, ClusterActions);
	    
    </script> 
</dom-module><dom-module id="retailer-actions" assetpath="indoor_analytics/">
	<template>
		<style include="common-styles"></style>
		<style>
		
		.settings {
				color:var(--primary-color);
				cursor:pointer;
		}
		
		.drop-down {
			background-color:var(--lighter-background);
			position:relative;
			padding:5px 2px;
			border:1px solid var(--dark-background);
			border-radius:5px;
			top:-30px;
		}
		
		.drop-down li {
			padding:5px 20px;
			cursor:pointer;
			display:flex;
			min-width:200px;
		}
		
		.drop-down li:hover {
			background-color:var(--light-background);
		}
		
		iron-icon {
			margin-right:5px;
		}
		
		li a {
			width:100%;
			height:100%;
		}
			
		</style>
		
		<td>
			<iron-icon on-click="show" icon="icons:settings" class="settings"></iron-icon>
			<iron-dropdown horizontal-align="right" vertical-align="top">
				<div class="drop-down" slot="dropdown-content">
					<ul>
						<li><a href="/retailers/{{elemId}}">
							<iron-icon icon="image:edit"></iron-icon> Editar </a>
						</li>
						<li><a href="/retailers/{{elemId}}/locations">
							<iron-icon icon="device:location-searching"></iron-icon> Ubicaciones </a>
						</li>
					</ul>
				</div>
			</iron-dropdown>
		</td>
	</template> 
	
	<script>

		class RetailerActions extends Polymer.Element {

	        static get is() { return  'retailer-actions' }
	
	        static get properties() {
	          return {
	          	elemId:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	$(utils.getClickedElement(e)).next()[0].open();
			}
	        
	        
	    }
	    
	    customElements.define(RetailerActions.is, RetailerActions);
	    
    </script> 
</dom-module><dom-module id="location-actions" assetpath="indoor_analytics/">
	<template>
		<style include="common-styles"></style>
		<style>
		
		.settings {
				color:var(--primary-color);
				cursor:pointer;
		}
		
		.drop-down {
			background-color:var(--lighter-background);
			position:relative;
			padding:5px 2px;
			border:1px solid var(--dark-background);
			border-radius:5px;
			top:-30px;
		}
		
		.drop-down li {
			padding:5px 20px;
			cursor:pointer;
			display:flex;
			min-width:200px;
		}
		
		.drop-down li:hover {
			background-color:var(--light-background);
		}
		
		iron-icon {
			margin-right:5px;
		}
		
		li a {
			width:100%;
			height:100%;
		}
			
		</style>
		
		<td>
			<iron-icon on-click="show" icon="icons:settings" class="settings"></iron-icon>
			<iron-dropdown horizontal-align="right" vertical-align="top">
				<div class="drop-down" slot="dropdown-content">
					<ul>
						<li on-click="edit"><iron-icon icon="image:edit"></iron-icon> Editar </li>
						<li on-click="showTrackers"><iron-icon icon="hardware:router"></iron-icon> Trackers </li>
						<li on-click="showBeacons"><iron-icon icon="device:wifi-tethering"></iron-icon> Beacons </li>
					</ul>
				</div>
			</iron-dropdown>
		</td>
	</template> 
	
	<script>

		class LocationActions extends Polymer.Element {

	        static get is() { return  'location-actions' }
	
	        static get properties() {
	          return {
	          	elemId:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	$(utils.getClickedElement(e)).next()[0].open();
			}
	        
	        edit() {
	        	window.location.href = "/locations/" + this.elemId + '?id_retailer=' + id_retailer;
	        }
	        
	       	showTrackers() {
	        	window.location.href = "/locations/" + this.elemId + '/trackers?id_retailer=' + id_retailer;
	        }
	       	
	       	showBeacons() {
	        	window.location.href = "/locations/" + this.elemId + '/beacons?id_retailer=' + id_retailer;
	        }
	    }
	    
	    customElements.define(LocationActions.is, LocationActions);
	    
    </script> 
</dom-module><dom-module id="tracker-actions" assetpath="indoor_analytics/">
	<template>
		<style include="common-styles"></style>
		<style>
		
		.settings {
				color:var(--primary-color);
				cursor:pointer;
		}
		
		.drop-down {
			background-color:var(--lighter-background);
			position:relative;
			padding:5px 2px;
			border:1px solid var(--dark-background);
			border-radius:5px;
			top:-30px;
		}
		
		.drop-down li {
			padding:5px 20px;
			cursor:pointer;
			display:flex;
			min-width:200px;
		}
		
		.drop-down li:hover {
			background-color:var(--light-background);
		}
		
		iron-icon {
			margin-right:5px;
		}
		
		li a {
			width:100%;
			height:100%;
		}
			
		</style>
		
		<td>
			<iron-icon on-click="show" icon="icons:settings" class="settings"></iron-icon>
			<iron-dropdown horizontal-align="right" vertical-align="top">
				<div class="drop-down" slot="dropdown-content">
					<ul>
						<li on-click="edit"><iron-icon icon="image:edit"></iron-icon> Editar 
					</li></ul>
				</div>
			</iron-dropdown>
		</td>
	</template> 
	
	<script>

		class TrackerActions extends Polymer.Element {

	        static get is() { return  'tracker-actions' }
	
	        static get properties() {
	          return {
	          	elemId:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	$(utils.getClickedElement(e)).next()[0].open();
			}
	        
	        edit() {
	        	window.location.href = '/trackers/' + this.elemId + '?id_location=' + id_location + '&id_retailer=' + id_retailer;
	        }
	    }
	    
	    customElements.define(TrackerActions.is, TrackerActions);
	    
    </script> 
</dom-module><dom-module id="beacon-actions" assetpath="indoor_analytics/">
	<template>
		<style include="common-styles"></style>
		<style>
		
		.settings {
				color:var(--primary-color);
				cursor:pointer;
		}
		
		.drop-down {
			background-color:var(--lighter-background);
			position:relative;
			padding:5px 2px;
			border:1px solid var(--dark-background);
			border-radius:5px;
			top:-30px;
		}
		
		.drop-down li {
			padding:5px 20px;
			cursor:pointer;
			display:flex;
			min-width:200px;
		}
		
		.drop-down li:hover {
			background-color:var(--light-background);
		}
		
		iron-icon {
			margin-right:5px;
		}
		
		li a {
			width:100%;
			height:100%;
		}
			
		</style>
		
		<td>
			<iron-icon on-click="show" icon="icons:settings" class="settings"></iron-icon>
			<iron-dropdown horizontal-align="right" vertical-align="top">
				<div class="drop-down" slot="dropdown-content">
					<ul>
						<li on-click="edit"><iron-icon icon="image:edit"></iron-icon> Editar 
					</li></ul>
				</div>
			</iron-dropdown>
		</td>
	</template> 
	
	<script>

		class BeaconActions extends Polymer.Element {

	        static get is() { return  'beacon-actions' }
	
	        static get properties() {
	          return {
	          	elemId:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	$(utils.getClickedElement(e)).next()[0].open();
			}
	        
	        edit() {
	        	window.location.href = '/beacons/' + this.elemId + '?id_location=' + id_location + '&id_retailer=' + id_retailer;
	        }
	    }
	    
	    customElements.define(BeaconActions.is, BeaconActions);
	    
    </script> 
</dom-module><dom-module id="attribution-model-actions" assetpath="attribution_model/">
	<template>
		<style include="common-styles"></style>
	<infinia-context id="context">
					<ul slot="context-slot">
						<li on-click="profileCluster"><a> <iron-icon icon="image:remove-red-eye"></iron-icon> Visualizar</a></li>
					</ul>
				
			</infinia-context>
	</template> 
	
	<script>

		class AttributionModelActions extends Polymer.Element {

	        static get is() { return  'attribution-model-actions' }
	
	        static get properties() {
	          return {
	          	elemId:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	        }
	    }
	    
	    customElements.define(AttributionModelActions.is, AttributionModelActions);
	    
    </script> 
</dom-module><dom-module id="cluster-outdoor-actions" assetpath="clusters/">
	<template>
		<style include="common-styles"></style>
		<infinia-context id="context">
					<ul slot="context-slot">
						<li id="edit_cluster">
							<a href="/outdoor_analytics/{{elemId}}?outdoor=true"> <iron-icon icon="image:edit"></iron-icon> Editar</a>
						</li>
						<li on-click="profileCluster"> <iron-icon icon="image:remove-red-eye"></iron-icon> Perfil del cluster</li>
						<li on-click="calculateCluster"> <iron-icon icon="av:play-arrow"></iron-icon> Calcular</li>
						<li on-click="linkCluster"> <iron-icon icon="icons:assessment"></iron-icon> Asociar Agencia</li>
						<li on-click="duplicate"><iron-icon icon="icons:content-copy"></iron-icon>Duplicar
						</li><li on-click=""><a href$="/api/clusters/outdoor/csv/{{elemId}}" target="blank"><iron-icon icon="icons:file-download"></iron-icon>Descargar archivo CSV</a></li>
					</ul>
				</infinia-context>
	</template> 
	
	<script>

		class ClusterOutdoorActions extends Polymer.Element {

	        static get is() { return  'cluster-outdoor-actions' }
	
	        static get properties() {
	          return {
	          	elemId:String
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	if(localStorage.accountData) {
		          	let accountData = JSON.parse(localStorage.accountData);
		          	if(accountData.userHeader.roleEntity.role.role == "ROLE_RESELLER") {
		          		$(this.$.edit_cluster).remove();
		          	}
	          	}
	        }

	        show(e) {
	        	$(utils.getClickedElement(e)).next()[0].open();
			}
	        
	        
	        
	        profileCluster() {
	        	window.location.href= "/outdoor_analytics/profile/" + this.elemId+"?outdoor=true";
	        }
	        
	        calculateCluster() {
	        	utils.lockScreen();
				utils.apiGet('/cluster/' + this.elemId + '/_calculate', {}, 
				(response) => {
					utils.floatingSuccess('El cluster se ha lanzado correctamente');
					utils.unlockScreen();
				}, 
				(error) => {
					utils.unlockScreen();
					utils.floatingError(localizer.get('cluster.launchError'));
					console.log('Error calculating cluster', this.elemId, error);
				});
	        }
	        
	        duplicate() {
				utils.lockScreen();
				utils.get('/api/clusters/' + this.elemId + '/duplicate', {}, 
				(response) => {
					utils.unlockScreen();
					window.location.href = "/clusters";
				}, 
				(error) => {
					utils.unlockScreen();
					console.log('Error duplicating cluster', this.elemId, error);
				});
	        }
	        
	        linkCluster() {
	        	var clusterId = this.elemId;
	        	utils.get('/clusters/agency_link/template',{}, function(response) {
	        		utils.modal('Asociar cluster a agencia', response);
	        		utils.post("/api/components/selects", JSON.stringify({
						"fields":[
							{
								"id" : "0",
								"field" : "agencies"
							}
						]
					}), function(agencies) {
	        			$('#agency')[0].setList(agencies[0].options);
	        		});
	        		
	        		utils.get('/api/clusters/' + clusterId + '/agencies', {}, 
       				(agencies) => {
       					$.map(agencies, (agency) => {
							document.querySelector('#agency').accept({id: agency.id, value: agency.name});
						});
       				},
       				(error) => {
       					console.log('Error getting cluster agencies', clusterId, error);
       				});
	        		
	        		$('#save').on('click', function() {
		        		var agencies = $('#agency')[0].getData();
		        		agencies = $.map(agencies, (elem) => {
							return elem.id;
						});
		        		
		        		if (agencies.length > 0){
		        			utils.lockScreen();
		        			
	 		        		utils.apiGet('/cluster/' + clusterId + '/_segment?agency_id=' + agencies.join(), {}, 
	 	       				(response) => {
	 	       					utils.unlockScreen();
	 	       					$('.closePopup').trigger('click')
	 	       				},
	 	       				(error) => {
		       					utils.unlockScreen();
	 	       					console.log('Error linking cluster', clusterId, error);
	 	       					$('.closePopup').trigger('click')
	 	       				});
		        		}
		        	});
	        	});
	        }
	    }
	    
	    customElements.define(ClusterOutdoorActions.is, ClusterOutdoorActions);
	    
    </script> 
</dom-module><dom-module id="creative-actions" assetpath="creatives/">
	<template>
		<style include="common-styles"></style>
<infinia-context id="context">
					<ul slot="context-slot">
						
						<li on-click="editCreative"> <iron-icon icon="image:edit"></iron-icon> Editar</li>
						<li on-click="preview"> <iron-icon icon="icons:visibility"></iron-icon> Preview</li>
						<li on-click="duplicate"> <iron-icon icon="icons:content-copy"></iron-icon> Duplicar</li>
						<!--li> <iron-icon icon="av:pause"></iron-icon> Parar</li>
						<li> <iron-icon icon="av:stop"></iron-icon>Finalizar</li>
						
						<li> <iron-icon icon="icons:assignment"></iron-icon> Reporte</li>
						<li> <iron-icon icon="icons:content-copy"></iron-icon> Duplicar</li>
						<li> <iron-icon icon="icons:archive"></iron-icon> Archivar</li>
						<li> <iron-icon icon="icons:delete"></iron-icon> Eliminar</li-->
					</ul>
				</infinia-context>
	</template> 
	
	<script>

		class CreativeActions extends Polymer.Element {

	        static get is() { return  'creative-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	$(utils.getClickedElement(e)).next()[0].open();
			}
	        
	        publicateCampaign() {
	        	window.location.href = "/campaigns/dsp/upload/"+this.elemId;
	        }
	        
	        editCreative() {
	        	utils.get('/api/creatives/'+this.elemId, {}, (response) => {
	        		window.location.href = "/creatives/"+response.creativeType+"/"+this.elemId;
	        	})
	        }
	        
	        preview() {
	        	utils.get('/api/creatives/'+this.elemId, {}, function(response) {
	        		if(response) {
	        			if(response.creativeType =="assets") {
		        			if(response.files) {
		        				var file = JSON.parse(response.files)[0];  
		        				utils.modal(localizer.get("creative.preview"),'<a href="'+response.clickThroughUrl+'"><img src="'+file.url+'"/></a>', {unBlock:true});
		        			}
	        			}
	        			
	        			else if(response.creativeType =="video") {
		        			console.log(response);
	        				if(response.files) {
	        					var file = JSON.parse(response.files)[0];  
		        				utils.modal(localizer.get("creative.preview"),'<a href="'+response.clickThroughUrl+'">'+
		        						'<video controls="controls"><source src="'+file.url+'"/></video></a>', {unBlock:true});
		        			}
	        			}
	        			else {
	        				utils.modal(localizer.get("creative.preview"),'Las creatividades de este tipo no pueden visualizarse', {unBlock:true});
	        			}
	        		}
	        	})
	        }
	        
	        duplicate() {
	        	utils.get('/api/creatives/'+this.elemId, {}, (response) => {
		        	window.location.href = "/creatives/"+response.creativeType+"/"+this.elemId+"?duplicate=true";
		        })
	        }
	        
	        orderLines() {
	        	window.location.href = "/campaigns/"+this.elemId+"/order_lines";
	        }
	        
	    }
	    
	    customElements.define(CreativeActions.is, CreativeActions);
	    
    </script> 
</dom-module><dom-module id="pushwoosh_notifications-actions" assetpath="pushwoosh_notifications/">
	<template>
		<style include="common-styles"></style>
		<infinia-context id="context">
					<ul slot="context-slot">
			
						<li on-click="editNotification" id="pushwooshNotificationEdit"> 
							<iron-icon icon="image:edit"></iron-icon> Editar
						</li>
						<li on-click="publicateNotification" id="pushwooshNotificationPublicate">
							<iron-icon icon="av:play-arrow"></iron-icon> Publicar
						</li>
						<li on-click="stopNotification" id="pushwooshNotificationStopPublish">
							<iron-icon icon="av:pause"></iron-icon> Parar
						</li>
						<li on-click="duplicateNotification"> 
							<iron-icon icon="icons:content-copy"></iron-icon> Duplicar
						</li>
					</ul>
			</infinia-context>
	</template> 
	
	<script>

		class PushwooshNotificationsActions extends Polymer.Element {

	        static get is() { return  'pushwoosh_notifications-actions'; }
	
	        static get properties() {
	          return {
	          	elemId: Number
	          }
	        }
	
	        constructor() {
          		super();
	        }
	
	        ready() {
          		super.ready();
          		
          		var _this = this;
        	  	
	        	  	utils.get('/api/pushwoosh_notifications/' + this.elemId, {}, function(response) {
	    				if(response.sendingStatus && response.sendingStatus == "SENDED") {
						_this.$.pushwooshNotificationEdit.style.display = "none";
						_this.$.pushwooshNotificationPublicate.style.display = "none";
	    				}
	    				else {
	    					_this.$.pushwooshNotificationEdit.style.display = "block";
						_this.$.pushwooshNotificationPublicate.style.display = "block";
	    				}
				});
	        }
	        
	        show(e) {
	        		$(utils.getClickedElement(e)).next()[0].open();
			}
	        
	        publicateNotification() { 
	        		utils.publicateNotificationPushwoosh(this.elemId, idPushwooshCampaign);
	        }
	        
	        stopNotification() {
	        		utils.stopPublishPushwooshNotification(this.elemId, idPushwooshCampaign);
        		}
	        
	        editNotification() {
	        		window.location.href = "/pushwoosh_notifications/" + this.elemId + '?idPushwooshCampaign=' + idPushwooshCampaign;
	        }
	        
	        duplicateNotification() {
				utils.lockScreen();
				
				utils.get('/api/pushwoosh_notifications/' + this.elemId + '/duplicate', {}, 
				(response) => {
					utils.unlockScreen();
					window.location.href = "/pushwoosh_campaigns/" + idPushwooshCampaign + "/pushwoosh_notifications";
				}, 
				(error) => {
					utils.unlockScreen();					
					console.log('Error duplicating notification', this.elemId, error);
				});
	        }
	    }
	    
	    customElements.define(PushwooshNotificationsActions.is, PushwooshNotificationsActions);	    
    </script> 
</dom-module><dom-module id="pushwoosh_campaigns-actions" assetpath="pushwoosh_campaigns/">
	<template>
		<style include="common-styles"></style>

		
		<infinia-context id="context">
					<ul slot="context-slot">

						
						<li on-click="editPushwooshCampaign" id="pushwooshCampaignsEdit"> 
							<iron-icon icon="image:edit"></iron-icon> Editar
						</li>
						<li on-click="notifications"> 
							<iron-icon icon="icons:menu"></iron-icon> Notificaciones
						</li>					
						<li on-click="publicatePushwooshCampaign" id="pushwooshCampaignsPublicate"> 
							<iron-icon icon="av:play-arrow"></iron-icon> Publicar
						</li>
<!-- 						<li on-click="stopPublishPushwooshCampaign"> -->
<!-- 							<iron-icon icon="av:pause"></iron-icon> Parar -->
<!-- 						</li> -->
						<li on-click="duplicatePushwooshCampaign"> <iron-icon icon="icons:content-copy"></iron-icon> Duplicar</li>
<!-- 						<li on-click="reporting"> <iron-icon icon="icons:assessment"></iron-icon> Reporting</li> -->						
					</ul>
		</infinia-context>
	</template> 
	
	<script>

		class PushwooshCampaignsActions extends Polymer.Element {

	        static get is() { return  'pushwoosh_campaigns-actions'; }
	
	        static get properties() {
	          return {
	          	elemId: Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	          	
	          	var _this = this;
        	  	
	    	  		utils.get('/api/pushwoosh_campaigns/' + this.elemId, {}, function(response) {
	    				if(response.sendingStatus && response.sendingStatus == "SENDED") {
						_this.$.pushwooshCampaignsEdit.style.display = "none";
						_this.$.pushwooshCampaignsPublicate.style.display = "none";
	    				}
	    				else {
	    					_this.$.pushwooshCampaignsEdit.style.display = "block";
						_this.$.pushwooshCampaignsPublicate.style.display = "block";
	    				}
				});
      		}
	        
	        show(e) {
	        		$(utils.getClickedElement(e)).next()[0].open();
			}
	        
	        publicatePushwooshCampaign() {
	        		utils.publicatePushwooshCampaign(this.elemId);
	        }
	        
// 	        stopPublishPushwooshCampaign() {
// 	        		utils.stopPublishPushwooshCampaign(this.elemId);
// 	        }
	        
	        editPushwooshCampaign() {
	        		window.location.href = "/pushwoosh_campaigns/" + this.elemId;
	        }
	        
	        notifications() {
	        		window.location.href = "/pushwoosh_campaigns/"+ this.elemId + "/pushwoosh_notifications";
	        }
	        
// 	        reporting() {
// 	        		window.location.href = "/campaigns/"+this.elemId+"/reporting";
// 	        }
	        
	        duplicatePushwooshCampaign() {
				utils.lockScreen();
				utils.get('/api/pushwoosh_campaigns/' + this.elemId + '/duplicate', {},
				(response) => {
					utils.unlockScreen();
					window.location.href = "/pushwoosh_campaigns";
				}, 
				(error) => {
					utils.unlockScreen();
					console.log('Error duplicating campaign', this.elemId, error);
				});
	        }
	        
	    }
	    
	    customElements.define(PushwooshCampaignsActions.is, PushwooshCampaignsActions);	    
    </script> 
</dom-module><dom-module id="advertiser-actions" assetpath="advertisers/">
	<template>
		<style include="common-styles"></style>
		
		<infinia-context id="context">
					<ul slot="context-slot">
						<li on-click="editAdvertiser"> <iron-icon icon="image:edit"></iron-icon> Editar</li>
					</ul>
		</infinia-context>
	</template> 
	
	<script>

		class AdvertiserActions extends Polymer.Element {

	        static get is() { return  'advertiser-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	var path = utils.getPath(e.target);
				$(path[0]).next()[0].open();
			}
	        
	        editAdvertiser() {
	        	window.location.href = "/advertisers/"+this.elemId;
	        }
	        
	    }
	    
	    customElements.define(AdvertiserActions.is, AdvertiserActions);
	    
    </script> 
</dom-module><dom-module id="order_line-actions" assetpath="order_lines/">
	<template>
		<style include="common-styles"></style>
			<infinia-context id="context">
					<ul slot="context-slot">
					<li id="activate" on-click="activate"><iron-icon icon="av:play-arrow"></iron-icon>Activar</li>
					<li id="deactivate" on-click="stop"><iron-icon icon="av:pause"></iron-icon> Parar</li>
					<!-- li on-click="finalize"><iron-icon icon="av:stop"></iron-icon>Finalizar</li-->
					<li on-click="edit"><iron-icon icon="image:edit"></iron-icon> Editar</li>
					<li on-click="duplicate"><iron-icon icon="icons:content-copy"></iron-icon>Duplicar</li>
					<li on-click="remove"><iron-icon icon="icons:delete"></iron-icon>Eliminar</li>
				</ul>
			</infinia-context>
		
	</template>
	<script>

		class OrderLineActions extends Polymer.Element {

	        static get is() { return  'order_line-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	$(utils.getClickedElement(e)).next()[0].open();
			}
	        
	        activate() {
	        	utils.lockScreen();
	        	
	        	utils.get('/api/order_lines/' + this.elemId + '/check-creatives', {}, 
	    				(response) => {
	    					
							var executeActivation = true;

							
	    					if (response.resultCode == -1){
	    						executeActivation = confirm(response.message);
	    					}
	    					
	    					if (response.resultCode == -2){
	    						
	    						alert(response.message);
	    						executeActivation = false;
	    					}
	    					
	    					if(executeActivation){
	    			        	utils.lockScreen();

	    						utils.get('/api/order_lines/' + this.elemId + '/activate', {}, 
		    							(response) => {
		    								
		    								if (response.resultCode == -1){
		    									alert(response.message);
		    								}
		    								else {
		    									window.location.href = "/campaigns/" + id_campaign + "/order_lines";
		    								}
		    								utils.unlockScreen();
		    							}, 
		    							(error) => {
		    								alert(JSON.stringify(error));
		    								utils.unlockScreen();
		    							});
		    					
	    					}else{
		    					utils.unlockScreen();

	    					}
	    					
	    					
	    					
	    				}, 
	    				(error) => {
	    					alert(JSON.stringify(error));
	    					utils.unlockScreen();
	    				});
	        	
	        	
			
	        }
	        
			stop() {
				utils.lockScreen();
				utils.get('/api/order_lines/' + this.elemId + '/deactivate', {}, 
				(response) => {
					if (response.resultCode == -1){
						alert(response.message);
					}
					else {
						window.location.href = "/campaigns/" + id_campaign + "/order_lines";
					}
					utils.unlockScreen();
					
				}, 
				(error) => {
					alert(JSON.stringify(error));
					utils.unlockScreen();
				});
	        }
		
			duplicate() {
				utils.lockScreen();
				utils.get('/api/order_lines/' + this.elemId + '/duplicate', {}, 
				(response) => {
					utils.unlockScreen();
					window.location.href = "/campaigns/" + id_campaign + "/order_lines";
				}, 
				(error) => {
					utils.unlockScreen();
					console.log('Error duplicating order line', this.elemId, error);
				});
	        }
			
			remove() {
				utils.get('/api/order_lines/' + this.elemId + '/delete', {}, 
				(response) => {
					if (response.resultCode == 0) {
						window.location.href = "/campaigns/" + id_campaign + "/order_lines";
					}
					else{
						utils.modal("Error", response.message);
					}
				}, 
				(error) => {
					console.log('Error stopping order line', this.elemId);
				});	
	        }
	        
	        edit() {
	        	window.location.href = "/order_lines/" + this.elemId + '?id_campaign=' + id_campaign;
	        }
	        
	    }
	    
	    customElements.define(OrderLineActions.is, OrderLineActions);
	    
	</script>
</dom-module><dom-module id="publisher-actions" assetpath="publishers/">
	<template>
		<style include="common-styles"></style>

		<infinia-context id="context">
					<ul slot="context-slot">
						<li on-click="editPublisher"> <iron-icon icon="image:edit"></iron-icon>
							Editar
						</li>
					</ul>
				</infinia-context>
	</template> 
	<script>

		class PublisherActions extends Polymer.Element {

	        static get is() { return  'publisher-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	var path = utils.getPath(e.target);
				$(path[0]).next()[0].open();
			}

	        viewDeals() {
	        	window.location.href = "/publishers/" + this.elemId + "/deals";
	        }
	        
	        viewSites() {
	        	window.location.href = "/publishers/" + this.elemId + "/sites";
	        }
	        
	        editPublisher() {
	        	window.location.href = "/publishers/" + this.elemId;
	        }
	        
	    }
	    
	    customElements.define(PublisherActions.is, PublisherActions);
	    

    </script> 

</dom-module><dom-module id="deal-actions" assetpath="publishers/">
	<template>
		<style include="common-styles"></style>
	<infinia-context id="context">
					<ul slot="context-slot">
						<li on-click="editDeal"> <iron-icon icon="image:edit"></iron-icon>
							Editar
						</li>
					</ul>
				</infinia-context>
	</template> 
	<script>

		class DealActions extends Polymer.Element {

	        static get is() { return  'deal-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	var path = utils.getPath(e.target);
				$(path[0]).next()[0].open();
			}

	        editDeal() {
	        	publisherFunctions.editDeal(this.elemId);
	        }
	        
	    }
	    
	    customElements.define(DealActions.is, DealActions);
	    

    </script> 

</dom-module><dom-module id="site-actions" assetpath="publishers/">
	<template>
		<style include="common-styles"></style>
		<infinia-context id="context">
					<ul slot="context-slot">
						<li on-click="editSite"> <iron-icon icon="image:edit"></iron-icon>
							Edit
						</li>
					</ul>
		</infinia-context>
	</template> 
	<script>

		class SiteActions extends Polymer.Element {

	        static get is() { return  'site-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	var path = utils.getPath(e.target);
				$(path[0]).next()[0].open();
			}

	        editSite() {
	        	publisherFunctions.editSite(this.elemId);
	        }
	        
	    }
	    
	    customElements.define(SiteActions.is, SiteActions);
	    

    </script> 

</dom-module><dom-module id="agency-actions" assetpath="agencies/">
	<template>
		<style include="common-styles"></style>
		
		<infinia-context id="context">
					<ul slot="context-slot">

						<li on-click="editAgency"> <iron-icon icon="image:edit"></iron-icon> Editar</li>
					</ul>
				
			
		</infinia-context>
	</template> 
	
	<script>

		class AgencyActions extends Polymer.Element {

	        static get is() { return  'agency-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	var path = utils.getPath(e.target);
				$(path[0]).next()[0].open();
			}
	        
	        editAgency() {
	        	window.location.href = "/agencies/"+this.elemId;
	        }
	        
	    }
	    
	    customElements.define(AgencyActions.is, AgencyActions);
	    
    </script> 
</dom-module><dom-module id="users-actions" assetpath="users/">
	<template>
		<style include="common-styles"></style>
		<infinia-context id="context">
					<ul slot="context-slot">			
						<li on-click="editUser"> <iron-icon icon="image:edit"></iron-icon> Editar</li>
						<li on-click="duplicate"> <iron-icon icon="icons:content-copy"></iron-icon> Duplicar</li>
					</ul>
				</infinia-context>
	</template> 
	
	<script>

		class UsersActions extends Polymer.Element {

	        static get is() { return  'users-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        		$(utils.getClickedElement(e)).next()[0].open();
			}	        	        	        
	        
	        editUser() {
	        	window.location.href = "/users/"+this.elemId;
	        }
	        
	        duplicate() {
				utils.lockScreen();
				utils.get('/api/users/' + this.elemId + '/duplicate', {}, 
				(response) => {
					utils.unlockScreen();
					window.location.href = "/users";
				}, 
				(error) => {
					utils.unlockScreen();
					console.log('Error duplicating user', this.elemId, error);
				});
	        }
	        
	    }
	    
	    customElements.define(UsersActions.is, UsersActions);
	    
    </script> 
</dom-module><dom-module id="office-actions" assetpath="offices/">
	<template>
		<style include="common-styles"></style>
<infinia-context id="context">
					<ul slot="context-slot">
						<li on-click="editOffice"> <iron-icon icon="image:edit"></iron-icon>
							Editar
						</li>
					</ul>
				</infinia-context>
	</template> 
	<script>

		class OfficeActions extends Polymer.Element {

	        static get is() { return  'office-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	var path = utils.getPath(e.target);
				$(path[0]).next()[0].open();
			}

	        viewDeals() {
	        	window.location.href = "/offices/" + this.elemId + "/deals";
	        }
	        
	        viewSites() {
	        	window.location.href = "/offices/" + this.elemId + "/sites";
	        }
	        
	        editOffice() {
	        	window.location.href = "/offices/" + this.elemId;
	        }
	        
	    }
	    
	    customElements.define(OfficeActions.is, OfficeActions);
	    

    </script> 

</dom-module><dom-module id="trafficker-actions" assetpath="traffickers/">
	<template>
	
		<style include="common-styles"></style>
		<infinia-context id="context">
					<ul slot="context-slot">

						<li on-click="editTrafficker"> <iron-icon icon="image:edit"></iron-icon>
							Editar
						</li>
					</ul>
				
	</infinia-context></template> 
	<script>

		class TraffickerActions extends Polymer.Element {

	        static get is() { return  'trafficker-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        show(e) {
	        	var path = utils.getPath(e.target);
				$(path[0]).next()[0].open();
			}
	        
	        editTrafficker() {
	        	window.location.href = "/traffickers/" + this.elemId;
	        }
	        
	    }
	    
	    customElements.define(TraffickerActions.is, TraffickerActions);
	    

    </script> 

</dom-module><dom-module id="dashboard-actions" assetpath="dashboard/">
	<template>
		<style include="common-styles"></style>
				<infinia-context id="context">
					<ul slot="context-slot">
						<li on-click="showCampaign"> <iron-icon icon="image:edit"></iron-icon> Ver Campaa</li>
						<li on-click="showReporting"> <iron-icon icon="image:edit"></iron-icon> Ver Reporting</li>
					</ul>
				</infinia-context>
		
	</template> 
	
	<script>

		class DashboardActions extends Polymer.Element {

	        static get is() { return  'dashboard-actions' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	        
	        
	        showCampaign() {
	        	window.location.href = "/campaigns/"+this.elemId;
	        }
	        
	        showReporting() {
	        	window.location.href = "/campaigns/"+this.elemId+"/reporting";
	        }
	        
	    }
	    
	    customElements.define(DashboardActions.is, DashboardActions);
	    
    </script> 
</dom-module><dom-module id="creative-selector" assetpath="creatives/">
	<template>
		<style include="common-styles"></style>
		
		<style>
			.drop-down {
				top:35px;
				left:-10px;
				width:200px;
			}
			
			.drop-down li {
				min-width:auto;
				color:black;
			}
		</style>
		
		<iron-dropdown id="dropdown" horizontal-align="left" vertical-align="top">
			<div class="drop-down" slot="dropdown-content">
				<ul>
					<li><a href="/creatives/new/tag"> <iron-icon icon="image:brush"></iron-icon> <span>Ad script</span></a></li>
					<!-- li><a href="creatives/new/bulk"> <iron-icon icon="icons:menu"></iron-icon> <span>Bulk</span></a></li-->
					<li><a href="/creatives/new/video"> <iron-icon icon="av:videocam"></iron-icon> <span>Video</span></a></li>
					<li><a href="/creatives/new/assets"> <iron-icon icon="image:crop-original"></iron-icon> Assets</a></li>
					<li><a href="/creatives/new/zip"> <iron-icon icon="editor:attach-file"></iron-icon> ZIP</a></li>
				</ul>
			</div>
		</iron-dropdown>
	</template> 
	
	<script>

		class CreativeSelector extends Polymer.Element {

	        static get is() { return  'creative-selector' }
	
	        static get properties() {
	          return {
	          	elemId:Number
	          }
	        }
	
	        constructor() {
	          super();
	        }
	
	        ready() {
	          	super.ready();
	        }

	       open() {
	    	   this.$.dropdown.open();
	       }
	        
	    }
	    
	    customElements.define(CreativeSelector.is, CreativeSelector);
	    
    </script> 
</dom-module>

</div></body></html>